import{_ as i,c as a,aE as n,o as e}from"./chunks/framework.jiGApQmY.js";const E=JSON.parse('{"title":"Vite 报错问题","description":"","frontmatter":{},"headers":[],"relativePath":"随笔/vite报错.md","filePath":"随笔/vite报错.md"}'),t={name:"随笔/vite报错.md"};function p(l,s,h,k,d,r){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="vite-报错问题" tabindex="-1">Vite 报错问题 <a class="header-anchor" href="#vite-报错问题" aria-label="Permalink to &quot;Vite 报错问题&quot;">​</a></h1><p>2024年12月20日</p><p>我在使用 Vite 新建一个 Vue 项目时，按照官方的配置进行设置，但在执行 <code>npm run dev</code> 时遇到了报错问题。</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">X</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] Expected identifier but found </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;import&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (define name):</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dirname</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ╵ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~~~~~~</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">X</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] Expected identifier but found </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;import&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (define name):</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.filename</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ╵ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~~~~~~</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">X</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] Expected identifier but found </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;import&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (define name):</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> │ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.url</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ╵ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~~~~~~</span></span></code></pre></div><p>报错信息显示无法加载配置文件 <code>D:\\person\\my-component\\vite.config.ts</code>，启动开发服务器时出现以下错误：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Error: Build failed with 3 errors:</span></span>
<span class="line"><span>(define name):1:0: ERROR: Expected identifier but found &quot;import&quot;</span></span>
<span class="line"><span>(define name):1:0: ERROR: Expected identifier but found &quot;import&quot;</span></span>
<span class="line"><span>(define name):1:0: ERROR: Expected identifier but found &quot;import&quot;</span></span></code></pre></div><p>尝试过升级 Node 版本到 v20+，但问题依旧。降级 Node 版本到 v16.14 稳定版本时，部分插件不支持。</p><p>修改 <code>vite.config.ts</code> 文件和 <code>tsconfig.json</code> 文件也无效。</p><p>在 Google 上搜索后发现了这个问题：<a href="https://github.com/evanw/esbuild/issues/4010" target="_blank" rel="noreferrer">GitHub Issue #4010</a>。采用了其中的方案并解决了问题。</p><h2 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h2><h3 id="方案1-推荐-降级-esbuild-到-v0-24-0" tabindex="-1">方案1（推荐）：降级 esbuild 到 v0.24.0 <a class="header-anchor" href="#方案1-推荐-降级-esbuild-到-v0-24-0" aria-label="Permalink to &quot;方案1（推荐）：降级 esbuild 到 v0.24.0&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> esbuild@0.24.0</span></span></code></pre></div><h3 id="方案2-在-package-json-中添加-resolutions-字段-并重新安装依赖" tabindex="-1">方案2：在 <code>package.json</code> 中添加 <code>resolutions</code> 字段，并重新安装依赖 <a class="header-anchor" href="#方案2-在-package-json-中添加-resolutions-字段-并重新安装依赖" aria-label="Permalink to &quot;方案2：在 \`package.json\` 中添加 \`resolutions\` 字段，并重新安装依赖&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resolutions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;esbuild&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.24.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这是 esbuild v0.24.1 版本引入的一个问题，它影响了 Vite 的配置文件加载。目前降级到 esbuild v0.24.0 是最稳定的解决方案。</p><p>esbuild v0.24.1 是在 2024年2月27日发布的。这个版本引入了一个关于 <code>import.meta</code> 处理的变更，导致了与 Vite 的配置文件加载不兼容的问题。</p><h2 id="具体时间线" tabindex="-1">具体时间线： <a class="header-anchor" href="#具体时间线" aria-label="Permalink to &quot;具体时间线：&quot;">​</a></h2><ul><li>esbuild v0.24.0：2024年2月26日发布</li><li>esbuild v0.24.1：2024年2月27日发布（引入问题的版本）</li><li>问题报告：2024年2月28日在 GitHub 上被报告</li><li>当前状态：问题仍在讨论中，尚未完全解决</li></ul><p>这就是为什么我们建议暂时使用 v0.24.0 版本，因为它是最后一个稳定且没有这个问题的版本。esbuild 团队正在处理这个问题，但目前还没有确定的修复时间。</p><p>相关 issues：<a href="https://github.com/evanw/esbuild/issues/4010" target="_blank" rel="noreferrer">GitHub Issue #4010</a></p>`,20)]))}const c=i(t,[["render",p]]);export{E as __pageData,c as default};
