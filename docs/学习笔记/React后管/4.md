# React Admin 从零开始搭建教程（四）：布局系统实现

## 前言

在前面的教程中，我们已经完成了项目初始化、API 封装和状态管理的搭建。现在，让我们来实现一个功能完整的布局系统。这个布局系统不仅要支持多种布局模式，还要包含丰富的功能组件，以满足企业级后台管理系统的需求。

## 依赖安装

```bash
npm install react-router-dom --save
# 因为版本冲突，项目使用 React 19，但 ahooks 只支持到 React 18。
npm install ahooks --legacy-peer-deps
```

## 整体设计

布局系统将支持四种布局模式：经典布局、分栏布局、横向布局和纵向布局。每种布局都有其独特的特点和使用场景。在这里采用组件化设计，将不同功能模块拆分为独立组件，然后再将这些组件组合在一起，形成完整的布局系统。

创建以下目录结构：
```bash
src/layouts/
│  index.ts           # 入口文件
│  
├─components          # 公共组件
│  ├─Header           # 头部组件
│  ├─Menu             # 菜单组件
│  ├─Tabs             # 标签页组件
│  ├─Footer           # 底部组件
│  ├─Main             # 主要内容组件
│  └─ThemeDrawer      # 主题设置组件
├─LayoutClassic       # 经典布局
├─LayoutColumns       # 分栏布局
├─LayoutTransverse    # 横向布局
└─LayoutVertical      # 纵向布局
```
每个组件都有其特定的职责和功能定位。下面我们将逐一深入了解各个核心组件的实现细节。

## 实现公共组件

### Header 组件

头部组件是整个布局系统的重要组成部分,它不仅提供了系统的导航功能,还集成了多个实用的工具组件。

Header 组件分为左右两个工具栏，这样的设计让功能分布更加清晰.为了方便主题定制，所以没有将这两个组件统一成一个组件。这样子可以更加方便的跟进布局样式进行组件的调整。

左侧工具栏（ToolBarLeft）包含：
- 菜单折叠按钮
- 面包屑导航

```typescript
// src/layouts/components/Header/ToolBarLeft.tsx
import CollapseIcon from "./components/CollapseIcon";
import BreadcrumbNav from "./components/BreadcrumbNav";
import "./index.less";

const ToolBarLeft: React.FC = () => {
  return (
    <div className="tool-bar-lf mask-image">
      <CollapseIcon />
      <BreadcrumbNav />
    </div>
  );
};

export default ToolBarLeft;
```

右侧工具栏（ToolBarRight）包含：
- 语言切换
- 全局搜索
- 主题设置
- 全屏切换
- 用户头像

```typescript
// src/layouts/components/Header/ToolBarRight.tsx
import UserName from "./components/UserName";
import AvatarIcon from "./components/AvatarIcon";
import ComponentSize from "./components/ComponentSize";
import Language from "./components/Language";
import SearchMenu from "./components/SearchMenu";
import ThemeSetting from "./components/ThemeSetting";
import Message from "./components/Message";
import Fullscreen from "./components/Fullscreen";
import "./index.less";

const ToolBarRight: React.FC = () => {
  return (
    <div className="tool-bar-ri">
      <div className="header-icon">
        <Language />
        <SearchMenu />
        <ThemeSetting />
        <Fullscreen />
      </div>
      <AvatarIcon />
    </div>
  );
};

export default ToolBarRight;
```

### Footer 组件

Footer 组件比较简单，把显示状态抽离全局状态和版权信息写到项目配置中。

```typescript
// src/layouts/components/Footer/index.tsx
import React from "react";
import { Layout } from "antd";
import { RootState, useSelector } from "@/redux";
import "./index.less";

const { Footer } = Layout;

const APP_TITLE = import.meta.env.VITE_GLOB_APP_TITLE;

const LayoutFooter: React.FC = () => {
  const footer = useSelector((state: RootState) => state.global.footer);

  return (
    <React.Fragment>
      {footer && (
        <Footer className="ant-footer">
          <a href="#" target="_blank" rel="noreferrer">
            2025 © {APP_TITLE} By Hooks Technology.
          </a>
        </Footer>
      )}
    </React.Fragment>
  );
};

export default LayoutFooter;
```

### Main 组件

Main 组件是整个布局系统的核心，它包含了左侧菜单、顶部标签栏、内容区域和底部标签栏。

### 第三步：实现布局模式

以经典布局为例，它是最常用的布局模式：

```typescript
// src/layouts/LayoutClassic/index.tsx
import { Layout } from "antd";
import { useSelector } from "@/redux";
import Header from "../components/Header";
import Menu from "../components/Menu";
import Tabs from "../components/Tabs";
import Main from "../components/Main";
import Footer from "../components/Footer";
import "./index.less";

const { Sider, Content } = Layout;

const LayoutClassic = () => {
  const { collapsed } = useSelector(state => state.menu);

  return (
    <Layout className="layout-classic">
      <Sider collapsed={collapsed}>
        <Menu />
      </Sider>
      <Layout>
        <Header />
        <Tabs />
        <Content>
          <Main />
        </Content>
        <Footer />
      </Layout>
    </Layout>
  );
};

export default LayoutClassic;
```

### 第四步：主题定制

为了让用户能够自定义界面风格，我们实现了主题设置功能：

```typescript
// src/layouts/components/ThemeDrawer/index.tsx
import { Drawer } from "antd";
import ColorPicker from "./components/ColorPicker";
import "./index.less";

const ThemeDrawer = () => {
  const { visible, setVisible } = useThemeDrawer();

  return (
    <Drawer 
      title="主题设置" 
      open={visible}
      onClose={() => setVisible(false)}
    >
      <div className="theme-drawer">
        <ColorPicker />
        {/* 其他主题设置选项 */}
      </div>
    </Drawer>
  );
};

export default ThemeDrawer;
```

## 使用布局系统

完成布局系统的搭建后，我们需要在应用中使用它。首先创建一个布局入口：

```typescript
// src/layouts/index.tsx
import { useSelector } from "@/redux";
import LayoutClassic from "./LayoutClassic";
import LayoutColumns from "./LayoutColumns";
import LayoutTransverse from "./LayoutTransverse";
import LayoutVertical from "./LayoutVertical";

const LayoutIndex = () => {
  const { layout } = useSelector(state => state.global);
  
  const LayoutComponent = {
    classic: LayoutClassic,
    columns: LayoutColumns,
    transverse: LayoutTransverse,
    vertical: LayoutVertical
  }[layout];

  return <LayoutComponent />;
};

export default LayoutIndex;
```

然后在路由配置中使用这个布局：

```typescript
// src/routers/index.tsx
const router = createBrowserRouter([
  {
    element: <LayoutIndex />,
    children: [
      {
        path: "/dashboard",
        element: <Dashboard />
      },
      // ... 其他路由
    ]
  }
]);
```

## 总结

通过这篇教程，我们实现了一个功能完整的布局系统。它具有以下特点：

1. **多种布局模式**：支持四种不同的布局方式，满足不同场景的需求
2. **丰富的功能组件**：包含了大量实用的功能按钮和工具
3. **主题定制**：支持自定义主题色、组件大小等
4. **响应式设计**：适配不同屏幕尺寸

在下一篇教程中，我们将介绍如何实现路由系统和权限控制，为不同角色提供不同的访问权限。