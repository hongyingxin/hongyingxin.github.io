# HTTPè¯·æ±‚ç¼“å­˜è¯¦è§£

## å‰è¨€

HTTP ç¼“å­˜æ˜¯ Web æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œå®ƒé€šè¿‡å‡å°‘ç½‘ç»œè¯·æ±‚å’ŒæœåŠ¡å™¨è´Ÿè½½æ¥æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚ç†è§£ HTTP ç¼“å­˜æœºåˆ¶ä¸ä»…æœ‰åŠ©äºŽä¼˜åŒ–ç½‘ç«™æ€§èƒ½ï¼Œæ›´æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆå¿…å¤‡çš„æŠ€èƒ½ã€‚

## HTTPç¼“å­˜åŸºç¡€æ¦‚å¿µ

### ç¼“å­˜çš„åˆ†ç±»

HTTP ç¼“å­˜ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»åž‹ï¼š

**1. å¼ºç¼“å­˜ï¼ˆStrong Cacheï¼‰**
- æµè§ˆå™¨ç›´æŽ¥ä»Žæœ¬åœ°ç¼“å­˜è¯»å–ï¼Œä¸å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
- é€šè¿‡ `Expires` æˆ– `Cache-Control` æŽ§åˆ¶
- çŠ¶æ€ç ï¼š`200 (from disk cache)` æˆ– `200 (from memory cache)`

**2. åå•†ç¼“å­˜ï¼ˆNegotiation Cacheï¼‰**
- æµè§ˆå™¨å‘é€æ¡ä»¶è¯·æ±‚åˆ°æœåŠ¡å™¨éªŒè¯ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
- é€šè¿‡ `ETag/If-None-Match` æˆ– `Last-Modified/If-Modified-Since` æŽ§åˆ¶
- çŠ¶æ€ç ï¼š`304 Not Modified`ï¼ˆç¼“å­˜æœ‰æ•ˆï¼‰æˆ– `200`ï¼ˆç¼“å­˜å¤±æ•ˆï¼‰

## å¼ºç¼“å­˜æŽ§åˆ¶å¤´éƒ¨

### Expiresï¼ˆHTTP/1.0ï¼‰
```http
Expires: Wed, 21 Oct 2024 07:28:00 GMT
```
- æŒ‡å®šèµ„æºçš„ç»å¯¹è¿‡æœŸæ—¶é—´
- ç¼ºç‚¹ï¼šä¾èµ–å®¢æˆ·ç«¯æ—¶é—´ï¼Œå¯èƒ½ä¸å‡†ç¡®
- å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒè€ç‰ˆæœ¬æµè§ˆå™¨

### Cache-Controlï¼ˆHTTP/1.1ï¼‰
```http
Cache-Control: public, max-age=3600
```
- ä½¿ç”¨ç›¸å¯¹æ—¶é—´ï¼Œæ›´åŠ å¯é 
- åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä¼˜å…ˆçº§é«˜äºŽ Expires
- å¸¸ç”¨æŒ‡ä»¤ï¼š
  - `max-age=ç§’æ•°`ï¼šç¼“å­˜æœ‰æ•ˆæ—¶é—´
  - `public`ï¼šå¯è¢«æ‰€æœ‰ç¼“å­˜å­˜å‚¨
  - `private`ï¼šåªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜
  - `no-cache`ï¼šæ¯æ¬¡éƒ½è¦éªŒè¯
  - `no-store`ï¼šå®Œå…¨ä¸ç¼“å­˜

### Expires vs Cache-Control

Expires å’Œ Cache-Control ä¸¤è€…å¯ä»¥é€‰æ‹©ä¸€ä¸ªä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®åŒæ—¶è®¾ç½®ã€‚å› ä¸º Expires æ˜¯ HTTP/1.0 çš„ç¼“å­˜å¤´ï¼Œå¯ä»¥å…¼å®¹è€ç‰ˆæœ¬æµè§ˆå™¨ï¼ˆå¦‚IE6ï½žIE8ï¼‰ï¼Œè€Œ Cache-Control æ˜¯ HTTP/1.1 çš„ç¼“å­˜å¤´ï¼Œä¸¤è€…åŒæ—¶è®¾ç½®å¯ä»¥ç¡®ä¿å…¼å®¹æ€§ã€‚

```text
# å¦‚æžœåŒæ—¶å­˜åœ¨ï¼ŒçŽ°ä»£æµè§ˆå™¨æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§å¤„ç†ï¼š
Cache-Control: max-age=3600     # ä¼˜å…ˆçº§æœ€é«˜
Expires: Wed, 21 Oct 2024 07:28:00 GMT    # å¤‡é€‰æ–¹æ¡ˆ
```

## åå•†ç¼“å­˜æŽ§åˆ¶å¤´éƒ¨

### Last-Modifiedï¼ˆæœ€åŽä¿®æ”¹æ—¶é—´ï¼‰

```http
Last-Modified: Wed, 03 Sep 2025 06:54:11 GMT

If-Modified-Since: Wed, 03 Sep 2025 06:54:11 GMT
```

Last-Modified/If-Modified-Since æ˜¯åŸºäºŽæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰æ•ˆã€‚

æœåŠ¡å™¨åœ¨å“åº”ä¸­è¿”å›žè¯¥èµ„æºæ–‡ä»¶æœ€åŽä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´æˆ³ï¼Œæµè§ˆå™¨å°†æ­¤ä¿¡æ¯ä¸Žæœ¬åœ°ç¼“å­˜çš„èµ„æºè¿›è¡Œæ¯”å¯¹ã€‚

å·¥ä½œæµç¨‹ï¼š

1. ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›žèµ„æºå’Œå…¶ Last-Modified æ—¶é—´ã€‚
2. åŽç»­è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Š If-Modified-Since å­—æ®µï¼ŒåŒ…å«ä¹‹å‰èŽ·å–çš„ Last-Modified æ—¶é—´ã€‚
3. æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽï¼Œæ¯”è¾ƒèµ„æºå®žé™…ä¿®æ”¹æ—¶é—´å’Œ If-Modified-Since æ—¶é—´ï¼Œå¦‚æžœæ—¶é—´æœªå˜ï¼Œåˆ™è¿”å›ž 304 Not Modified å“åº”ï¼Œæµè§ˆå™¨ç›´æŽ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚

### ETagï¼ˆå†…å®¹æŒ‡çº¹ï¼‰

ETag/If-None-Match æ˜¯åŸºäºŽæ–‡ä»¶çš„å†…å®¹æŒ‡çº¹æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦æœ‰æ•ˆã€‚

ETag æ˜¯æœåŠ¡å™¨ä¸ºèµ„æºç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯èµ„æºå†…å®¹çš„å“ˆå¸Œå€¼ï¼‰ã€‚

å·¥ä½œæµç¨‹ï¼š

1. ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›žèµ„æºå’Œå…¶ ETag å€¼ã€‚
2. åŽç»­è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Š If-None-Match å­—æ®µï¼ŒåŒ…å«ä¹‹å‰èŽ·å–çš„ ETag å€¼ã€‚
3. æœåŠ¡å™¨æ¯”è¾ƒèµ„æºçš„ ETag å’Œè¯·æ±‚ä¸­çš„ ETagã€‚å¦‚æžœä¸¤è€…ä¸€è‡´ï¼Œåˆ™è¿”å›ž 304 Not Modified å“åº”ï¼›å¦‚æžœä¸ä¸€è‡´ï¼Œåˆ™è¿”å›žæ–°ç‰ˆæœ¬çš„èµ„æºã€‚

```http
ETag: "68b7e613-510"

If-None-Match: "68b7e613-510"
```

### Last-Modified vs ETag

ETagæ¯”Last-Modifiedæ›´ç²¾ç¡®ï¼Œå› ä¸ºLast-Modifiedçš„æ—¶é—´å•ä½æ˜¯ç§’ï¼Œè€ŒETagå¯ä»¥é€šè¿‡ç®—æ³•ä¿è¯æ¯æ¬¡ä¿®æ”¹éƒ½èƒ½ä¸åŒã€‚

ETagæ¯”Last-Modifiedæ›´ç²¾ç¡®ï¼ŒLast-Modifiedçš„æ—¶é—´å•ä½æ˜¯ç§’ï¼Œå¦‚æžœæŸä¸ªæ–‡ä»¶åœ¨1ç§’å†…æ”¹å˜äº†å¤šæ¬¡ï¼Œå…¶Last-Modifiedå¯èƒ½æ— æ³•ä½“çŽ°å‡ºå®žé™…ä¿®æ”¹ã€‚ETagåˆ™æ¯æ¬¡éƒ½èƒ½æ”¹å˜ï¼Œä¿è¯äº†ç²¾åº¦ã€‚

ETagçš„æ€§èƒ½ä¸å¦‚Last-Modifiedï¼Œå› ä¸ºLast-Modifiedåªéœ€è¦è®°å½•æ—¶é—´ï¼Œè€ŒETagéœ€è¦æœåŠ¡å™¨é€šè¿‡ç®—æ³•è®¡ç®—å“ˆå¸Œå€¼ã€‚

å½“åŒæ—¶ä½¿ç”¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆè€ƒè™‘ETagè¿›è¡Œåå•†ç¼“å­˜ã€‚

## å¼ºç¼“å­˜+åå•†ç¼“å­˜ç»„åˆè¿è¡Œæµç¨‹

åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸åŒæ—¶é…ç½®å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„æ€§èƒ½æ•ˆæžœã€‚ä¸‹é¢è¯¦ç»†æè¿°è¿™ç§ç»„åˆç­–ç•¥çš„å®Œæ•´è¿è¡Œæµç¨‹ã€‚

### å…¸åž‹çš„ç¼“å­˜é…ç½®

```http
# æœåŠ¡å™¨å“åº”å¤´ï¼ˆåŒæ—¶è®¾ç½®å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼‰
HTTP/1.1 200 OK
Cache-Control: public, max-age=3600        # å¼ºç¼“å­˜1å°æ—¶
ETag: "v1.0-abc123"                        # åå•†ç¼“å­˜ï¼ˆETagï¼‰
Last-Modified: Wed, 03 Sep 2025 06:54:11 GMT  # åå•†ç¼“å­˜ï¼ˆæ—¶é—´ï¼‰
Expires: Wed, 03 Sep 2025 07:54:11 GMT     # å¼ºç¼“å­˜å¤‡é€‰ï¼ˆå…¼å®¹æ€§ï¼‰
```

### å®Œæ•´çš„ç¼“å­˜å†³ç­–æµç¨‹

```
ç”¨æˆ·è¯·æ±‚èµ„æº (GET /app.js)
      â†“
æµè§ˆå™¨æ£€æŸ¥æœ¬åœ°ç¼“å­˜
      â†“
   æœ¬åœ°æ˜¯å¦æœ‰ç¼“å­˜ï¼Ÿ
    â”œâ”€ å¦ â†’ å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ˆé¦–æ¬¡è®¿é—®ï¼‰
    â””â”€ æ˜¯ â†“
      â†“
æ£€æŸ¥å¼ºç¼“å­˜æ˜¯å¦æœ‰æ•ˆï¼Ÿ
â”œâ”€ Cache-Control: max-age æœªè¿‡æœŸ
â”‚  â””â”€ ç›´æŽ¥è¿”å›žç¼“å­˜ (200 from cache) ã€æœ€å¿«è·¯å¾„ã€‘
â”œâ”€ Cache-Control: no-cache 
â”‚  â””â”€ è·³è¿‡å¼ºç¼“å­˜ï¼Œç›´æŽ¥è¿›å…¥åå•†ç¼“å­˜
â””â”€ å¼ºç¼“å­˜è¿‡æœŸ â†“
      â†“
æ£€æŸ¥æ˜¯å¦æœ‰åå•†ç¼“å­˜æ ‡è¯†ï¼Ÿ
â”œâ”€ æ— ETagä¹Ÿæ— Last-Modified
â”‚  â””â”€ å‘é€æ™®é€šè¯·æ±‚åˆ°æœåŠ¡å™¨
â””â”€ æœ‰åå•†ç¼“å­˜æ ‡è¯† â†“
      â†“
å‘é€æ¡ä»¶è¯·æ±‚åˆ°æœåŠ¡å™¨
GET /app.js HTTP/1.1
If-None-Match: "v1.0-abc123"           # ä¼˜å…ˆä½¿ç”¨ETag
If-Modified-Since: Wed, 03 Sep 2025 06:54:11 GMT
      â†“
æœåŠ¡å™¨éªŒè¯èµ„æºæ˜¯å¦å˜åŒ–
â”œâ”€ ETagåŒ¹é… ä¸” æ–‡ä»¶æœªä¿®æ”¹
â”‚  â”œâ”€ è¿”å›žï¼š304 Not Modified
â”‚  â”œâ”€ å“åº”å¤´ï¼šETag: "v1.0-abc123"
â”‚  â”œâ”€ å“åº”å¤´ï¼šCache-Control: public, max-age=3600 (é‡æ–°å¼€å§‹å¼ºç¼“å­˜)
â”‚  â””â”€ æµè§ˆå™¨ï¼šç»§ç»­ä½¿ç”¨æœ¬åœ°ç¼“å­˜ + é‡ç½®å¼ºç¼“å­˜è®¡æ—¶å™¨
â””â”€ ETagä¸åŒ¹é… æˆ– æ–‡ä»¶å·²ä¿®æ”¹
   â”œâ”€ è¿”å›žï¼š200 OK + æ–°å†…å®¹
   â”œâ”€ å“åº”å¤´ï¼šETag: "v2.0-def456" (æ–°çš„ETag)
   â”œâ”€ å“åº”å¤´ï¼šCache-Control: public, max-age=3600 (æ–°çš„å¼ºç¼“å­˜)
   â””â”€ æµè§ˆå™¨ï¼šæ›´æ–°æœ¬åœ°ç¼“å­˜ + å¼€å§‹æ–°çš„å¼ºç¼“å­˜å‘¨æœŸ
```

### å®žé™…è¿è¡Œæ—¶é—´çº¿ç¤ºä¾‹

ä»¥ä¸€ä¸ªCSSæ–‡ä»¶ä¸ºä¾‹ï¼Œå±•ç¤ºå¼ºç¼“å­˜+åå•†ç¼“å­˜çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

```
æ—¶é—´ç‚¹ 0åˆ†é’Ÿï¼šã€é¦–æ¬¡è¯·æ±‚ã€‘
â”œâ”€ è¯·æ±‚ï¼šGET /style.css
â”œâ”€ å“åº”ï¼š200 OK (1.2KB)
â”‚   â”œâ”€ Cache-Control: public, max-age=3600 (1å°æ—¶å¼ºç¼“å­˜)
â”‚   â”œâ”€ ETag: "css-v1.0"
â”‚   â””â”€ Last-Modified: Wed, 03 Sep 2025 06:54:11 GMT
â”œâ”€ è€—æ—¶ï¼š200ms
â””â”€ ç»“æžœï¼šå»ºç«‹ç¼“å­˜ï¼Œå¼€å§‹1å°æ—¶å¼ºç¼“å­˜æœŸ

æ—¶é—´ç‚¹ 30åˆ†é’Ÿï¼šã€å¼ºç¼“å­˜æœŸå†…ã€‘
â”œâ”€ è¯·æ±‚ï¼šGET /style.css
â”œâ”€ æµè§ˆå™¨æ£€æŸ¥ï¼šå¼ºç¼“å­˜æœªè¿‡æœŸ âœ…
â”œâ”€ å“åº”ï¼š200 (from disk cache)
â”œâ”€ è€—æ—¶ï¼š0ms âš¡ï¸
â””â”€ ç»“æžœï¼šç›´æŽ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œæ— ç½‘ç»œè¯·æ±‚

æ—¶é—´ç‚¹ 70åˆ†é’Ÿï¼šã€å¼ºç¼“å­˜è¿‡æœŸï¼Œæ–‡ä»¶æœªå˜åŒ–ã€‘
â”œâ”€ è¯·æ±‚ï¼šGET /style.css
â”œâ”€ æµè§ˆå™¨æ£€æŸ¥ï¼šå¼ºç¼“å­˜å·²è¿‡æœŸ âŒ
â”œâ”€ å‘é€æ¡ä»¶è¯·æ±‚ï¼š
â”‚   â”œâ”€ If-None-Match: "css-v1.0"
â”‚   â””â”€ If-Modified-Since: Wed, 03 Sep 2025 06:54:11 GMT
â”œâ”€ æœåŠ¡å™¨éªŒè¯ï¼šæ–‡ä»¶æœªä¿®æ”¹ âœ…
â”œâ”€ å“åº”ï¼š304 Not Modified
â”‚   â”œâ”€ ETag: "css-v1.0" (ç›¸åŒ)
â”‚   â””â”€ Cache-Control: public, max-age=3600 (é‡æ–°å¼€å§‹1å°æ—¶)
â”œâ”€ è€—æ—¶ï¼š50ms
â””â”€ ç»“æžœï¼šç»§ç»­ä½¿ç”¨æœ¬åœ°ç¼“å­˜ + é‡æ–°å¼€å§‹å¼ºç¼“å­˜è®¡æ—¶

æ—¶é—´ç‚¹ 150åˆ†é’Ÿï¼šã€å¼ºç¼“å­˜è¿‡æœŸï¼Œæ–‡ä»¶å·²æ›´æ–°ã€‘
â”œâ”€ è¯·æ±‚ï¼šGET /style.css
â”œâ”€ æµè§ˆå™¨æ£€æŸ¥ï¼šå¼ºç¼“å­˜å·²è¿‡æœŸ âŒ
â”œâ”€ å‘é€æ¡ä»¶è¯·æ±‚ï¼š
â”‚   â”œâ”€ If-None-Match: "css-v1.0"
â”‚   â””â”€ If-Modified-Since: Wed, 03 Sep 2025 06:54:11 GMT
â”œâ”€ æœåŠ¡å™¨éªŒè¯ï¼šæ–‡ä»¶å·²ä¿®æ”¹ âŒ
â”œâ”€ å“åº”ï¼š200 OK (1.5KB æ–°å†…å®¹)
â”‚   â”œâ”€ ETag: "css-v2.0" (æ–°ç‰ˆæœ¬)
â”‚   â”œâ”€ Last-Modified: Wed, 03 Sep 2025 08:30:15 GMT
â”‚   â””â”€ Cache-Control: public, max-age=3600 (æ–°çš„1å°æ—¶å‘¨æœŸ)
â”œâ”€ è€—æ—¶ï¼š180ms
â””â”€ ç»“æžœï¼šæ›´æ–°æœ¬åœ°ç¼“å­˜ + å¼€å§‹æ–°çš„å¼ºç¼“å­˜å‘¨æœŸ
```

## å®žæˆ˜æ¡ˆä¾‹åˆ†æž

è®©æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªçœŸå®žURLæ¥ç†è§£ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼š

### æ¡ˆä¾‹ä¸€ï¼šçº¯åå•†ç¼“å­˜ç­–ç•¥

**URL**: `https://ditto.res.wooyavip.com/build_v/index.html`

**å“åº”å¤´åˆ†æž**ï¼š
```http
HTTP/2 200
server: nginx/1.27.4
last-modified: Wed, 03 Sep 2025 06:54:11 GMT
etag: "68b7e613-510"
# æ³¨æ„ï¼šæ²¡æœ‰ Cache-Control æˆ– Expires
```

**ç¼“å­˜ç‰¹ç‚¹**ï¼š
- âŒ æ²¡æœ‰å¼ºç¼“å­˜é…ç½®ï¼Œç¼ºå°‘ Cache-Control æˆ– Expires
- âœ… æ”¯æŒåå•†ç¼“å­˜ï¼Œè®¾ç½®äº† ETag å’Œ Last-Modified
- ðŸ”§ ä½¿ç”¨ Nginx æœåŠ¡å™¨

**å·¥ä½œæµç¨‹**ï¼š
```
1. é¦–æ¬¡è¯·æ±‚ â†’ æœåŠ¡å™¨è¿”å›žå®Œæ•´å†…å®¹ + ç¼“å­˜æ ‡è¯†
   Response: 200 OK
   Content: HTMLå†…å®¹
   ETag: "68b7e613-510"
   Last-Modified: Wed, 03 Sep 2025 06:54:11 GMT

2. åŽç»­è¯·æ±‚ â†’ æµè§ˆå™¨å‘é€æ¡ä»¶è¯·æ±‚
   Request Headers:
   If-None-Match: "68b7e613-510"
   If-Modified-Since: Wed, 03 Sep 2025 06:54:11 GMT

3. æœåŠ¡å™¨å“åº” â†’ åŸºäºŽæ¡ä»¶åˆ¤æ–­
   - æœªä¿®æ”¹: 304 Not Modified (ç©ºå“åº”ä½“)
   - å·²ä¿®æ”¹: 200 OK (æ–°å†…å®¹)
```

### æ¡ˆä¾‹äºŒï¼šå¼ºç¼“å­˜+åå•†ç¼“å­˜ç»„åˆç­–ç•¥

**URL**: `https://res.sayyouditto.com/build_v/index.html`

**å“åº”å¤´åˆ†æž**ï¼š
```http
HTTP/2 200
server: cloudflare
cache-control: public, max-age=30
last-modified: Wed, 03 Sep 2025 07:26:17 GMT
cf-cache-status: DYNAMIC
x-qiniu-zone: as0
```

**ç¼“å­˜ç‰¹ç‚¹**ï¼š
- âœ… æ”¯æŒå¼ºç¼“å­˜ï¼Œè®¾ç½®äº† Cache-Control: public, max-age=30ï¼Œæ˜Žç¡®30ç§’ç¼“å­˜ç­–ç•¥
- âœ… æ”¯æŒåå•†ç¼“å­˜ï¼Œè®¾ç½®äº† last-modified: Wed, 03 Sep 2025 07:26:17 GMTï¼Œå¼ºç¼“å­˜è¿‡æœŸåŽå¯ç”¨åå•†ç¼“å­˜
- ðŸ”§ ä½¿ç”¨ Cloudflare CDN åŠ é€Ÿå’Œ x-qiniu-zone ä¸ƒç‰›äº‘å­˜å‚¨æ ‡è¯†


**å·¥ä½œæµç¨‹**ï¼š
```
é˜¶æ®µä¸€ï¼šå¼ºç¼“å­˜æœŸå†…ï¼ˆ0-30ç§’ï¼‰
1. é¦–æ¬¡è¯·æ±‚ â†’ æ­£å¸¸èŽ·å–å†…å®¹
   Response: 200 OK
   Cache-Control: public, max-age=30
   Last-Modified: Wed, 03 Sep 2025 07:26:17 GMT

2. 30ç§’å†…å†æ¬¡è¯·æ±‚ â†’ ç›´æŽ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜
   æµè§ˆå™¨: 200 (from disk cache)
   ç½‘ç»œè¯·æ±‚: æ— 

é˜¶æ®µäºŒï¼šå¼ºç¼“å­˜è¿‡æœŸåŽï¼ˆ30ç§’åŽï¼‰
3. ç¼“å­˜è¿‡æœŸè¯·æ±‚ â†’ å‘é€æ¡ä»¶è¯·æ±‚
   Request Headers:
   If-Modified-Since: Wed, 03 Sep 2025 07:26:17 GMT

4. æœåŠ¡å™¨å“åº” â†’ åå•†ç¼“å­˜ç”Ÿæ•ˆ
   - æœªä¿®æ”¹: 304 Not Modified
   - å·²ä¿®æ”¹: 200 OK + æ–°çš„Cache-Control
```

## ç¼“å­˜ç­–ç•¥æœ€ä½³å®žè·µ

### 1. æ ¹æ®èµ„æºç±»åž‹åˆ¶å®šç­–ç•¥

**HTMLæ–‡ä»¶**ï¼š
```http
# æ–¹æ¡ˆä¸€ï¼šä¸ç¼“å­˜ï¼ˆç¡®ä¿å®žæ—¶æ€§ï¼‰
Cache-Control: no-cache

# æ–¹æ¡ˆäºŒï¼šçŸ­æœŸç¼“å­˜ï¼ˆå¹³è¡¡æ€§èƒ½å’Œå®žæ—¶æ€§ï¼‰
Cache-Control: public, max-age=300
```

**CSS/JSæ–‡ä»¶**ï¼š
```http
# ç‰ˆæœ¬æŽ§åˆ¶ + é•¿æœŸç¼“å­˜
Cache-Control: public, max-age=31536000  # 1å¹´
# æ–‡ä»¶åï¼šapp.v1.2.3.css
```

**å›¾ç‰‡èµ„æº**ï¼š
```http
# ä¸­é•¿æœŸç¼“å­˜
Cache-Control: public, max-age=86400  # 1å¤©
```

**APIæ•°æ®**ï¼š
```http
# æ ¹æ®æ•°æ®ç‰¹æ€§è°ƒæ•´
Cache-Control: private, max-age=300  # ç”¨æˆ·ç›¸å…³æ•°æ®ï¼Œ5åˆ†é’Ÿ
Cache-Control: public, max-age=3600  # å…¬å…±é…ç½®ï¼Œ1å°æ—¶
Cache-Control: no-store              # æ•æ„Ÿæ•°æ®ï¼Œä¸ç¼“å­˜
```

### 2. Nginxé…ç½®ç¤ºä¾‹

```nginx
# é™æ€èµ„æºé•¿æœŸç¼“å­˜
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000";
    add_header Vary Accept-Encoding;
}

# HTMLæ–‡ä»¶çŸ­æœŸç¼“å­˜
location ~* \.html$ {
    expires 5m;
    add_header Cache-Control "public, max-age=300";
}

# APIæŽ¥å£ç¼“å­˜
location /api/ {
    expires 10m;
    add_header Cache-Control "private, max-age=600";
}
```

### 3. Node.js/Expressé…ç½®ç¤ºä¾‹

```javascript
const express = require('express');
const app = express();

// é™æ€èµ„æºé…ç½®
app.use('/static', express.static('public', {
  maxAge: '1y',
  setHeaders: (res, path) => {
    if (path.endsWith('.html')) {
      res.setHeader('Cache-Control', 'public, max-age=300');
    }
  }
}));

// APIç¼“å­˜é…ç½®
app.get('/api/config', (req, res) => {
  res.set('Cache-Control', 'public, max-age=3600');
  res.json({ config: 'data' });
});

app.get('/api/user/:id', (req, res) => {
  res.set('Cache-Control', 'private, max-age=300');
  res.json({ user: 'data' });
});

// å®žæ—¶æ•°æ®ä¸ç¼“å­˜
app.get('/api/realtime', (req, res) => {
  res.set('Cache-Control', 'no-store');
  res.json({ timestamp: Date.now() });
});
```