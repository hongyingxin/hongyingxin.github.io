---
tag:
 - React åç®¡
---

# ï¼ˆå…«ï¼‰ï¼šæäº¤è§„èŒƒ

## å‰è¨€

åœ¨å›¢é˜Ÿåä½œä¸­ï¼Œæäº¤è§„èŒƒæ˜¯éå¸¸é‡è¦çš„ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†ä»£ç ï¼Œæé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘å†²çªï¼Œæé«˜åä½œæ•ˆç‡ã€‚

## Husky - Git Hooks

Husky åœ¨æäº¤æˆ–æ¨é€æ—¶ï¼Œè‡ªåŠ¨åŒ–æ£€æŸ¥æäº¤ä¿¡æ¯ã€æ£€æŸ¥ä»£ç  å’Œ è¿è¡Œæµ‹è¯•ã€‚


### ä¾èµ–å®‰è£…

```bash
# å®‰è£…ä¾èµ–
npm install --save-dev husky

# åˆå§‹åŒ– husky
npx husky init
```

init å‘½ä»¤åä¼šç”Ÿæˆ `.husky` ç›®å½•ï¼Œé‡Œé¢åŒ…å« pre-commit æ–‡ä»¶ï¼Œå¹¶æ›´æ–° package.json çš„ prepare è„šæœ¬ã€‚

```bash
# .husky/pre-commit æ–‡ä»¶å†…å®¹
npm test
```

å½“æˆ‘ä»¬æ‰§è¡Œ `git commit` æ—¶ï¼Œä¼šè§¦å‘ pre-commit é’©å­ï¼Œæ‰§è¡Œ `npm test` å‘½ä»¤ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥é…ç½® `npm test` å‘½ä»¤ã€‚

```json
"scripts": {
  "prepare": "husky",
  "test": "echo \"Running tests...\""
}
```

è¿™ä¸€æ®µè¡¨ç¤º npm test å‘½ä»¤ä¼šæ‰“å°å†…å®¹ `echo "Running tests..."`ã€‚

![å›¾ç‰‡](/public/assets/reactAdmin/7.png)

å¦‚å›¾æ‰€ç¤ºï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çš„ husky åŸºç¡€é…ç½®å°±å®Œæˆäº†ã€‚

## lint-staged

lint-staged å¯¹ git æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ã€‚

### 1. ä¾èµ–å®‰è£…

```bash
npm install --save-dev lint-staged
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `lint-staged.config.js` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```js
// lint-staged.config.js
module.exports = {
  "*.{js,jsx,ts,tsx}": ["eslint --fix", "prettier --write"],
  "{!(package)*.json,*.code-snippets,.!(browserslist)*rc}": ["prettier --write--parser json"],
  "package.json": ["prettier --write"],
  "*.{scss,less,styl,html}": ["stylelint --fix", "prettier --write"],
  "*.md": ["prettier --write"]
};
```

### 3. ä¿®æ”¹ hook

ä¿®æ”¹ `.husky/pre-commit` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/usr/bin/env sh
# åˆå§‹åŒ–è„šæœ¬
. "$(dirname -- "$0")/_/husky.sh"

npm run lint:lint-staged
```

```bash
npx husky add .husky/pre-commit "npm run lint:lint-staged"
```
è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ `husky add` å‘½ä»¤å·²ç»è¢«åºŸé™¤äº†ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¼šæŠ¥é”™ã€‚

### 4. æ·»åŠ è„šæœ¬

åœ¨ package.json çš„ scripts ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```json
// package.json
"scripts": {
  "lint-staged": "lint-staged"
}
```

### 5. æµ‹è¯•

å› ä¸ºä¸Šä¸€ç¯‡è®¾ç½® vscode ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æš‚æ—¶å…³é—­ä¸€ä¸‹è®¾ç½®ã€‚

ç„¶åéšä¾¿å†™ä¸€ä¸ªä¸ç¬¦åˆè§„èŒƒçš„ä»£ç ï¼Œçœ‹æ˜¯å¦èƒ½è§¦å‘ husky çš„é’©å­ã€‚

æäº¤å¤±è´¥å¦‚å›¾ä¸€æ‰€ç¤ºï¼Œæäº¤æˆåŠŸå¦‚å›¾äºŒæ‰€ç¤ºã€‚

```json
// .vscode/settings.json
{
  "editor.formatOnSave": false
}
```

![å›¾ç‰‡](/public/assets/reactAdmin/8.png)

![å›¾ç‰‡](/public/assets/reactAdmin/9.png)


### 6. è¿›é˜¶

æŒ‰ç…§ä¸Šæ–‡çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬å‘ç°æäº¤å¤±è´¥åï¼Œå¹¶æ²¡æœ‰æç¤ºæˆ‘ä»¬å“ªé‡Œä¸ç¬¦åˆè§„èŒƒã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `lint-staged` çš„ `staged` é…ç½®ï¼Œæ¥å°è¯•è‡ªåŠ¨ä¿®å¤å¯ä»¥ä¿®å¤çš„é—®é¢˜ï¼Œå¦‚æœä¸èƒ½ä¿®å¤ï¼Œåˆ™æç¤ºæˆ‘ä»¬å“ªé‡Œä¸ç¬¦åˆè§„èŒƒã€‚
åˆ›å»º `lint-staged.config.mjs` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```js
// lint-staged.config.mjs
import { execaSync } from 'execa';
export default {
  "src/**/*.{js,jsx,ts,tsx}": (files) => {
    try {
      // æ‰§è¡Œè‡ªåŠ¨ä¿®å¤
      execaSync('eslint', ['--fix', '--quiet', ...files], { 
        stdio: 'inherit',
        reject: false
      });
      // æ‰§è¡Œæ ¼å¼åŒ–
      execaSync('prettier', ['--write', '--quiet', ...files], { 
        stdio: 'inherit',
        reject: false
      });
      // åªåœ¨æœ€åæ£€æŸ¥æ—¶æ˜¾ç¤ºé”™è¯¯
      const result = execaSync('eslint', ['--format', 'stylish', ...files], { 
        stdio: 'inherit',
        reject: false
      });
      if (result.exitCode !== 0) {
        return false;
      }
      return true;
    } catch (error) {
      return false;
    }
  }
};
```


ç°åœ¨è®©æˆ‘ä»¬å†™ä¸€ä¸ªä¸ç¬¦åˆè§„èŒƒä½†å¯ä»¥è‡ªåŠ¨ä¿®å¤çš„ä»£ç å’Œä¸ç¬¦åˆè§„èŒƒä½†ä¸å¯ä»¥è‡ªåŠ¨ä¿®å¤çš„ä»£ç ã€‚ç„¶åä½¿ç”¨ `git commit` æäº¤ï¼Œçœ‹æ˜¯å¦èƒ½è‡ªåŠ¨ä¿®å¤ã€‚

```tsx
const App: React.FC = () => {
  var test = "111";
  console.log(test);

  const name = "test1";
  const name = "test2";
  return <div>App</div>;
};
```

![å›¾ç‰‡](/public/assets/reactAdmin/11.png)

è·Ÿæˆ‘ä»¬é¢„æƒ³çš„ä¸€æ ·ï¼Œå¯ä»¥è‡ªåŠ¨ä¿®å¤çš„ä»£ç `var test = "111";`ä¿®å¤äº†ï¼Œä¸å¯ä»¥è‡ªåŠ¨ä¿®å¤çš„ä»£ç `const name = "test1"; const name = "test2";`æ²¡æœ‰ä¿®å¤ã€‚

## Commitlint

Commitlint æ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚

å…³äº Commit æäº¤è§„èŒƒï¼Œå¯ä»¥å‚è€ƒæˆ‘å¦ä¸€ç¯‡æ–‡ç«  [Commitlint](/git/gitè§„èŒƒ.md)ã€‚

### 1. ä¾èµ–å®‰è£…

```bash
npm install --save-dev @commitlint/config-conventional @commitlint/cli
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `commitlint.config.js` æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```js
// commitlint.config.js
module.exports = {
  ignores: [commit => commit.includes("init")],
  extends: ['@commitlint/config-conventional'],
  rules: {},
  prompt: {}
};
```

### 3. é…ç½® husky

åˆ›å»º `.husky/commit-msg` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx --no-install commitlint --edit $1
```

### 4. æµ‹è¯•

ä½¿ç”¨ `git commit` æäº¤ï¼Œçœ‹æ˜¯å¦èƒ½è§¦å‘ husky çš„é’©å­ã€‚

![å›¾ç‰‡](/public/assets/reactAdmin/12.png)

### 5. æ¼”ç¤º

#### é”™è¯¯æäº¤

```bash
git commit -m "æ›´æ–°ä»£ç "
# Error: subject may not be empty
# Error: type may not be empty
```

#### æ­£ç¡®æäº¤

```bash
git commit -m "feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
# [main 1234567] feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½
```



## CZG

Commitizen æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆè§„èŒƒçš„ commit messageã€‚ä¸ç”¨å†è®°å¿† commit æ ¼å¼ï¼Œè€Œæ˜¯é€šè¿‡äº¤äº’å¼çš„å‘½ä»¤è¡Œæ¥å¡«å†™ä¿¡æ¯ã€‚

å› ä¸º Commitizen æ¯”è¾ƒé‡ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº† `cgz` å’Œ `cz-git` æ¥ä»£æ›¿ï¼ˆè½»é‡+ä¸­æ–‡æ”¯æŒï¼‰ã€‚

### 1. ä¾èµ–å®‰è£…

```bash
# å®‰è£… czg å‘½ä»¤è¡Œå·¥å…·
npm install -D czg

# å®‰è£… cz-git é€‚é…å™¨
npm install -D cz-git
```

### 2. é…ç½® package.json

```json
// package.json
"scripts": {
  "commit": "git add -A && czg && git push"
},
"config": {
"commitizen": {
  "path": "node_modules/cz-git"
}
}
```

### 3. é…ç½®äº¤äº’ç•Œé¢

åœ¨ commitlint.config.js ä¸­æ·»åŠ  prompt é…ç½®æ¥è‡ªå®šä¹‰äº¤äº’ç•Œé¢ï¼š

```js
// commitlint.config.js
module.exports = {
  ignores: [commit => commit.includes("init")],
  extends: ["@commitlint/config-conventional"],
  rules: [],
    prompt: {
    messages: {
      type: "é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ :",
      scope: "é€‰æ‹©ä¸€ä¸ªæäº¤èŒƒå›´ï¼ˆå¯é€‰ï¼‰:",
      customScope: "è¯·è¾“å…¥è‡ªå®šä¹‰çš„æäº¤èŒƒå›´ :",
      subject: "å¡«å†™ç®€çŸ­ç²¾ç‚¼çš„å˜æ›´æè¿° :\n",
      body: 'å¡«å†™æ›´åŠ è¯¦ç»†çš„å˜æ›´æè¿°ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n',
      breaking: 'åˆ—ä¸¾éå…¼å®¹æ€§é‡å¤§çš„å˜æ›´ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n',
      footerPrefixsSelect: "é€‰æ‹©å…³è”issueå‰ç¼€ï¼ˆå¯é€‰ï¼‰:",
      customFooterPrefixs: "è¾“å…¥è‡ªå®šä¹‰issueå‰ç¼€ :",
      footer: "åˆ—ä¸¾å…³è”issue (å¯é€‰) ä¾‹å¦‚: #31, #I3244 :\n",
      confirmCommit: "æ˜¯å¦æäº¤æˆ–ä¿®æ”¹commit ?"
    },
    types: [
      { value: "feat", name: "ç‰¹æ€§:   ğŸš€  æ–°å¢åŠŸèƒ½", emoji: "ğŸš€" },
      { value: "fix", name: "ä¿®å¤:   ğŸ§©  ä¿®å¤ç¼ºé™·", emoji: "ğŸ§©" },
      { value: "docs", name: "æ–‡æ¡£:   ğŸ“š  æ–‡æ¡£å˜æ›´", emoji: "ğŸ“š" },
      { value: "style", name: "æ ¼å¼:   ğŸ¨  ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼Œä¾‹å¦‚ç©ºæ ¼ã€åˆ†å·ç­‰æ ¼å¼ä¿®æ­£ï¼‰", emoji: "ğŸ¨" },
      { value: "refactor", name: "é‡æ„:   â™»ï¸  ä»£ç é‡æ„ï¼ˆä¸åŒ…æ‹¬ bug ä¿®å¤ã€åŠŸèƒ½æ–°å¢ï¼‰", emoji: "â™»ï¸" },
      { value: "perf", name: "æ€§èƒ½:    âš¡ï¸  æ€§èƒ½ä¼˜åŒ–", emoji: "âš¡ï¸" },
      { value: "test", name: "æµ‹è¯•:   âœ…  æ·»åŠ ç–æ¼æµ‹è¯•æˆ–å·²æœ‰æµ‹è¯•æ”¹åŠ¨", emoji: "âœ…" },
      { value: "build", name: "æ„å»º:   ğŸ“¦ï¸  æ„å»ºæµç¨‹ã€å¤–éƒ¨ä¾èµ–å˜æ›´ï¼ˆå¦‚å‡çº§ npm åŒ…ã€ä¿®æ”¹ webpack é…ç½®ç­‰ï¼‰", emoji: "ğŸ“¦ï¸" },
      { value: "ci", name: "é›†æˆ:   ğŸ¡  ä¿®æ”¹ CI é…ç½®ã€è„šæœ¬", emoji: "ğŸ¡" },
      { value: "revert", name: "å›é€€:   âªï¸  å›æ»š commit", emoji: "âªï¸" },
      { value: "chore", name: "å…¶ä»–:   ğŸ”¨  å¯¹æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·å’Œåº“çš„æ›´æ”¹ï¼ˆä¸å½±å“æºæ–‡ä»¶ã€æµ‹è¯•ç”¨ä¾‹ï¼‰", emoji: "ğŸ”¨" },
      { value: "wip", name: "å¼€å‘:   ğŸ•”  æ­£åœ¨å¼€å‘ä¸­", emoji: "ğŸ•”" },
      { value: "workflow", name: "å·¥ä½œæµ:   ğŸ“‹  å·¥ä½œæµç¨‹æ”¹è¿›", emoji: "ğŸ“‹" },
      { value: "types", name: "ç±»å‹:   ğŸ”°  ç±»å‹å®šä¹‰æ–‡ä»¶ä¿®æ”¹", emoji: "ğŸ”°" }
    ],
    useEmoji: true,
    scopes: [...scopes],
    customScopesAlign: "bottom",
    emptyScopesAlias: "empty",
    customScopesAlias: "custom",
    allowBreakingChanges: ["feat", "fix"]
  }
```

### 4. æ—¥å¸¸ä½¿ç”¨

æ›¿ä»£åŸæ¥çš„ `git`å‘½ä»¤ï¼Œä½¿ç”¨ï¼š

```bash
npm run commit
```

ä½ ä¼šçœ‹åˆ°äº¤äº’å¼çš„æäº¤ç•Œé¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

1. é€‰æ‹©æäº¤ç±»å‹
![å›¾ç‰‡](/public/assets/reactAdmin/14.png)
2. é€‰æ‹©å½±å“èŒƒå›´
![å›¾ç‰‡](/public/assets/reactAdmin/15.png)
3. å¡«å†™ç®€çŸ­çš„æäº¤ä¿¡æ¯
![å›¾ç‰‡](/public/assets/reactAdmin/16.png)

![å›¾ç‰‡](/public/assets/reactAdmin/13.png)

### 5. æ ‡å‡†å®ä¾‹

è¿™é‡Œåˆ—ä¸¾äº†å®é™…å¼€å‘ä¸­çš„ä¸€äº›æäº¤å®ä¾‹ï¼š

1. æ·»åŠ æ–°åŠŸèƒ½

```bash
npm run commit
# é€‰æ‹© feat
# è¾“å…¥ scope: user
# æè¿°: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½
# æœ€ç»ˆç”Ÿæˆ: feat(user): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½ ğŸš€
```

2. ä¿®å¤bug
```bash
npm run commit
# é€‰æ‹© fix
# è¾“å…¥ scope: auth
# æè¿°: ä¿®å¤ç™»å½•éªŒè¯å¤±è´¥é—®é¢˜
# æœ€ç»ˆç”Ÿæˆ: fix(auth): ä¿®å¤ç™»å½•éªŒè¯å¤±è´¥é—®é¢˜ ğŸ§©
```


## æ€»ç»“


ä»£ç æäº¤æµç¨‹ï¼š

1. æ‰§è¡Œ git commit æ—¶
2. Husky è§¦å‘ pre-commit hook
3. lint-staged æ£€æŸ¥æš‚å­˜åŒºçš„æ–‡ä»¶
4. Commitlint æ£€æŸ¥æäº¤ä¿¡æ¯

äº¤äº’å¼æµç¨‹ï¼š

1. æ‰§è¡Œ npm run commit
2. Commitizen æä¾›äº¤äº’å¼ç•Œé¢
3. ç”Ÿæˆç¬¦åˆ Commitlint è§„èŒƒçš„æäº¤ä¿¡æ¯
4. è§¦å‘ä¸æ™®é€šæäº¤ç›¸åŒçš„æ£€æµ‹æµç¨‹

Git æäº¤è§„èŒƒå¤§ä½“å®ç°æµç¨‹å¦‚ä¸Šæ‰€ç¤ºï¼Œé€šè¿‡å€ŸåŠ©å·¥å…·çº¦æŸæäº¤è¡Œä¸ºï¼Œæœ‰åˆ©äºå›¢é˜Ÿåä½œã€‚


## å‚è€ƒ

- [Husky](https://typicode.github.io/husky/zh/)
- [lint-staged](https://www.npmjs.com/package/lint-staged)
- [Commitlint](https://github.com/conventional-changelog/commitlint)
