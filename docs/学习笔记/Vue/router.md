# Vue路由权限

权限管理是后台管理系统最常见的功能，当用户登录之后动态展示Menu菜单栏。

权限由前端 or 后端来控制？一般情况下，前端实现是根据用户登录后获取role和本地页面的权限作比较，生成用户可访问的路由表；另一种情况是后端根据用户的权限返回可访问的菜单，前端本地路由与后端返回菜单做关联。我司因为有菜单配置和控件权限的业务需求，所以采用了第二张实现方式。

## 页面权限

1. 前端会有一份基础路由表和异步路由表，vue-router挂载基础路由表；
2. 当用户登录后通过token获取用户可访问菜单，与异步路由表进行匹配（三级菜单根据自定义字段进行判断）
3. 调用router.addRoutes动态挂载路由并保存到vuex
4. 调用router.beforeEach注册全局前置守卫，对路由进行登录拦截

## 按钮权限

关于需要按钮级别控制的地方不是很多，通过获取到用户的role之后进行判断。为了减少代码的重复，可以将它封装成一个指令。

## 参考文档：
https://juejin.cn/post/6844903478880370701#heading-3

https://juejin.cn/post/6844903648057622536#heading-9

https://juejin.cn/post/6875597201960075277

## 更新权限

**更新时间：2025/11月/12号**

后管项目主要有2种权限处理方式：

- 1. 第一种是由前端来控制菜单，即服务队只返回有权限的keys，由前端自行去匹配

实现原理：在前端固定写死路由的权限，指定路由有哪些权限可以查看。只初始化通用额路由，需要权限才能访问的路由没有被加入路由表内。在登陆后或者其他方式获取对应的路由keys后，遍历路由表去匹配keys，过滤生成可以访问的路由表，再通过`router.addRoutes`动态添加到路由实例，实现权限的过滤。

缺点：权限相对不自由，因为路由表的控制在前端，不管是要排序还是修改，都需要前端去修改，服务度只提供有权限的路由keys。

- 2. 第二种是通过服务端返回的路由数据结构来动态生成路由表

实现原理：是通过接口动态生成路由表，且遵循一定的数据结构返回。前端根据需要处理该数据为可识别的结构，再通过`router.addRoutes`动态添加到路由实例，实现权限的动态生成。

优点：所有的菜单控制都是通过服务端的接口返回，前端只负责渲染，后期维护成本降低，优先推荐此方式。