# 前端异常捕获

在之前的[前端监控平台](./前端监控平台.md)一文中提到，前端实现异常捕获主要有四种方式，今天深入学习一下。

## try...catch 语句

`try...catch`语句是 JavaScript 中用于捕获和处理异常的语句。它允许你定义一段代码，如果这段代码在执行过程中发生异常，则跳转到 `catch` 块中执行。

```js
try {
  console.log(a);
} catch (error) {
  console.log(error);
}
```

这是最精细的捕获方式，针对性最强。

**捕获范围**：只能捕获其代码块内的同步错误。

**局限性**： 无法捕获异步错误（如setTimeout内的报错，Promise内部报错）

```js
// 1. setTimeout 内的报错无法捕获
try {
  setTimeout(() => {
    // 1秒后执行时，try..catch 已经执行完毕，无法捕获到错误
    console.log(a);
  }, 1000);
} catch (error) {
  // 这里不会被触发
  console.log(error);
}
// 2. Promise 内部报错无法捕获
try {
  new Promise((resolve, reject) => {
    throw new Error('Promise 内部报错');
  });
} catch (error) {
  // 同样无法捕获，除非使用 await
  console.log(error);
}
```

另外需要注意的是，`Sentry`平台也是无法感知到`try...catch`语句的错误。如果想要在后台看到它，可以手动调用`Sentry`的`captureException`方法进行上报。

```js
try {
  console.log(a);
} catch (error) {
  // 手动上报给 Sentry
  Sentry.captureException(error); 
}
```