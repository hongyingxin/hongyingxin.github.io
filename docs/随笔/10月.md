---
sticky: 10
---

# 10月

## react-admin

因为`react-admin`项目需要接口返回数据，就找了一个mock数据的插件。

**vite-plugin-mock**

这是一个基于`vite.js`的数据模拟插件，同时支持本地环境和生产环境。Connect服务中间件在本地使用，mockjs在生产环境中使用。

```ts
viteMockServe({
  mockPath: "src/mock", // mock文件存放目录
  enable: true, // 是否启用mock
  localEnabled: true, // 本地开发环境启用mock
  prodEnabled: true, // 生产环境也启用mock
  supportTs: true, // 打开后，可以读取 ts 文件模块。
  watchFiles: true // 设置是否监视mockPath对应的文件夹内文件中的更改
})
```

这个插件使用起来非常简单，在`vite.config.ts`文件中配置即可，然后设置一下mock文件的存放目录。

开发环境一切顺利，但是我发布到`vercel`后，接口一直为404。查看了文档和issues后，发现`vercel`是静态托管，而`vite-plugin-mock`是基于`node`的，所以无法在`vercel`上使用。

所以我需要找一下其他解决方案。`Mock Service Worker`和`Vercel API 路由`这两个方案看起来比较符合我的需求。

**Mock Service Worker**

`Mock Service Worker (MSW) `是基于 `Service Worker` 的 API 模拟库，用于在浏览器和 Node.js 环境拦截请求并返回模拟响应。

它与环境无关，浏览器和Node.js通用，无需额外适配，并且是通过 `Service Worker` 实现真实请求拦截，而非修改fetch。

这套技术方案看起来非常符合我的需求，但考虑到与vercel的兼容性，我还是选择了后者。

**Vercel API**

Vercel API 路由 是 Vercel 提供的无服务器函数（Serverless Functions）方案，用于在静态托管上创建 API 端点。

它无需维护服务器，按需执行，并且随项目部署自动生效。

使用起来非常简单，只需要在项目根目录创建一个`api`文件夹，然后在文件夹中创建一个`[...vercel].ts`文件，文件中写入以下代码：

```ts
export default function handler(req: NextApiRequest, res: NextApiResponse) {
  res.status(200).json({ message: 'Hello, world!' })
}
```

然后就可以在浏览器中访问`/api/hello`接口，返回`Hello, world!`。

所以我选择了`Vercel API`这个方案。

### 无法共用一套

当我部署了`Vercel API`后，想要测试环境也使用这一套。但当我发起请求时发现，测试环境无法访问到`Vercel API`，请求超时。使用Apifox也是同样的问题。

在`vercel`的控制台也没找到相关的日志，这个问题暂时解决不了。

所以`react-admin`测试环境使用`vite-plugin-mock`，生产环境使用`Vercel API`。

## 10月29日

在使用pnpm和npm安装依赖的时候发现一个问题，我的代码中`2024annual/recall/index.vue`存在一个语法错误，但是npm能够正常打包，而pnpm会报错。

并且我发现两者对`typescript`类型检查的严格程度不同。

pnpm使用符号链接和严格的依赖隔离，TypeScript 类型检查更加严格，不会因为依赖提升而隐藏类型错误。

npm使用扁平化 node_modules 结构，依赖提升（hoisting）可能导致某些类型检查被绕过
，TypeScript 编译器行为可能因依赖树结构而异。


