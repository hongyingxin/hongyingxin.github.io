# Vue é¢è¯•é¢˜è¯¦è§£

> è¿™é‡ŒåŒ…å«æ‰€æœ‰Vueé¢è¯•é¢˜çš„è¯¦ç»†è§£æï¼Œé€‚åˆæ·±å…¥å­¦ä¹ å’ŒæŠ€æœ¯é’»ç ”ã€‚

## ç›®å½•

- [1. Vueä¸­ Scoped Styles æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„ï¼Ÿ](#_1-vueä¸­-scoped-styles-æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„)
- [2. Vue3ä¸­çš„ Teleportæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ](#_2-vue3ä¸­çš„-teleportæ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›åº”ç”¨åœºæ™¯)
- [3. ä¸ºä»€ä¹ˆéœ€è¦Piniaæˆ–è€…Vuexï¼Ÿå¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡ï¼Ÿä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ](#_3-ä¸ºä»€ä¹ˆéœ€è¦piniaæˆ–è€…vuex-å¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·-å¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡-ä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›)
- [4. Vue3çš„ addRoute ä¸ React Router çš„åŠ¨æ€ useRoutes æœ‰ä½•åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜ï¼Ÿ](#_4-vue3çš„-addroute-ä¸-react-router-çš„åŠ¨æ€-useroutes-æœ‰ä½•åŒºåˆ«-å¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜)
- [5. Vue3ä¸­çš„ v-model çš„æ”¹è¿›æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ defineModel ç®€åŒ–ä»£ç ï¼Ÿ](#_5-vue3ä¸­çš„-v-model-çš„æ”¹è¿›æ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨-definemodel-ç®€åŒ–ä»£ç )
- [6. Vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ](#_6-vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ)
- [7. åœ¨Vueä¸­ï¼Œä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œDOMï¼Ÿ](#_7-åœ¨vueä¸­ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œdom)
- [8. template æ ‡ç­¾ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨ v-show ï¼Ÿ](#_8-template-æ ‡ç­¾ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨-v-show)

---

## 1. Vueä¸­ Scoped Styles æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_1-vueä¸­-scoped-styles-æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„-è¯´è¯´å…·ä½“çš„åŸç†)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vueåº•å±‚å®ç°åŸç†çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **ç¼–è¯‘æ—¶å¤„ç†**ï¼šVueå¦‚ä½•åœ¨ç¼–è¯‘é˜¶æ®µå¤„ç†scopedæ ·å¼
2. **è¿è¡Œæ—¶æœºåˆ¶**ï¼šç»„ä»¶å®ä¾‹åŒ–æ—¶å¦‚ä½•åº”ç”¨æ ·å¼éš”ç¦»
3. **æŠ€æœ¯å®ç°**ï¼šå…·ä½“çš„æŠ€æœ¯æ‰‹æ®µå’ŒåŸç†
4. **ä¼˜ç¼ºç‚¹åˆ†æ**ï¼šscopedæ ·å¼çš„ä¼˜åŠ¿å’Œå±€é™æ€§

#### 1. åŸºæœ¬åŸç†

Vueçš„Scoped Stylesæ˜¯åŸºäº**å±æ€§é€‰æ‹©å™¨**çš„æ ·å¼éš”ç¦»æ–¹æ¡ˆï¼Œé€šè¿‡ä¸ºç»„ä»¶ç”Ÿæˆå”¯ä¸€çš„`data-v-xxxxxx`å±æ€§æ¥å®ç°æ ·å¼éš”ç¦»ã€‚

#### 2. å®ç°æœºåˆ¶

**ç¼–è¯‘é˜¶æ®µï¼š**
- Vueç¼–è¯‘å™¨åœ¨å¤„ç†`.vue`æ–‡ä»¶æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªå¸¦æœ‰`scoped`å±æ€§çš„`<style>`æ ‡ç­¾ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸ŒID
- ä½¿ç”¨PostCSSè§£æCSSï¼Œéå†ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œä¸ºæ¯ä¸ªCSSé€‰æ‹©å™¨æ·»åŠ `[data-v-xxxxxx]`å±æ€§é€‰æ‹©å™¨
- å“ˆå¸ŒIDåŸºäºç»„ä»¶æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ç”Ÿæˆï¼Œç¡®ä¿å”¯ä¸€æ€§

**è¿è¡Œæ—¶é˜¶æ®µï¼š**
- Vueåœ¨æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œä¸ºç»„ä»¶çš„æ ¹å…ƒç´ å’Œæ‰€æœ‰å­å…ƒç´ æ·»åŠ å¯¹åº”çš„`data-v-xxxxxx`å±æ€§
- æµè§ˆå™¨æ ¹æ®CSSé€‰æ‹©å™¨è§„åˆ™ï¼Œåªæœ‰åŒæ—¶åŒ¹é…ç±»åå’Œå±æ€§é€‰æ‹©å™¨çš„å…ƒç´ æ‰ä¼šåº”ç”¨æ ·å¼

#### 3. å…·ä½“ç¤ºä¾‹

**ç¼–è¯‘å‰ï¼š**
```vue
<template>
  <div class="container">
    <h1 class="title">Hello World</h1>
  </div>
</template>

<style scoped>
.container {
  padding: 20px;
}
.title {
  color: red;
}
</style>
```

**ç¼–è¯‘åï¼š**
```html
<!-- æ¨¡æ¿ -->
<div class="container" data-v-f3f3eg9>
  <h1 class="title" data-v-f3f3eg9>Hello World</h1>
</div>

<!-- æ ·å¼ -->
<style>
.container[data-v-f3f3eg9] {
  padding: 20px;
}
.title[data-v-f3f3eg9] {
  color: red;
}
</style>
```

#### 4. æºç å®ç°å…³é”®ç‚¹

**é€‰æ‹©å™¨è½¬æ¢ï¼š**
```javascript
// ç®€åŒ–ç‰ˆå®ç°
export function addScopedIdToSelector(id, selector) {
  return selector.replace(/^(\w+)/, `$1[data-v-${id}]`)
}
```

**å±æ€§æ·»åŠ ï¼š**
```javascript
// ä¸ºå…ƒç´ æ·»åŠ scopedå±æ€§
function addScopedAttr(el, id) {
  el.attrsMap['data-v-' + id] = ''
  el.attrsList.push({ name: 'data-v-' + id, value: '' })
}
```

#### 5. ä¼˜åŠ¿ä¸å±€é™æ€§

**ä¼˜åŠ¿ï¼š**
- âœ… æœ‰æ•ˆé˜²æ­¢æ ·å¼å†²çª
- âœ… æé«˜ç»„ä»¶ç‹¬ç«‹æ€§å’Œå¯ç»´æŠ¤æ€§
- âœ… æ— éœ€é¢å¤–çš„CSSå‘½åè§„èŒƒ
- âœ… ä¸ç°æœ‰CSSè¯­æ³•å®Œå…¨å…¼å®¹

**å±€é™æ€§ï¼š**
- âŒ è½»å¾®çš„æ€§èƒ½å¼€é”€ï¼ˆå±æ€§é€‰æ‹©å™¨ï¼‰
- âŒ æ— æ³•ç›´æ¥ä¿®æ”¹å­ç»„ä»¶æ ·å¼
- âŒ è°ƒè¯•æ—¶ç±»åä¸å¤Ÿç›´è§‚
- âŒ ä¸èƒ½ä½¿ç”¨å…¨å±€æ ·å¼åº“çš„ç±»

#### 6. æ·±åº¦é€‰æ‹©å™¨è§£å†³æ–¹æ¡ˆ

å½“éœ€è¦ä¿®æ”¹å­ç»„ä»¶æ ·å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦é€‰æ‹©å™¨ï¼š

```vue
<style scoped>
/* Vue 3 */
.parent :deep(.child) {
  color: red;
}

/* Vue 2 */
.parent /deep/ .child {
  color: red;
}

.parent >>> .child {
  color: red;
}
</style>
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **CSS Moduleså¯¹æ¯”**ï¼šCSS Modulesé€šè¿‡ç±»åå“ˆå¸ŒåŒ–å®ç°éš”ç¦»ï¼Œè€ŒScoped Stylesé€šè¿‡å±æ€§é€‰æ‹©å™¨å®ç°
2. **æ€§èƒ½è€ƒè™‘**ï¼šå±æ€§é€‰æ‹©å™¨çš„æ€§èƒ½ç•¥ä½äºç±»é€‰æ‹©å™¨ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å½±å“å¾®ä¹å…¶å¾®
3. **SSRæ”¯æŒ**ï¼šScoped Stylesåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­åŒæ ·æœ‰æ•ˆ
4. **æ„å»ºä¼˜åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ä¼šå‹ç¼©å“ˆå¸ŒIDé•¿åº¦ä»¥å‡å°‘åŒ…ä½“ç§¯

---

## 2. Vue3ä¸­çš„ Teleportæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_2-vue3ä¸­çš„-teleportæ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›åº”ç”¨åœºæ™¯)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue3æ–°ç‰¹æ€§çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¦‚å¿µç†è§£**ï¼šTeleportçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
2. **å®ç°åŸç†**ï¼šå¦‚ä½•å®ç°DOMæ¸²æŸ“ä½ç½®ä¸é€»è¾‘å½’å±çš„åˆ†ç¦»
3. **åº”ç”¨åœºæ™¯**ï¼šå®é™…å¼€å‘ä¸­çš„ä½¿ç”¨åœºæ™¯å’Œè§£å†³çš„é—®é¢˜
4. **æŠ€æœ¯å¯¹æ¯”**ï¼šä¸ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿

#### 1. åŸºæœ¬æ¦‚å¿µ

Teleportï¼ˆä¼ é€é—¨ï¼‰æ˜¯Vue3å¼•å…¥çš„å†…ç½®ç»„ä»¶ï¼Œå…è®¸æˆ‘ä»¬å°†ç»„ä»¶æ¨¡æ¿çš„ä¸€éƒ¨åˆ†"ä¼ é€"åˆ°DOMä¸­çš„ä»»æ„ä½ç½®ï¼Œè€Œä¸æ”¹å˜ç»„ä»¶çš„é€»è¾‘å±‚çº§å…³ç³»ã€‚

#### 2. æ ¸å¿ƒç‰¹æ€§

**é€»è¾‘ä¸æ¸²æŸ“åˆ†ç¦»ï¼š**
- ç»„ä»¶çš„çŠ¶æ€ã€äº‹ä»¶å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸç­‰é€»è¾‘ä»ç„¶å±äºåŸç»„ä»¶æ ‘
- åªæœ‰DOMæ¸²æŸ“ä½ç½®å‘ç”Ÿæ”¹å˜
- ä¿æŒäº†Vueçš„å“åº”å¼ç³»ç»Ÿå’Œç»„ä»¶é€šä¿¡æœºåˆ¶

#### 3. åŸºæœ¬ç”¨æ³•

```vue
<template>
  <div class="container">
    <h1>æˆ‘çš„ç»„ä»¶</h1>
    
    <!-- å°†æ¨¡æ€æ¡†ä¼ é€åˆ° body ä¸‹ -->
    <Teleport to="body">
      <div class="modal" v-if="showModal">
        <div class="modal-content">
          <h2>æ¨¡æ€æ¡†æ ‡é¢˜</h2>
          <p>è¿™ä¸ªæ¨¡æ€æ¡†è¢«æ¸²æŸ“åˆ°äº† body ä¸‹</p>
          <button @click="showModal = false">å…³é—­</button>
        </div>
      </div>
    </Teleport>
    
    <button @click="showModal = true">æ‰“å¼€æ¨¡æ€æ¡†</button>
  </div>
</template>

<script setup>
import { ref } from 'vue'
const showModal = ref(false)
</script>
```

#### 4. å®ç°åŸç†

**ç¼–è¯‘æ—¶å¤„ç†ï¼š**
- Vueç¼–è¯‘å™¨è¯†åˆ«`<Teleport>`æ ‡ç­¾
- å°†å…¶å†…å®¹æ ‡è®°ä¸ºéœ€è¦ç‰¹æ®Šå¤„ç†çš„èŠ‚ç‚¹
- ç”Ÿæˆç‰¹æ®Šçš„æ¸²æŸ“å‡½æ•°

**è¿è¡Œæ—¶æœºåˆ¶ï¼š**
```javascript
// ç®€åŒ–çš„å®ç°åŸç†
function renderTeleport(vnode, container) {
  const { to, children } = vnode.props
  const target = document.querySelector(to)
  
  if (target) {
    // å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ°ç›®æ ‡ä½ç½®
    render(children, target)
  }
}
```

#### 5. è¯¦ç»†åº”ç”¨åœºæ™¯

##### 5.1 æ¨¡æ€æ¡†/å¯¹è¯æ¡†
```vue
<template>
  <Teleport to="body">
    <div class="modal-overlay" v-if="visible" @click="close">
      <div class="modal" @click.stop>
        <slot></slot>
      </div>
    </div>
  </Teleport>
</template>

<style scoped>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}
</style>
```

##### 5.2 Toasté€šçŸ¥ç»„ä»¶
```vue
<template>
  <Teleport to="#toast-container">
    <Transition name="toast">
      <div class="toast" v-if="visible">
        {{ message }}
      </div>
    </Transition>
  </Teleport>
</template>
```

##### 5.3 ä¸‹æ‹‰èœå•
```vue
<template>
  <div class="dropdown" ref="triggerRef">
    <button @click="toggle">ä¸‹æ‹‰èœå•</button>
    
    <Teleport to="body">
      <div 
        class="dropdown-menu" 
        v-if="visible"
        :style="menuStyle"
      >
        <slot></slot>
      </div>
    </Teleport>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const triggerRef = ref()
const visible = ref(false)

const menuStyle = computed(() => {
  if (!triggerRef.value) return {}
  
  const rect = triggerRef.value.getBoundingClientRect()
  return {
    position: 'absolute',
    top: rect.bottom + 'px',
    left: rect.left + 'px'
  }
})
</script>
```

#### 6. é«˜çº§ç‰¹æ€§

##### 6.1 æ¡ä»¶ä¼ é€
```vue
<template>
  <Teleport :to="isMobile ? 'body' : '.desktop-container'">
    <MyComponent />
  </Teleport>
</template>
```

##### 6.2 ç¦ç”¨ä¼ é€
```vue
<template>
  <Teleport to="body" :disabled="!shouldTeleport">
    <MyComponent />
  </Teleport>
</template>
```

##### 6.3 å¤šä¸ªTeleportåˆ°åŒä¸€ç›®æ ‡
```vue
<!-- å¤šä¸ªç»„ä»¶å¯ä»¥ä¼ é€åˆ°åŒä¸€ä¸ªå®¹å™¨ -->
<Teleport to="#modals">
  <Modal1 />
</Teleport>

<Teleport to="#modals">
  <Modal2 />
</Teleport>
```

#### 7. ä¸ä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”

**ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜ï¼š**
- ä½¿ç”¨`document.body.appendChild`ç ´åäº†Vueçš„å“åº”å¼ç³»ç»Ÿ
- éœ€è¦æ‰‹åŠ¨ç®¡ç†DOMèŠ‚ç‚¹çš„åˆ›å»ºå’Œé”€æ¯
- äº‹ä»¶å¤„ç†å’ŒçŠ¶æ€ç®¡ç†å¤æ‚
- ç»„ä»¶å¸è½½æ—¶å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼

**Teleportä¼˜åŠ¿ï¼š**
- ä¿æŒVueçš„å“åº”å¼å’Œç»„ä»¶ç³»ç»Ÿå®Œæ•´æ€§
- è‡ªåŠ¨å¤„ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
- ç®€åŒ–äº‹ä»¶å¤„ç†å’ŒçŠ¶æ€ç®¡ç†
- æ›´å¥½çš„TypeScriptæ”¯æŒ

#### 8. æ³¨æ„äº‹é¡¹

1. **ç›®æ ‡å…ƒç´ å­˜åœ¨æ€§**ï¼šç¡®ä¿`to`æŒ‡å®šçš„å…ƒç´ åœ¨DOMä¸­å­˜åœ¨
2. **SSRå…¼å®¹æ€§**ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†
3. **æ ·å¼ä½œç”¨åŸŸ**ï¼šTeleportå†…å®¹çš„æ ·å¼å¯èƒ½ä¸å—çˆ¶ç»„ä»¶scopedæ ·å¼å½±å“
4. **äº‹ä»¶å†’æ³¡**ï¼šäº‹ä»¶ä»ç„¶ä¼šæŒ‰ç…§é€»è¾‘ç»„ä»¶æ ‘å†’æ³¡ï¼Œè€Œä¸æ˜¯DOMæ ‘

#### 9. æ‰©å±•çŸ¥è¯†ç‚¹

1. **React Portalå¯¹æ¯”**ï¼šTeleportç±»ä¼¼äºReactçš„Portalï¼Œä½†ä¿æŒäº†Vueçš„å“åº”å¼ç‰¹æ€§
2. **æ€§èƒ½è€ƒè™‘**ï¼šTeleportä¸ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºåªæ˜¯æ”¹å˜äº†æ¸²æŸ“ä½ç½®
3. **è°ƒè¯•æŠ€å·§**ï¼šVue DevToolsä¸­ä»ç„¶æŒ‰ç…§é€»è¾‘ç»„ä»¶æ ‘æ˜¾ç¤º
4. **å…¼å®¹æ€§**ï¼šVue3ç‹¬æœ‰ç‰¹æ€§ï¼ŒVue2éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°ç±»ä¼¼åŠŸèƒ½

---

## 3. ä¸ºä»€ä¹ˆéœ€è¦Piniaæˆ–è€…Vuexï¼Ÿå¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡ï¼Ÿä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_3-ä¸ºä»€ä¹ˆéœ€è¦piniaæˆ–è€…vuex-å¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·-å¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡-ä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥VueçŠ¶æ€ç®¡ç†å’Œç»„ä»¶é€šä¿¡çš„ç»¼åˆæ€§é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **çŠ¶æ€ç®¡ç†å¿…è¦æ€§**ï¼šç†è§£ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†å·¥å…·
2. **ç»„ä»¶é€šä¿¡æ–¹æ¡ˆ**ï¼šæŒæ¡å„ç§è·¨ç»„ä»¶é€šä¿¡çš„æ–¹æ³•
3. **æ–¹æ¡ˆå¯¹æ¯”**ï¼šäº†è§£ä¸åŒæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯
4. **æŠ€æœ¯é€‰å‹**ï¼šèƒ½å¤Ÿæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ

#### 1. ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†å·¥å…·

##### 1.1 åº”ç”¨å¤æ‚åº¦é—®é¢˜

**å°å‹åº”ç”¨ï¼š**
```vue
<!-- ç®€å•çš„çˆ¶å­ç»„ä»¶é€šä¿¡ -->
<template>
  <ChildComponent :count="count" @increment="count++" />
</template>
```

**å¤æ‚åº”ç”¨é—®é¢˜ï¼š**
```vue
<!-- å¤šå±‚åµŒå¥—çš„prop drillingé—®é¢˜ -->
<template>
  <GrandParent>
    <Parent :user="user" :theme="theme" :permissions="permissions">
      <Child :user="user" :theme="theme">
        <GrandChild :user="user" />
      </Child>
    </Parent>
  </GrandParent>
</template>
```

##### 1.2 çŠ¶æ€ç®¡ç†ç—›ç‚¹

1. **Prop Drilling**ï¼šæ•°æ®éœ€è¦å±‚å±‚ä¼ é€’ï¼Œä¸­é—´ç»„ä»¶ä¸éœ€è¦ä½†å¿…é¡»æ¥æ”¶
2. **çŠ¶æ€åŒæ­¥**ï¼šå¤šä¸ªç»„ä»¶éœ€è¦åŒæ­¥åŒä¸€ä»½æ•°æ®
3. **çŠ¶æ€æŒä¹…åŒ–**ï¼šé¡µé¢åˆ·æ–°åçŠ¶æ€ä¸¢å¤±
4. **è°ƒè¯•å›°éš¾**ï¼šçŠ¶æ€å˜åŒ–éš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•

#### 2. ä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†çš„è·¨ç»„ä»¶é€šä¿¡æ–¹æ¡ˆ

##### 2.1 Props/Emitï¼ˆçˆ¶å­é€šä¿¡ï¼‰

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <ChildComponent 
    :message="parentMessage" 
    @child-event="handleChildEvent" 
  />
</template>

<script setup>
import { ref } from 'vue'

const parentMessage = ref('Hello from parent')
const handleChildEvent = (data) => {
  console.log('æ”¶åˆ°å­ç»„ä»¶æ•°æ®:', data)
}
</script>
```

```vue
<!-- å­ç»„ä»¶ -->
<template>
  <div>
    <p>{{ message }}</p>
    <button @click="sendToParent">å‘é€ç»™çˆ¶ç»„ä»¶</button>
  </div>
</template>

<script setup>
const props = defineProps(['message'])
const emit = defineEmits(['child-event'])

const sendToParent = () => {
  emit('child-event', 'Hello from child')
}
</script>
```

**ä¼˜ç‚¹ï¼š** ç®€å•ç›´æ¥ï¼ŒVueå®˜æ–¹æ¨è
**ç¼ºç‚¹ï¼š** å¤šå±‚åµŒå¥—æ—¶éœ€è¦å±‚å±‚ä¼ é€’

##### 2.2 Provide/Injectï¼ˆç¥–å…ˆåä»£é€šä¿¡ï¼‰

```vue
<!-- ç¥–å…ˆç»„ä»¶ -->
<template>
  <div>
    <button @click="updateTheme">åˆ‡æ¢ä¸»é¢˜</button>
    <ChildComponent />
  </div>
</template>

<script setup>
import { ref, provide } from 'vue'

const theme = ref('light')
const updateTheme = () => {
  theme.value = theme.value === 'light' ? 'dark' : 'light'
}

// æä¾›æ•°æ®å’Œæ–¹æ³•
provide('theme', theme)
provide('updateTheme', updateTheme)
</script>
```

```vue
<!-- åä»£ç»„ä»¶ -->
<template>
  <div :class="theme">
    <p>å½“å‰ä¸»é¢˜: {{ theme }}</p>
    <button @click="updateTheme">æ”¹å˜ä¸»é¢˜</button>
  </div>
</template>

<script setup>
import { inject } from 'vue'

const theme = inject('theme')
const updateTheme = inject('updateTheme')
</script>
```

**ä¼˜ç‚¹ï¼š** é¿å…prop drillingï¼Œæ”¯æŒå“åº”å¼
**ç¼ºç‚¹ï¼š** éšå¼ä¾èµ–ï¼Œéš¾ä»¥è¿½è¸ªæ•°æ®æ¥æº

##### 2.3 Event Busï¼ˆå…¨å±€äº‹ä»¶æ€»çº¿ï¼‰

```javascript
// eventBus.js
import { ref } from 'vue'

class EventBus {
  constructor() {
    this.events = {}
  }

  on(event, callback) {
    if (!this.events[event]) {
      this.events[event] = []
    }
    this.events[event].push(callback)
  }

  emit(event, data) {
    if (this.events[event]) {
      this.events[event].forEach(callback => callback(data))
    }
  }

  off(event, callback) {
    if (this.events[event]) {
      this.events[event] = this.events[event].filter(cb => cb !== callback)
    }
  }
}

export const eventBus = new EventBus()
```

```vue
<!-- ç»„ä»¶A -->
<template>
  <button @click="sendMessage">å‘é€æ¶ˆæ¯</button>
</template>

<script setup>
import { eventBus } from './eventBus'

const sendMessage = () => {
  eventBus.emit('user-message', { text: 'Hello from A' })
}
</script>
```

```vue
<!-- ç»„ä»¶B -->
<template>
  <div>{{ message }}</div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { eventBus } from './eventBus'

const message = ref('')

const handleMessage = (data) => {
  message.value = data.text
}

onMounted(() => {
  eventBus.on('user-message', handleMessage)
})

onUnmounted(() => {
  eventBus.off('user-message', handleMessage)
})
</script>
```

**ä¼˜ç‚¹ï¼š** ä»»æ„ç»„ä»¶é—´é€šä¿¡ï¼Œä½¿ç”¨ç®€å•
**ç¼ºç‚¹ï¼š** éš¾ä»¥è°ƒè¯•ï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼

##### 2.4 å…¨å±€å˜é‡/Reactive

```javascript
// globalState.js
import { reactive } from 'vue'

export const globalState = reactive({
  user: null,
  theme: 'light',
  count: 0,
  
  // æ–¹æ³•
  setUser(user) {
    this.user = user
  },
  
  toggleTheme() {
    this.theme = this.theme === 'light' ? 'dark' : 'light'
  },
  
  increment() {
    this.count++
  }
})
```

```vue
<!-- ä»»æ„ç»„ä»¶ -->
<template>
  <div>
    <p>ç”¨æˆ·: {{ globalState.user?.name }}</p>
    <p>ä¸»é¢˜: {{ globalState.theme }}</p>
    <p>è®¡æ•°: {{ globalState.count }}</p>
    <button @click="globalState.increment()">å¢åŠ </button>
  </div>
</template>

<script setup>
import { globalState } from './globalState'
</script>
```

**ä¼˜ç‚¹ï¼š** ç®€å•ç›´æ¥ï¼Œå…¨å±€è®¿é—®
**ç¼ºç‚¹ï¼š** ç ´åç»„ä»¶å°è£…æ€§ï¼Œéš¾ä»¥æµ‹è¯•

#### 3. çŠ¶æ€ç®¡ç†å·¥å…·çš„ä¼˜åŠ¿

##### 3.1 Piniaç¤ºä¾‹

```javascript
// stores/user.js
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    user: null,
    isLoggedIn: false
  }),
  
  getters: {
    userName: (state) => state.user?.name || 'Guest',
    userRole: (state) => state.user?.role || 'visitor'
  },
  
  actions: {
    async login(credentials) {
      try {
        const user = await api.login(credentials)
        this.user = user
        this.isLoggedIn = true
      } catch (error) {
        throw error
      }
    },
    
    logout() {
      this.user = null
      this.isLoggedIn = false
    }
  }
})
```

```vue
<!-- ç»„ä»¶ä¸­ä½¿ç”¨ -->
<template>
  <div>
    <p v-if="userStore.isLoggedIn">
      æ¬¢è¿, {{ userStore.userName }}!
    </p>
    <button @click="handleLogin" v-else>ç™»å½•</button>
  </div>
</template>

<script setup>
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

const handleLogin = async () => {
  try {
    await userStore.login({ username: 'admin', password: '123' })
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error)
  }
}
</script>
```

##### 3.2 çŠ¶æ€ç®¡ç†å·¥å…·ä¼˜åŠ¿

1. **å¯é¢„æµ‹æ€§**ï¼šçŠ¶æ€å˜åŒ–æœ‰æ˜ç¡®çš„è§„åˆ™å’Œæµç¨‹
2. **è°ƒè¯•å‹å¥½**ï¼šVue DevToolsæ”¯æŒæ—¶é—´æ—…è¡Œè°ƒè¯•
3. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptæ”¯æŒ
4. **æ’ä»¶ç”Ÿæ€**ï¼šæŒä¹…åŒ–ã€åŒæ­¥ç­‰æ’ä»¶ä¸°å¯Œ
5. **æµ‹è¯•å‹å¥½**ï¼šçŠ¶æ€å’Œé€»è¾‘åˆ†ç¦»ï¼Œä¾¿äºå•å…ƒæµ‹è¯•

#### 4. æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| Props/Emit | ç®€å•çˆ¶å­é€šä¿¡ | å®˜æ–¹æ¨èï¼Œç±»å‹å®‰å…¨ | å¤šå±‚åµŒå¥—ç¹ç |
| Provide/Inject | ç¥–å…ˆåä»£é€šä¿¡ | é¿å…prop drilling | éšå¼ä¾èµ– |
| Event Bus | ä»»æ„ç»„ä»¶é€šä¿¡ | ä½¿ç”¨ç®€å• | éš¾è°ƒè¯•ï¼Œæ˜“æ³„æ¼ |
| å…¨å±€å˜é‡ | ç®€å•å…¨å±€çŠ¶æ€ | ç›´æ¥è®¿é—® | ç ´åå°è£…æ€§ |
| Pinia/Vuex | å¤æ‚çŠ¶æ€ç®¡ç† | å¯é¢„æµ‹ï¼Œè°ƒè¯•å‹å¥½ | å­¦ä¹ æˆæœ¬ |

#### 5. é€‰æ‹©å»ºè®®

##### 5.1 å°å‹é¡¹ç›®ï¼ˆ<10ä¸ªç»„ä»¶ï¼‰
- ä¸»è¦ä½¿ç”¨Props/Emit
- å°‘é‡Provide/Injectå¤„ç†æ·±å±‚ä¼ é€’

##### 5.2 ä¸­å‹é¡¹ç›®ï¼ˆ10-50ä¸ªç»„ä»¶ï¼‰
- æ ¸å¿ƒçŠ¶æ€ä½¿ç”¨Pinia
- å±€éƒ¨çŠ¶æ€ä»ç”¨Props/Emit
- é¿å…Event Bus

##### 5.3 å¤§å‹é¡¹ç›®ï¼ˆ>50ä¸ªç»„ä»¶ï¼‰
- å¿…é¡»ä½¿ç”¨Pinia/Vuex
- å»ºç«‹æ¸…æ™°çš„çŠ¶æ€ç®¡ç†è§„èŒƒ
- é…åˆTypeScriptå¢å¼ºç±»å‹å®‰å…¨

#### 6. ç°ä»£æ›¿ä»£æ–¹æ¡ˆ

##### 6.1 Composition API + Composables

```javascript
// composables/useUser.js
import { ref, computed } from 'vue'

const user = ref(null)
const isLoggedIn = computed(() => !!user.value)

export function useUser() {
  const login = async (credentials) => {
    user.value = await api.login(credentials)
  }
  
  const logout = () => {
    user.value = null
  }
  
  return {
    user: readonly(user),
    isLoggedIn,
    login,
    logout
  }
}
```

##### 6.2 Vue 3.3+ defineModel

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <ChildComponent v-model:count="count" />
</template>

<!-- å­ç»„ä»¶ -->
<script setup>
const count = defineModel('count', { default: 0 })
</script>
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **Pinia vs Vuex**ï¼šPiniaæ›´è½»é‡ï¼Œæ›´å¥½çš„TypeScriptæ”¯æŒï¼ŒVue3å®˜æ–¹æ¨è
2. **çŠ¶æ€æŒä¹…åŒ–**ï¼šä½¿ç”¨æ’ä»¶å®ç°localStorage/sessionStorageæŒä¹…åŒ–
3. **SSRè€ƒè™‘**ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶çš„çŠ¶æ€åŒæ­¥é—®é¢˜
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†æ‹†åˆ†storeï¼Œé¿å…ä¸å¿…è¦çš„å“åº”å¼æ›´æ–°

---

## 4. Vue3çš„ addRoute ä¸ React Router çš„åŠ¨æ€ useRoutes æœ‰ä½•åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_4-vue3çš„-addroute-ä¸-react-router-çš„åŠ¨æ€-useroutes-æœ‰ä½•åŒºåˆ«-å¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥å‰ç«¯è·¯ç”±ç³»ç»Ÿæ·±åº¦ç†è§£çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¡†æ¶å·®å¼‚**ï¼šVue Routerä¸React Routerçš„è®¾è®¡ç†å¿µå·®å¼‚
2. **åŠ¨æ€è·¯ç”±å®ç°**ï¼šä¸¤ç§æ¡†æ¶å¤„ç†åŠ¨æ€è·¯ç”±çš„ä¸åŒæœºåˆ¶
3. **çŠ¶æ€ç®¡ç†**ï¼šè·¯ç”±çŠ¶æ€çš„æŒä¹…åŒ–å’Œæ¢å¤ç­–ç•¥
4. **å®é™…åº”ç”¨**ï¼šæƒé™è·¯ç”±ã€èœå•åŠ¨æ€åŠ è½½ç­‰å®é™…åœºæ™¯

#### 1. Vue Router addRoute è¯¦è§£

##### 1.1 åŸºæœ¬ç”¨æ³•

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      name: 'Home',
      component: () => import('@/views/Home.vue')
    }
  ]
})

// åŠ¨æ€æ·»åŠ è·¯ç”±
const addDynamicRoute = (routeConfig) => {
  router.addRoute(routeConfig)
}

// æ·»åŠ åµŒå¥—è·¯ç”±
const addNestedRoute = (parentName, childRoute) => {
  router.addRoute(parentName, childRoute)
}

export { router, addDynamicRoute, addNestedRoute }
```

##### 1.2 æƒé™è·¯ç”±å®ç°

```javascript
// utils/permission.js
import { router } from '@/router'
import { useUserStore } from '@/stores/user'

// å¼‚æ­¥è·¯ç”±é…ç½®
const asyncRoutes = [
  {
    path: '/admin',
    name: 'Admin',
    component: () => import('@/layouts/AdminLayout.vue'),
    meta: { roles: ['admin'] },
    children: [
      {
        path: 'users',
        name: 'UserManagement',
        component: () => import('@/views/admin/Users.vue'),
        meta: { roles: ['admin'] }
      },
      {
        path: 'settings',
        name: 'SystemSettings',
        component: () => import('@/views/admin/Settings.vue'),
        meta: { roles: ['admin', 'manager'] }
      }
    ]
  },
  {
    path: '/manager',
    name: 'Manager',
    component: () => import('@/layouts/ManagerLayout.vue'),
    meta: { roles: ['manager'] },
    children: [
      {
        path: 'reports',
        name: 'Reports',
        component: () => import('@/views/manager/Reports.vue'),
        meta: { roles: ['manager'] }
      }
    ]
  }
]

// æ ¹æ®ç”¨æˆ·è§’è‰²è¿‡æ»¤è·¯ç”±
function filterAsyncRoutes(routes, roles) {
  const filteredRoutes = []
  
  routes.forEach(route => {
    const tmp = { ...route }
    
    if (hasPermission(roles, tmp)) {
      if (tmp.children) {
        tmp.children = filterAsyncRoutes(tmp.children, roles)
      }
      filteredRoutes.push(tmp)
    }
  })
  
  return filteredRoutes
}

function hasPermission(roles, route) {
  if (route.meta && route.meta.roles) {
    return roles.some(role => route.meta.roles.includes(role))
  }
  return true
}

// åŠ¨æ€æ·»åŠ è·¯ç”±
export function addRoutes(roles) {
  const accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)
  
  accessedRoutes.forEach(route => {
    router.addRoute(route)
  })
  
  // å­˜å‚¨åˆ°æœ¬åœ°ï¼Œè§£å†³åˆ·æ–°é—®é¢˜
  localStorage.setItem('dynamicRoutes', JSON.stringify(accessedRoutes))
  
  return accessedRoutes
}
```

##### 1.3 è·¯ç”±å®ˆå«é›†æˆ

```javascript
// router/guards.js
import { router } from '@/router'
import { useUserStore } from '@/stores/user'
import { addRoutes } from '@/utils/permission'

router.beforeEach(async (to, from, next) => {
  const userStore = useUserStore()
  
  if (userStore.token) {
    if (to.path === '/login') {
      next({ path: '/' })
    } else {
      // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ åŠ¨æ€è·¯ç”±
      if (!userStore.hasAddedRoutes) {
        try {
          // è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
          await userStore.getUserInfo()
          
          // æ·»åŠ åŠ¨æ€è·¯ç”±
          const accessRoutes = addRoutes(userStore.roles)
          userStore.setAddedRoutes(true)
          
          // é‡æ–°å¯¼èˆªåˆ°ç›®æ ‡è·¯ç”±
          next({ ...to, replace: true })
        } catch (error) {
          // è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬ç™»å½•
          userStore.resetToken()
          next('/login')
        }
      } else {
        next()
      }
    }
  } else {
    // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
    if (to.path !== '/login') {
      next('/login')
    } else {
      next()
    }
  }
})
```

#### 2. React Router useRoutes è¯¦è§£

##### 2.1 åŸºæœ¬ç”¨æ³•

```jsx
// App.jsx
import { useRoutes, Navigate } from 'react-router-dom'
import { useSelector } from 'react-redux'
import { useMemo } from 'react'

function App() {
  const { user, permissions } = useSelector(state => state.auth)
  
  // åŸºç¡€è·¯ç”±é…ç½®
  const baseRoutes = [
    {
      path: '/',
      element: <Navigate to="/dashboard" replace />
    },
    {
      path: '/login',
      element: <Login />
    },
    {
      path: '/dashboard',
      element: <Dashboard />
    }
  ]
  
  // åŠ¨æ€è·¯ç”±é…ç½®
  const dynamicRoutes = useMemo(() => {
    if (!user || !permissions.length) return []
    
    const routes = []
    
    if (permissions.includes('admin')) {
      routes.push({
        path: '/admin',
        element: <AdminLayout />,
        children: [
          {
            path: 'users',
            element: <UserManagement />
          },
          {
            path: 'settings',
            element: <SystemSettings />
          }
        ]
      })
    }
    
    if (permissions.includes('manager')) {
      routes.push({
        path: '/manager',
        element: <ManagerLayout />,
        children: [
          {
            path: 'reports',
            element: <Reports />
          }
        ]
      })
    }
    
    return routes
  }, [user, permissions])
  
  // åˆå¹¶è·¯ç”±é…ç½®
  const routes = useMemo(() => {
    return [...baseRoutes, ...dynamicRoutes]
  }, [dynamicRoutes])
  
  const element = useRoutes(routes)
  
  return element
}
```

##### 2.2 æƒé™è·¯ç”±Hook

```jsx
// hooks/usePermissionRoutes.js
import { useMemo } from 'react'
import { useSelector } from 'react-redux'

// è·¯ç”±é…ç½®æ˜ å°„
const routeConfigs = {
  admin: [
    {
      path: '/admin',
      element: <AdminLayout />,
      children: [
        { path: 'users', element: <UserManagement /> },
        { path: 'settings', element: <SystemSettings /> }
      ]
    }
  ],
  manager: [
    {
      path: '/manager',
      element: <ManagerLayout />,
      children: [
        { path: 'reports', element: <Reports /> }
      ]
    }
  ],
  user: [
    {
      path: '/profile',
      element: <UserProfile />
    }
  ]
}

export function usePermissionRoutes() {
  const { user, roles } = useSelector(state => state.auth)
  
  const permissionRoutes = useMemo(() => {
    if (!user || !roles.length) return []
    
    return roles.reduce((acc, role) => {
      const roleRoutes = routeConfigs[role] || []
      return [...acc, ...roleRoutes]
    }, [])
  }, [user, roles])
  
  return permissionRoutes
}
```

##### 2.3 è·¯ç”±æŒä¹…åŒ–å¤„ç†

```jsx
// components/RouteProvider.jsx
import { useEffect, useState } from 'react'
import { useRoutes } from 'react-router-dom'
import { useDispatch, useSelector } from 'react-redux'
import { restoreUserSession } from '@/store/authSlice'

function RouteProvider({ children }) {
  const dispatch = useDispatch()
  const { isInitialized, user } = useSelector(state => state.auth)
  const [routes, setRoutes] = useState([])
  
  // åº”ç”¨åˆå§‹åŒ–æ—¶æ¢å¤ç”¨æˆ·ä¼šè¯
  useEffect(() => {
    const initializeApp = async () => {
      try {
        // ä»localStorageæ¢å¤ç”¨æˆ·ä¿¡æ¯
        const savedUser = localStorage.getItem('user')
        const savedPermissions = localStorage.getItem('permissions')
        
        if (savedUser && savedPermissions) {
          await dispatch(restoreUserSession({
            user: JSON.parse(savedUser),
            permissions: JSON.parse(savedPermissions)
          }))
        }
      } catch (error) {
        console.error('Failed to restore user session:', error)
      }
    }
    
    initializeApp()
  }, [dispatch])
  
  // æ ¹æ®ç”¨æˆ·çŠ¶æ€åŠ¨æ€ç”Ÿæˆè·¯ç”±
  useEffect(() => {
    if (isInitialized) {
      const dynamicRoutes = generateRoutes(user)
      setRoutes(dynamicRoutes)
    }
  }, [isInitialized, user])
  
  const element = useRoutes(routes)
  
  if (!isInitialized) {
    return <LoadingSpinner />
  }
  
  return element
}
```

#### 3. æ ¸å¿ƒå·®å¼‚å¯¹æ¯”

##### 3.1 APIè®¾è®¡ç†å¿µ

| ç‰¹æ€§ | Vue Router addRoute | React Router useRoutes |
|------|---------------------|------------------------|
| **APIç±»å‹** | å‘½ä»¤å¼ | å£°æ˜å¼ |
| **è·¯ç”±å®ä¾‹** | å¯å˜çš„å…¨å±€å®ä¾‹ | ä¸å¯å˜çš„é…ç½®æ•°ç»„ |
| **çŠ¶æ€ç®¡ç†** | è·¯ç”±å™¨å†…éƒ¨ç»´æŠ¤ | ç»„ä»¶çŠ¶æ€é©±åŠ¨ |
| **æ›´æ–°æœºåˆ¶** | ç›´æ¥ä¿®æ”¹è·¯ç”±è¡¨ | é‡æ–°æ¸²æŸ“è·¯ç”±æ ‘ |

##### 3.2 å®ç°æœºåˆ¶å·®å¼‚

**Vue Routerï¼š**
```javascript
// è·¯ç”±å®ä¾‹æ˜¯å¯å˜çš„
const router = createRouter(config)

// è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ 
router.addRoute(newRoute)

// è·¯ç”±çŠ¶æ€æŒä¹…åŒ–åœ¨routerå®ä¾‹ä¸­
console.log(router.getRoutes()) // åŒ…å«åŠ¨æ€æ·»åŠ çš„è·¯ç”±
```

**React Routerï¼š**
```jsx
// æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—
function App() {
  const routes = useMemo(() => {
    return generateRoutes(userPermissions)
  }, [userPermissions])
  
  return useRoutes(routes) // æ¯æ¬¡éƒ½æ˜¯æ–°çš„è·¯ç”±æ ‘
}
```

##### 3.3 æ€§èƒ½ç‰¹å¾

**Vue Routerä¼˜åŠ¿ï¼š**
- è·¯ç”±æ·»åŠ åæŒä¹…å­˜åœ¨ï¼Œæ— éœ€é‡å¤è®¡ç®—
- è·¯ç”±åŒ¹é…æ€§èƒ½æ›´å¥½ï¼ˆé¢„ç¼–è¯‘çš„è·¯ç”±è¡¨ï¼‰
- å†…å­˜å ç”¨ç›¸å¯¹ç¨³å®š

**React Routerä¼˜åŠ¿ï¼š**
- æ›´ç¬¦åˆReactçš„å‡½æ•°å¼ç†å¿µ
- è·¯ç”±é…ç½®ä¸ç»„ä»¶çŠ¶æ€åŒæ­¥
- æ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•

#### 4. åˆ·æ–°å¤±æ•ˆé—®é¢˜è§£å†³æ–¹æ¡ˆ

##### 4.1 Vue Routerè§£å†³æ–¹æ¡ˆ

```javascript
// stores/permission.js
import { defineStore } from 'pinia'
import { router } from '@/router'

export const usePermissionStore = defineStore('permission', {
  state: () => ({
    routes: [],
    addedRoutes: [],
    hasAddedRoutes: false
  }),
  
  actions: {
    async generateRoutes(roles) {
      const accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)
      this.addedRoutes = accessedRoutes
      return accessedRoutes
    },
    
    addRoutes(routes) {
      routes.forEach(route => {
        router.addRoute(route)
      })
      this.hasAddedRoutes = true
      
      // æŒä¹…åŒ–åˆ°localStorage
      this.persistRoutes(routes)
    },
    
    persistRoutes(routes) {
      localStorage.setItem('addedRoutes', JSON.stringify(routes))
      localStorage.setItem('hasAddedRoutes', 'true')
    },
    
    restoreRoutes() {
      try {
        const savedRoutes = localStorage.getItem('addedRoutes')
        const hasAdded = localStorage.getItem('hasAddedRoutes')
        
        if (savedRoutes && hasAdded === 'true') {
          const routes = JSON.parse(savedRoutes)
          this.addRoutes(routes)
          return true
        }
      } catch (error) {
        console.error('Failed to restore routes:', error)
        this.clearPersistedRoutes()
      }
      return false
    },
    
    clearPersistedRoutes() {
      localStorage.removeItem('addedRoutes')
      localStorage.removeItem('hasAddedRoutes')
      this.hasAddedRoutes = false
      this.addedRoutes = []
    }
  }
})
```

```javascript
// main.js
import { createApp } from 'vue'
import { router } from '@/router'
import { usePermissionStore } from '@/stores/permission'
import { useUserStore } from '@/stores/user'

const app = createApp(App)

// åº”ç”¨å¯åŠ¨æ—¶æ¢å¤è·¯ç”±
router.beforeEach(async (to, from, next) => {
  const userStore = useUserStore()
  const permissionStore = usePermissionStore()
  
  // å¦‚æœç”¨æˆ·å·²ç™»å½•ä½†è·¯ç”±æœªæ·»åŠ ï¼Œå°è¯•æ¢å¤
  if (userStore.token && !permissionStore.hasAddedRoutes) {
    const restored = permissionStore.restoreRoutes()
    
    if (restored) {
      next({ ...to, replace: true })
    } else {
      // æ¢å¤å¤±è´¥ï¼Œé‡æ–°è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
      try {
        await userStore.getUserInfo()
        const accessRoutes = await permissionStore.generateRoutes(userStore.roles)
        permissionStore.addRoutes(accessRoutes)
        next({ ...to, replace: true })
      } catch (error) {
        userStore.resetToken()
        next('/login')
      }
    }
  } else {
    next()
  }
})
```

##### 4.2 React Routerè§£å†³æ–¹æ¡ˆ

```jsx
// hooks/usePersistedAuth.js
import { useEffect } from 'react'
import { useDispatch } from 'react-redux'
import { restoreAuth, clearAuth } from '@/store/authSlice'

export function usePersistedAuth() {
  const dispatch = useDispatch()
  
  useEffect(() => {
    const restoreUserSession = async () => {
      try {
        const savedAuth = localStorage.getItem('authState')
        
        if (savedAuth) {
          const authData = JSON.parse(savedAuth)
          
          // éªŒè¯tokenæ˜¯å¦ä»ç„¶æœ‰æ•ˆ
          const isValid = await validateToken(authData.token)
          
          if (isValid) {
            dispatch(restoreAuth(authData))
          } else {
            localStorage.removeItem('authState')
          }
        }
      } catch (error) {
        console.error('Failed to restore auth:', error)
        localStorage.removeItem('authState')
        dispatch(clearAuth())
      }
    }
    
    restoreUserSession()
  }, [dispatch])
}
```

```jsx
// store/authSlice.js
import { createSlice } from '@reduxjs/toolkit'

const authSlice = createSlice({
  name: 'auth',
  initialState: {
    user: null,
    token: null,
    permissions: [],
    isInitialized: false
  },
  reducers: {
    setAuth: (state, action) => {
      const { user, token, permissions } = action.payload
      state.user = user
      state.token = token
      state.permissions = permissions
      state.isInitialized = true
      
      // æŒä¹…åŒ–åˆ°localStorage
      localStorage.setItem('authState', JSON.stringify({
        user, token, permissions
      }))
    },
    
    restoreAuth: (state, action) => {
      const { user, token, permissions } = action.payload
      state.user = user
      state.token = token
      state.permissions = permissions
      state.isInitialized = true
    },
    
    clearAuth: (state) => {
      state.user = null
      state.token = null
      state.permissions = []
      state.isInitialized = true
      localStorage.removeItem('authState')
    }
  }
})

export const { setAuth, restoreAuth, clearAuth } = authSlice.actions
export default authSlice.reducer
```

#### 5. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è·¯ç”±ç¼“å­˜ç­–ç•¥**ï¼šå¦‚ä½•ä¼˜åŒ–åŠ¨æ€è·¯ç”±çš„åŠ è½½æ€§èƒ½
2. **å¾®å‰ç«¯è·¯ç”±**ï¼šåœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„åŠ¨æ€è·¯ç”±å¤„ç†
3. **SEOè€ƒè™‘**ï¼šåŠ¨æ€è·¯ç”±å¯¹æœç´¢å¼•æ“ä¼˜åŒ–çš„å½±å“
4. **å®‰å…¨æ€§**ï¼šå‰ç«¯è·¯ç”±æƒé™ä¸åç«¯APIæƒé™çš„é…åˆ

---

## 5. Vue3ä¸­çš„ v-model çš„æ”¹è¿›æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ defineModel ç®€åŒ–ä»£ç ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_5-vue3ä¸­çš„-v-model-çš„æ”¹è¿›æ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨-definemodel-ç®€åŒ–ä»£ç )

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue3æ–°ç‰¹æ€§å’ŒAPIæ¼”è¿›çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **ç‰ˆæœ¬å·®å¼‚**ï¼šVue2ä¸Vue3åœ¨v-modelå®ç°ä¸Šçš„åŒºåˆ«
2. **æ–°ç‰¹æ€§ç†è§£**ï¼šå¤šä¸ªv-modelã€è‡ªå®šä¹‰ä¿®é¥°ç¬¦ç­‰æ–°åŠŸèƒ½
3. **æœ€æ–°API**ï¼šdefineModelå®çš„ä½¿ç”¨å’Œä¼˜åŠ¿
4. **å®é™…åº”ç”¨**ï¼šåœ¨ç»„ä»¶å¼€å‘ä¸­çš„æœ€ä½³å®è·µ

#### 1. Vue2 vs Vue3 v-model å¯¹æ¯”

##### 1.1 Vue2 v-model é™åˆ¶

```vue
<!-- Vue2 - åªèƒ½æœ‰ä¸€ä¸ª v-model -->
<template>
  <CustomInput v-model="value" />
</template>

<!-- CustomInput.vue -->
<template>
  <input 
    :value="value" 
    @input="$emit('input', $event.target.value)"
  />
</template>

<script>
export default {
  props: ['value'], // å›ºå®šçš„ prop åç§°
  // åªèƒ½ç›‘å¬ 'input' äº‹ä»¶
}
</script>
```

##### 1.2 Vue3 v-model æ”¹è¿›

```vue
<!-- Vue3 - æ”¯æŒå¤šä¸ª v-model -->
<template>
  <UserForm 
    v-model:name="userName"
    v-model:email="userEmail"
    v-model:age="userAge"
  />
</template>

<!-- UserForm.vue -->
<template>
  <div>
    <input 
      :value="name"
      @input="$emit('update:name', $event.target.value)"
      placeholder="å§“å"
    />
    <input 
      :value="email"
      @input="$emit('update:email', $event.target.value)"
      placeholder="é‚®ç®±"
    />
    <input 
      :value="age"
      @input="$emit('update:age', $event.target.value)"
      placeholder="å¹´é¾„"
      type="number"
    />
  </div>
</template>

<script setup>
// å®šä¹‰ props
defineProps(['name', 'email', 'age'])

// å®šä¹‰ emits
defineEmits(['update:name', 'update:email', 'update:age'])
</script>
```

#### 2. Vue3 v-model æ–°ç‰¹æ€§è¯¦è§£

##### 2.1 å¤šä¸ª v-model

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <div>
    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
    <p>å§“å: {{ form.name }}</p>
    <p>é‚®ç®±: {{ form.email }}</p>
    <p>ç”µè¯: {{ form.phone }}</p>
    
    <UserEditor
      v-model:name="form.name"
      v-model:email="form.email"
      v-model:phone="form.phone"
    />
  </div>
</template>

<script setup>
import { reactive } from 'vue'

const form = reactive({
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  phone: '13800138000'
})
</script>
```

##### 2.2 è‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <div>
    <!-- ä½¿ç”¨è‡ªå®šä¹‰ä¿®é¥°ç¬¦ -->
    <CustomInput v-model.capitalize="message" />
    <CustomInput v-model.uppercase="title" />
    <CustomInput v-model.trim="description" />
    
    <p>æ¶ˆæ¯: {{ message }}</p>
    <p>æ ‡é¢˜: {{ title }}</p>
    <p>æè¿°: {{ description }}</p>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const message = ref('')
const title = ref('')
const description = ref('')
</script>
```

#### 3. defineModel è¯¦è§£ï¼ˆVue 3.4+ï¼‰

##### 3.1 åŸºæœ¬ç”¨æ³•

```vue
<!-- ä¼ ç»Ÿæ–¹å¼ -->
<template>
  <input 
    :value="modelValue"
    @input="$emit('update:modelValue', $event.target.value)"
  />
</template>

<script setup>
// éœ€è¦æ‰‹åŠ¨å®šä¹‰ props å’Œ emits
defineProps(['modelValue'])
defineEmits(['update:modelValue'])
</script>
```

```vue
<!-- ä½¿ç”¨ defineModel -->
<template>
  <input v-model="model" />
</template>

<script setup>
// ä¸€è¡Œä»£ç æå®š
const model = defineModel()
</script>
```

##### 3.2 å¤šä¸ª defineModel

```vue
<!-- UserForm.vue - ä½¿ç”¨ defineModel -->
<template>
  <div class="user-form">
    <div class="field">
      <label>å§“å:</label>
      <input v-model="name" placeholder="è¯·è¾“å…¥å§“å" />
    </div>
    
    <div class="field">
      <label>é‚®ç®±:</label>
      <input v-model="email" placeholder="è¯·è¾“å…¥é‚®ç®±" type="email" />
    </div>
    
    <div class="field">
      <label>å¹´é¾„:</label>
      <input v-model.number="age" placeholder="è¯·è¾“å…¥å¹´é¾„" type="number" />
    </div>
  </div>
</template>

<script setup>
// å®šä¹‰å¤šä¸ª model
const name = defineModel('name', { default: '' })
const email = defineModel('email', { default: '' })
const age = defineModel('age', { default: 0 })
</script>
```

#### 4. å®é™…åº”ç”¨åœºæ™¯

##### 4.1 è¡¨å•ç»„ä»¶å°è£…

```vue
<!-- FormField.vue -->
<template>
  <div class="form-field" :class="{ error: hasError }">
    <label v-if="label" :for="fieldId">{{ label }}</label>
    
    <input
      :id="fieldId"
      v-model="model"
      :type="type"
      :placeholder="placeholder"
      :disabled="disabled"
      :class="inputClass"
      @blur="validate"
    />
    
    <span v-if="hasError" class="error-message">{{ errorMessage }}</span>
  </div>
</template>

<script setup>
import { computed, ref, watch } from 'vue'

const props = defineProps({
  label: String,
  type: { type: String, default: 'text' },
  placeholder: String,
  disabled: Boolean,
  required: Boolean,
  rules: Array,
  inputClass: String
})

// ä½¿ç”¨ defineModel
const model = defineModel({ required: true })

// ç”Ÿæˆå”¯ä¸€ ID
const fieldId = ref(`field-${Math.random().toString(36).substr(2, 9)}`)

// éªŒè¯çŠ¶æ€
const errorMessage = ref('')
const hasError = computed(() => !!errorMessage.value)

// éªŒè¯å‡½æ•°
const validate = () => {
  if (!props.rules) return true
  
  for (const rule of props.rules) {
    const result = rule(model.value)
    if (result !== true) {
      errorMessage.value = result
      return false
    }
  }
  
  errorMessage.value = ''
  return true
}

// ç›‘å¬å€¼å˜åŒ–ï¼Œæ¸…é™¤é”™è¯¯
watch(model, () => {
  if (hasError.value) {
    errorMessage.value = ''
  }
})

// æš´éœ²éªŒè¯æ–¹æ³•
defineExpose({ validate })
</script>
```

#### 5. TypeScript æ”¯æŒ

```vue
<template>
  <div class="typed-input">
    <input 
      v-model="model"
      :type="inputType"
      :placeholder="placeholder"
    />
  </div>
</template>

<script setup lang="ts">
interface Props {
  placeholder?: string
  inputType?: 'text' | 'email' | 'password' | 'number'
}

// å¸¦ç±»å‹çš„ props
const props = withDefaults(defineProps<Props>(), {
  inputType: 'text'
})

// å¸¦ç±»å‹çš„ defineModel
const model = defineModel<string>({
  required: true
})
</script>
```

#### 6. æ‰©å±•çŸ¥è¯†ç‚¹

1. **ç¼–è¯‘ä¼˜åŒ–**ï¼šdefineModel åœ¨ç¼–è¯‘æ—¶çš„ä¼˜åŒ–æœºåˆ¶
2. **å‘åå…¼å®¹**ï¼šå¦‚ä½•åœ¨ Vue 3.4 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å®ç°ç±»ä¼¼åŠŸèƒ½
3. **æ€§èƒ½å¯¹æ¯”**ï¼šdefineModel vs ä¼ ç»Ÿ props/emit çš„æ€§èƒ½å·®å¼‚
4. **ç”Ÿæ€é›†æˆ**ï¼šä¸ Element Plusã€Ant Design Vue ç­‰ UI åº“çš„é›†æˆ

---

## 6. Vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_6-vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue2åŸºç¡€åŸç†çš„ç»å…¸é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **è¯­æ³•ç³–ç†è§£**ï¼šv-modelä½œä¸ºè¯­æ³•ç³–çš„æœ¬è´¨
2. **åŒå‘ç»‘å®šæœºåˆ¶**ï¼šæ•°æ®ä¸è§†å›¾çš„åŒå‘åŒæ­¥åŸç†
3. **ç¼–è¯‘è¿‡ç¨‹**ï¼šæ¨¡æ¿ç¼–è¯‘æ—¶çš„è½¬æ¢é€»è¾‘
4. **è¡¨å•å…ƒç´ å·®å¼‚**ï¼šä¸åŒè¡¨å•å…ƒç´ çš„å¤„ç†æ–¹å¼

#### 1. v-model åŸºæœ¬åŸç†

##### 1.1 è¯­æ³•ç³–æœ¬è´¨

```javascript
// v-model çš„æœ¬è´¨
<input v-model="message" />

// ç­‰ä»·äº
<input 
  :value="message" 
  @input="message = $event.target.value" 
/>
```

##### 1.2 åŒå‘ç»‘å®šæœºåˆ¶

```vue
<template>
  <div>
    <input v-model="message" />
    <p>æ¶ˆæ¯: {{ message }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      message: 'Hello Vue!'
    }
  }
}
</script>
```

**å·¥ä½œæµç¨‹ï¼š**
1. **æ•°æ® â†’ è§†å›¾**ï¼š`message`å˜åŒ–æ—¶ï¼Œé€šè¿‡å“åº”å¼ç³»ç»Ÿæ›´æ–°inputçš„value
2. **è§†å›¾ â†’ æ•°æ®**ï¼šç”¨æˆ·è¾“å…¥æ—¶ï¼Œè§¦å‘inputäº‹ä»¶ï¼Œæ›´æ–°`message`çš„å€¼

#### 2. ç¼–è¯‘è¿‡ç¨‹è¯¦è§£

##### 2.1 æ¨¡æ¿ç¼–è¯‘è½¬æ¢

```javascript
// Vueç¼–è¯‘å™¨å¤„ç† v-model
function processVModel(el, dir) {
  const value = dir.value
  const modifiers = dir.modifiers || {}
  
  if (el.tag === 'input') {
    const type = getAndRemoveAttr(el, 'type')
    
    if (type === 'checkbox') {
      // checkbox å¤„ç†
      addProp(el, 'checked', `Array.isArray(${value}) ? _i(${value},null) > -1 : (${value})`)
      addHandler(el, 'change', `var $$a=${value},$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_i($$a,$$v);if($$el.checked){$$i<0&&(${value}=$$a.concat([$$v]))}else{$$i>-1&&(${value}=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{${value}=$$c}`)
    } else if (type === 'radio') {
      // radio å¤„ç†
      addProp(el, 'checked', `_q(${value},${JSON.stringify(el.attrsMap.value)})`)
      addHandler(el, 'change', `${value}=${JSON.stringify(el.attrsMap.value)}`)
    } else {
      // æ™®é€š input å¤„ç†
      addProp(el, 'value', `(${value})`)
      addHandler(el, 'input', `if($event.target.composing)return;${value}=$event.target.value`)
    }
  }
}
```

##### 2.2 ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°

```javascript
// ç¼–è¯‘å‰æ¨¡æ¿
`<input v-model="message" />`

// ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°
function render() {
  return h('input', {
    domProps: {
      value: this.message
    },
    on: {
      input: function($event) {
        if ($event.target.composing) return
        this.message = $event.target.value
      }.bind(this)
    }
  })
}
```

#### 3. ä¸åŒè¡¨å•å…ƒç´ çš„å¤„ç†

##### 3.1 æ–‡æœ¬è¾“å…¥å…ƒç´ 

```vue
<template>
  <div>
    <!-- input text -->
    <input v-model="textValue" type="text" />
    
    <!-- textarea -->
    <textarea v-model="textareaValue"></textarea>
  </div>
</template>

<script>
export default {
  data() {
    return {
      textValue: '',
      textareaValue: ''
    }
  }
}
</script>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
// input
h('input', {
  domProps: { value: this.textValue },
  on: { 
    input: ($event) => {
      if ($event.target.composing) return
      this.textValue = $event.target.value
    }
  }
})

// textarea
h('textarea', {
  domProps: { value: this.textareaValue },
  on: { 
    input: ($event) => {
      this.textareaValue = $event.target.value
    }
  }
})
```

##### 3.2 å¤é€‰æ¡†å¤„ç†

```vue
<template>
  <div>
    <!-- å•ä¸ªå¤é€‰æ¡† -->
    <input v-model="checked" type="checkbox" />
    
    <!-- å¤šä¸ªå¤é€‰æ¡† -->
    <input v-model="checkedNames" value="Jack" type="checkbox" />
    <input v-model="checkedNames" value="John" type="checkbox" />
    <input v-model="checkedNames" value="Mike" type="checkbox" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      checked: false,
      checkedNames: []
    }
  }
}
</script>
```

**ç¼–è¯‘é€»è¾‘ï¼š**
```javascript
// å•ä¸ªå¤é€‰æ¡†
function updateChecked($event) {
  this.checked = $event.target.checked
}

// å¤šä¸ªå¤é€‰æ¡†
function updateCheckedNames($event) {
  const value = 'Jack' // å¯¹åº”çš„valueå€¼
  const checked = $event.target.checked
  const arr = this.checkedNames
  
  if (checked) {
    if (arr.indexOf(value) < 0) {
      arr.push(value)
    }
  } else {
    const index = arr.indexOf(value)
    if (index > -1) {
      arr.splice(index, 1)
    }
  }
}
```

##### 3.3 å•é€‰æ¡†å¤„ç†

```vue
<template>
  <div>
    <input v-model="picked" value="a" type="radio" />
    <input v-model="picked" value="b" type="radio" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      picked: ''
    }
  }
}
</script>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { 
    checked: this.picked === 'a' 
  },
  on: { 
    change: () => {
      this.picked = 'a'
    }
  }
})
```

##### 3.4 é€‰æ‹©æ¡†å¤„ç†

```vue
<template>
  <div>
    <!-- å•é€‰ -->
    <select v-model="selected">
      <option value="a">A</option>
      <option value="b">B</option>
    </select>
    
    <!-- å¤šé€‰ -->
    <select v-model="multiSelected" multiple>
      <option value="a">A</option>
      <option value="b">B</option>
      <option value="c">C</option>
    </select>
  </div>
</template>

<script>
export default {
  data() {
    return {
      selected: '',
      multiSelected: []
    }
  }
}
</script>
```

#### 4. ä¿®é¥°ç¬¦å¤„ç†

##### 4.1 .lazy ä¿®é¥°ç¬¦

```vue
<template>
  <!-- ä½¿ç”¨ change äº‹ä»¶è€Œä¸æ˜¯ input äº‹ä»¶ -->
  <input v-model.lazy="message" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.message },
  on: { 
    change: ($event) => {
      this.message = $event.target.value
    }
  }
})
```

##### 4.2 .number ä¿®é¥°ç¬¦

```vue
<template>
  <input v-model.number="age" type="number" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.age },
  on: { 
    input: ($event) => {
      let value = $event.target.value
      const number = Number(value)
      this.age = isNaN(number) ? value : number
    }
  }
})
```

##### 4.3 .trim ä¿®é¥°ç¬¦

```vue
<template>
  <input v-model.trim="message" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.message },
  on: { 
    input: ($event) => {
      this.message = $event.target.value.trim()
    }
  }
})
```

#### 5. è‡ªå®šä¹‰ç»„ä»¶ä¸­çš„ v-model

##### 5.1 åŸºæœ¬å®ç°

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <CustomInput v-model="value" />
</template>

<!-- CustomInput.vue -->
<template>
  <input 
    :value="value"
    @input="$emit('input', $event.target.value)"
  />
</template>

<script>
export default {
  props: ['value']
}
</script>
```

##### 5.2 è‡ªå®šä¹‰ prop å’Œ event

```vue
<!-- CustomComponent.vue -->
<template>
  <input 
    :value="checked"
    @change="$emit('change', $event.target.checked)"
  />
</template>

<script>
export default {
  model: {
    prop: 'checked',
    event: 'change'
  },
  props: ['checked']
}
</script>
```

**ä½¿ç”¨ï¼š**
```vue
<template>
  <!-- ç­‰ä»·äº :checked="foo" @change="val => { foo = val }" -->
  <CustomComponent v-model="foo" />
</template>
```

#### 6. æºç å®ç°å…³é”®ç‚¹

##### 6.1 ç¼–è¯‘æ—¶å¤„ç†

```javascript
// src/compiler/directives/model.js
export default function model(el, dir) {
  const value = dir.value
  const modifiers = dir.modifiers
  const tag = el.tag
  const type = el.attrsMap.type
  
  // æ ¹æ®å…ƒç´ ç±»å‹é€‰æ‹©å¤„ç†æ–¹å¼
  if (tag === 'select') {
    genSelect(el, value, modifiers)
  } else if (tag === 'input' && type === 'checkbox') {
    genCheckboxModel(el, value, modifiers)
  } else if (tag === 'input' && type === 'radio') {
    genRadioModel(el, value, modifiers)
  } else {
    genDefaultModel(el, value, modifiers)
  }
}
```

##### 6.2 è¿è¡Œæ—¶æ›´æ–°

```javascript
// å“åº”å¼æ›´æ–°æœºåˆ¶
function updateModel(el, binding) {
  const value = binding.value
  const oldValue = binding.oldValue
  
  if (value !== oldValue) {
    el.value = value == null ? '' : value
  }
}
```

#### 7. æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹

##### 7.1 ä¸­æ–‡è¾“å…¥æ³•å¤„ç†

```javascript
// å¤„ç†ä¸­æ–‡è¾“å…¥æ³•çš„ composing çŠ¶æ€
function onInput($event) {
  if ($event.target.composing) {
    return // è¾“å…¥æ³•ç»„åˆä¸­ï¼Œä¸æ›´æ–°æ•°æ®
  }
  this.message = $event.target.value
}
```

##### 7.2 å¤§æ•°æ®é‡ä¼˜åŒ–

```vue
<template>
  <div>
    <!-- ä½¿ç”¨ v-memo ä¼˜åŒ–å¤§åˆ—è¡¨ -->
    <div v-for="item in items" :key="item.id" v-memo="[item.selected]">
      <input v-model="item.selected" type="checkbox" />
      {{ item.name }}
    </div>
  </div>
</template>
```

#### 8. ä¸ Vue3 çš„å·®å¼‚å¯¹æ¯”

| ç‰¹æ€§ | Vue2 | Vue3 |
|------|------|------|
| **é»˜è®¤å±æ€§** | `value` | `modelValue` |
| **é»˜è®¤äº‹ä»¶** | `input` | `update:modelValue` |
| **å¤šä¸ªv-model** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **è‡ªå®šä¹‰ä¿®é¥°ç¬¦** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **ç»„ä»¶é…ç½®** | `model` é€‰é¡¹ | `emits` å£°æ˜ |

#### 9. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è¡¨å•éªŒè¯é›†æˆ**ï¼šv-modelä¸è¡¨å•éªŒè¯åº“çš„ç»“åˆä½¿ç”¨
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§è¡¨å•åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
3. **è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šå¦‚ä½•å®ç°ç±»ä¼¼v-modelçš„è‡ªå®šä¹‰æŒ‡ä»¤
4. **æ¡†æ¶å¯¹æ¯”**ï¼šä¸Reactå—æ§ç»„ä»¶çš„å®ç°å·®å¼‚

---

## 7. åœ¨Vueä¸­ï¼Œä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œDOMï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_7-åœ¨vueä¸­ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œdom)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vueè®¾è®¡ç†å¿µå’Œæœ€ä½³å®è·µçš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¡†æ¶è®¾è®¡ç†å¿µ**ï¼šç†è§£Vueæ•°æ®é©±åŠ¨çš„æ ¸å¿ƒæ€æƒ³
2. **æŠ€æœ¯åŸç†**ï¼šè™šæ‹ŸDOMä¸ç›´æ¥DOMæ“ä½œçš„å†²çª
3. **æœ€ä½³å®è·µ**ï¼šä½•æ—¶ä½¿ç”¨refï¼Œä½•æ—¶é¿å…ç›´æ¥DOMæ“ä½œ
4. **å®é™…åº”ç”¨**ï¼šåœ¨é¡¹ç›®ä¸­çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼

#### 1. Vueè®¾è®¡ç†å¿µï¼šæ•°æ®é©±åŠ¨

##### 1.1 å£°æ˜å¼ vs å‘½ä»¤å¼

```vue
<!-- âŒ å‘½ä»¤å¼ï¼šç›´æ¥æ“ä½œDOM -->
<template>
  <div>
    <button @click="showMessage">æ˜¾ç¤ºæ¶ˆæ¯</button>
    <div id="message-container"></div>
  </div>
</template>

<script>
export default {
  methods: {
    showMessage() {
      // ç›´æ¥æ“ä½œDOM - ä¸æ¨è
      const container = document.getElementById('message-container')
      container.innerHTML = '<p>Hello World!</p>'
      container.style.display = 'block'
    }
  }
}
</script>
```

```vue
<!-- âœ… å£°æ˜å¼ï¼šæ•°æ®é©±åŠ¨ -->
<template>
  <div>
    <button @click="showMessage">æ˜¾ç¤ºæ¶ˆæ¯</button>
    <div v-if="isMessageVisible">
      <p>{{ message }}</p>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      isMessageVisible: false,
      message: 'Hello World!'
    }
  },
  methods: {
    showMessage() {
      // é€šè¿‡æ•°æ®å˜åŒ–é©±åŠ¨è§†å›¾æ›´æ–°
      this.isMessageVisible = true
    }
  }
}
</script>
```

##### 1.2 æ•°æ®æµå‘

```
æ•°æ®å˜åŒ– â†’ è™šæ‹ŸDOMæ›´æ–° â†’ DOM Diff â†’ æœ€å°åŒ–DOMæ“ä½œ â†’ è§†å›¾æ›´æ–°
```

#### 2. ç›´æ¥æ“ä½œDOMçš„é—®é¢˜

##### 2.1 ä¸è™šæ‹ŸDOMå†²çª

```vue
<template>
  <div>
    <ul ref="listRef">
      <li v-for="item in items" :key="item.id">
        {{ item.name }}
      </li>
    </ul>
    <button @click="addItem">æ·»åŠ é¡¹ç›®</button>
    <button @click="directManipulation">ç›´æ¥æ“ä½œDOM</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      items: [
        { id: 1, name: 'é¡¹ç›®1' },
        { id: 2, name: 'é¡¹ç›®2' }
      ]
    }
  },
  methods: {
    addItem() {
      // âœ… æ­£ç¡®æ–¹å¼ï¼šé€šè¿‡æ•°æ®æ›´æ–°
      this.items.push({
        id: Date.now(),
        name: `é¡¹ç›®${this.items.length + 1}`
      })
    },
    
    directManipulation() {
      // âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥æ“ä½œDOM
      const li = document.createElement('li')
      li.textContent = 'ç›´æ¥æ·»åŠ çš„é¡¹ç›®'
      this.$refs.listRef.appendChild(li)
      
      // é—®é¢˜ï¼šä¸‹æ¬¡Vueæ›´æ–°æ—¶ï¼Œè¿™ä¸ªæ‰‹åŠ¨æ·»åŠ çš„å…ƒç´ å¯èƒ½è¢«ç§»é™¤
    }
  }
}
</script>
```

##### 2.2 çŠ¶æ€ä¸ä¸€è‡´é—®é¢˜

```vue
<template>
  <div>
    <input v-model="inputValue" ref="inputRef" />
    <p>å½“å‰å€¼: {{ inputValue }}</p>
    <button @click="directChange">ç›´æ¥ä¿®æ”¹DOM</button>
    <button @click="dataChange">é€šè¿‡æ•°æ®ä¿®æ”¹</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      inputValue: 'initial value'
    }
  },
  methods: {
    directChange() {
      // âŒ ç›´æ¥ä¿®æ”¹DOMï¼Œæ•°æ®ä¸è§†å›¾ä¸åŒæ­¥
      this.$refs.inputRef.value = 'DOM modified'
      // inputValue ä»ç„¶æ˜¯ 'initial value'
    },
    
    dataChange() {
      // âœ… é€šè¿‡æ•°æ®ä¿®æ”¹ï¼Œä¿æŒåŒæ­¥
      this.inputValue = 'Data modified'
    }
  }
}
</script>
```

#### 3. refçš„æ­£ç¡®ä½¿ç”¨åœºæ™¯

##### 3.1 å¿…è¦çš„DOMæ“ä½œ

```vue
<template>
  <div>
    <!-- è¾“å…¥æ¡†èšç„¦ -->
    <input ref="usernameInput" v-model="username" placeholder="ç”¨æˆ·å" />
    <button @click="focusUsername">èšç„¦ç”¨æˆ·å</button>
    
    <!-- æ»šåŠ¨å®šä½ -->
    <div ref="scrollContainer" class="scroll-container">
      <div v-for="item in items" :key="item.id" class="item">
        {{ item.content }}
      </div>
    </div>
    <button @click="scrollToTop">å›åˆ°é¡¶éƒ¨</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      username: '',
      items: Array.from({ length: 100 }, (_, i) => ({
        id: i,
        content: `å†…å®¹ ${i + 1}`
      }))
    }
  },
  methods: {
    focusUsername() {
      // âœ… åˆç†ä½¿ç”¨ï¼šèšç„¦æ“ä½œ
      this.$refs.usernameInput.focus()
    },
    
    scrollToTop() {
      // âœ… åˆç†ä½¿ç”¨ï¼šæ»šåŠ¨æ“ä½œ
      this.$refs.scrollContainer.scrollTop = 0
    }
  },
  mounted() {
    // âœ… ç»„ä»¶æŒ‚è½½åè‡ªåŠ¨èšç„¦
    this.$refs.usernameInput.focus()
  }
}
</script>

<style scoped>
.scroll-container {
  height: 300px;
  overflow-y: auto;
}

.item {
  padding: 10px;
  border-bottom: 1px solid #eee;
}
</style>
```

##### 3.2 ç¬¬ä¸‰æ–¹åº“é›†æˆ

```vue
<template>
  <div>
    <!-- å›¾è¡¨å®¹å™¨ -->
    <div ref="chartContainer" class="chart-container"></div>
    
    <!-- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <div ref="editorContainer" class="editor-container"></div>
  </div>
</template>

<script>
import * as echarts from 'echarts'
// import Editor from '@wangeditor/editor'

export default {
  data() {
    return {
      chartInstance: null,
      editorInstance: null,
      chartData: [
        { name: 'A', value: 10 },
        { name: 'B', value: 20 },
        { name: 'C', value: 30 }
      ]
    }
  },
  
  mounted() {
    this.initChart()
    this.initEditor()
  },
  
  beforeUnmount() {
    // æ¸…ç†èµ„æº
    if (this.chartInstance) {
      this.chartInstance.dispose()
    }
    if (this.editorInstance) {
      this.editorInstance.destroy()
    }
  },
  
  methods: {
    initChart() {
      // âœ… åˆç†ä½¿ç”¨ï¼šåˆå§‹åŒ–å›¾è¡¨åº“
      this.chartInstance = echarts.init(this.$refs.chartContainer)
      
      const option = {
        series: [{
          type: 'pie',
          data: this.chartData
        }]
      }
      
      this.chartInstance.setOption(option)
    },
    
    initEditor() {
      // âœ… åˆç†ä½¿ç”¨ï¼šåˆå§‹åŒ–ç¼–è¾‘å™¨
      // this.editorInstance = new Editor({
      //   container: this.$refs.editorContainer,
      //   onChange: (content) => {
      //     this.$emit('content-change', content)
      //   }
      // })
    },
    
    updateChart() {
      // âœ… æ•°æ®é©±åŠ¨æ›´æ–°
      if (this.chartInstance) {
        this.chartInstance.setOption({
          series: [{
            data: this.chartData
          }]
        })
      }
    }
  },
  
  watch: {
    chartData: {
      handler() {
        this.updateChart()
      },
      deep: true
    }
  }
}
</script>
```

##### 3.3 è·å–DOMä¿¡æ¯

```vue
<template>
  <div>
    <div ref="measureElement" class="measure-box">
      <p>è¿™æ˜¯ä¸€ä¸ªéœ€è¦æµ‹é‡çš„å…ƒç´ </p>
      <p>å†…å®¹å¯èƒ½åŠ¨æ€å˜åŒ–</p>
    </div>
    
    <div class="info">
      <p>å®½åº¦: {{ elementInfo.width }}px</p>
      <p>é«˜åº¦: {{ elementInfo.height }}px</p>
      <p>è·ç¦»é¡¶éƒ¨: {{ elementInfo.offsetTop }}px</p>
    </div>
    
    <button @click="measureElement">æµ‹é‡å…ƒç´ </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      elementInfo: {
        width: 0,
        height: 0,
        offsetTop: 0
      }
    }
  },
  
  methods: {
    measureElement() {
      // âœ… åˆç†ä½¿ç”¨ï¼šè·å–DOMå°ºå¯¸ä¿¡æ¯
      const element = this.$refs.measureElement
      
      this.elementInfo = {
        width: element.offsetWidth,
        height: element.offsetHeight,
        offsetTop: element.offsetTop
      }
    }
  },
  
  mounted() {
    // åˆå§‹æµ‹é‡
    this.measureElement()
    
    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', this.measureElement)
  },
  
  beforeUnmount() {
    window.removeEventListener('resize', this.measureElement)
  }
}
</script>

<style scoped>
.measure-box {
  padding: 20px;
  border: 2px solid #007bff;
  margin: 20px 0;
}

.info {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 4px;
}
</style>
```

#### 4. Vue3 Composition API ä¸­çš„ ref

##### 4.1 æ¨¡æ¿å¼•ç”¨

```vue
<template>
  <div>
    <input ref="inputRef" v-model="inputValue" />
    <button @click="focusInput">èšç„¦</button>
    
    <div ref="containerRef" class="container">
      <p v-for="item in items" :key="item.id">{{ item.text }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

// å“åº”å¼æ•°æ®
const inputValue = ref('')
const items = ref([
  { id: 1, text: 'é¡¹ç›®1' },
  { id: 2, text: 'é¡¹ç›®2' }
])

// æ¨¡æ¿å¼•ç”¨
const inputRef = ref(null)
const containerRef = ref(null)

// æ–¹æ³•
const focusInput = () => {
  inputRef.value.focus()
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  console.log('Input element:', inputRef.value)
  console.log('Container element:', containerRef.value)
})
</script>
```

##### 4.2 åŠ¨æ€å¼•ç”¨

```vue
<template>
  <div>
    <div
      v-for="(item, index) in items"
      :key="item.id"
      :ref="(el) => setItemRef(el, index)"
      class="item"
    >
      {{ item.text }}
    </div>
    
    <button @click="focusItem(0)">èšç„¦ç¬¬ä¸€é¡¹</button>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const items = ref([
  { id: 1, text: 'é¡¹ç›®1' },
  { id: 2, text: 'é¡¹ç›®2' },
  { id: 3, text: 'é¡¹ç›®3' }
])

// å­˜å‚¨å¤šä¸ªå¼•ç”¨
const itemRefs = ref([])

const setItemRef = (el, index) => {
  if (el) {
    itemRefs.value[index] = el
  }
}

const focusItem = (index) => {
  const element = itemRefs.value[index]
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' })
  }
}

onMounted(() => {
  console.log('All item refs:', itemRefs.value)
})
</script>
```

#### 5. æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹

##### 5.1 ä½•æ—¶ä½¿ç”¨ref

```javascript
// âœ… é€‚åˆä½¿ç”¨refçš„åœºæ™¯
const goodUseCases = [
  'èšç„¦ã€é€‰æ‹©æ–‡æœ¬ã€åª’ä½“æ’­æ”¾',
  'è§¦å‘åŠ¨ç”»',
  'é›†æˆç¬¬ä¸‰æ–¹DOMåº“',
  'è·å–DOMå°ºå¯¸ã€ä½ç½®',
  'è°ƒç”¨åŸç”ŸDOMæ–¹æ³•'
]

// âŒ åº”è¯¥é¿å…çš„åœºæ™¯
const badUseCases = [
  'ä¿®æ”¹å…ƒç´ å†…å®¹ï¼ˆåº”è¯¥ç”¨æ•°æ®ç»‘å®šï¼‰',
  'æ˜¾ç¤º/éšè—å…ƒç´ ï¼ˆåº”è¯¥ç”¨v-if/v-showï¼‰',
  'ä¿®æ”¹æ ·å¼ï¼ˆåº”è¯¥ç”¨classç»‘å®šæˆ–styleç»‘å®šï¼‰',
  'æ·»åŠ /åˆ é™¤å…ƒç´ ï¼ˆåº”è¯¥ç”¨v-forï¼‰'
]
```

##### 5.2 æ€§èƒ½è€ƒè™‘

```vue
<template>
  <div>
    <!-- âŒ é¿å…åœ¨æ¸²æŸ“å‡½æ•°ä¸­é¢‘ç¹è®¿é—®ref -->
    <div>{{ expensiveCalculation() }}</div>
    
    <!-- âœ… ä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜ç»“æœ -->
    <div>{{ cachedResult }}</div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'

const containerRef = ref(null)
const data = ref([])

// âŒ ä¸å¥½çš„åšæ³•
const expensiveCalculation = () => {
  if (containerRef.value) {
    // æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ
    return containerRef.value.offsetWidth * data.value.length
  }
  return 0
}

// âœ… å¥½çš„åšæ³•
const cachedResult = computed(() => {
  // åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
  return data.value.length * 100 // ä½¿ç”¨æ•°æ®è€ŒéDOM
})

onMounted(() => {
  // åªåœ¨éœ€è¦æ—¶è®¿é—®DOM
  const width = containerRef.value.offsetWidth
  console.log('Container width:', width)
})
</script>
```

##### 5.3 SSRå…¼å®¹æ€§

```vue
<script setup>
import { ref, onMounted, nextTick } from 'vue'

const canvasRef = ref(null)
const chartData = ref([])

// âœ… ç¡®ä¿åœ¨å®¢æˆ·ç«¯ç¯å¢ƒä¸‹æ“ä½œDOM
onMounted(async () => {
  // ç­‰å¾…DOMæ›´æ–°å®Œæˆ
  await nextTick()
  
  // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ç¯å¢ƒ
  if (typeof window !== 'undefined' && canvasRef.value) {
    initCanvas()
  }
})

const initCanvas = () => {
  const canvas = canvasRef.value
  const ctx = canvas.getContext('2d')
  
  // ç»˜åˆ¶å›¾å½¢
  ctx.fillStyle = '#007bff'
  ctx.fillRect(0, 0, 100, 100)
}
</script>

<template>
  <div>
    <canvas ref="canvasRef" width="200" height="200"></canvas>
  </div>
</template>
```

#### 6. ä¸å…¶ä»–æ¡†æ¶çš„å¯¹æ¯”

##### 6.1 Reactå¯¹æ¯”

```javascript
// React - ä½¿ç”¨useRef
function MyComponent() {
  const inputRef = useRef(null)
  
  const focusInput = () => {
    inputRef.current.focus()
  }
  
  return (
    <div>
      <input ref={inputRef} />
      <button onClick={focusInput}>Focus</button>
    </div>
  )
}

// Vue - ä½¿ç”¨ref
// (Vue3 Composition API)
function MyComponent() {
  const inputRef = ref(null)
  
  const focusInput = () => {
    inputRef.value.focus()
  }
  
  return {
    inputRef,
    focusInput
  }
}
```

##### 6.2 Angularå¯¹æ¯”

```typescript
// Angular - ä½¿ç”¨ViewChild
@Component({
  template: `
    <input #inputRef />
    <button (click)="focusInput()">Focus</button>
  `
})
export class MyComponent {
  @ViewChild('inputRef') inputRef!: ElementRef
  
  focusInput() {
    this.inputRef.nativeElement.focus()
  }
}
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è™šæ‹ŸDOMåŸç†**ï¼šç†è§£Vueå¦‚ä½•é€šè¿‡è™šæ‹ŸDOMä¼˜åŒ–æ€§èƒ½
2. **å“åº”å¼ç³»ç»Ÿ**ï¼šæ•°æ®å˜åŒ–å¦‚ä½•è§¦å‘è§†å›¾æ›´æ–°
3. **ç»„ä»¶é€šä¿¡**ï¼šrefåœ¨çˆ¶å­ç»„ä»¶é€šä¿¡ä¸­çš„åº”ç”¨
4. **è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤æ¥å°è£…DOMæ“ä½œ

---

## 8. template æ ‡ç­¾ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨ v-show ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_8-template-æ ‡ç­¾ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨-v-show)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vueæ¨¡æ¿ç¼–è¯‘å’ŒæŒ‡ä»¤æœºåˆ¶çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **templateæ ‡ç­¾ç‰¹æ€§**ï¼šç†è§£templateä½œä¸ºè™šæ‹Ÿå®¹å™¨çš„æœ¬è´¨
2. **v-showå®ç°åŸç†**ï¼šæŒæ¡v-showé€šè¿‡CSSæ§åˆ¶æ˜¾ç¤ºçš„æœºåˆ¶
3. **æŠ€æœ¯å†²çªåˆ†æ**ï¼šç†è§£ä¸ºä»€ä¹ˆä¸¤è€…ä¸èƒ½é…åˆä½¿ç”¨
4. **æ›¿ä»£æ–¹æ¡ˆ**ï¼šæŒæ¡æ­£ç¡®çš„æ¡ä»¶æ¸²æŸ“æ–¹æ³•

#### 1. template æ ‡ç­¾çš„æœ¬è´¨

##### 1.1 è™šæ‹Ÿå®¹å™¨ç‰¹æ€§

```vue
<template>
  <div>
    <!-- template ä½œä¸ºåˆ†ç»„å®¹å™¨ï¼Œä¸ä¼šæ¸²æŸ“åˆ°DOM -->
    <template v-for="item in items" :key="item.id">
      <h3>{{ item.title }}</h3>
      <p>{{ item.content }}</p>
    </template>
  </div>
</template>

<script>
export default {
  data() {
    return {
      items: [
        { id: 1, title: 'æ ‡é¢˜1', content: 'å†…å®¹1' },
        { id: 2, title: 'æ ‡é¢˜2', content: 'å†…å®¹2' }
      ]
    }
  }
}
</script>
```

**ç¼–è¯‘åçš„DOMç»“æ„ï¼š**
```html
<div>
  <!-- æ³¨æ„ï¼šæ²¡æœ‰ template å…ƒç´  -->
  <h3>æ ‡é¢˜1</h3>
  <p>å†…å®¹1</p>
  <h3>æ ‡é¢˜2</h3>
  <p>å†…å®¹2</p>
</div>
```

##### 1.2 ç¼–è¯‘æ—¶å¤„ç†

```javascript
// Vueç¼–è¯‘å™¨å¯¹ template çš„å¤„ç†
function processTemplate(el) {
  // template æ ‡ç­¾åœ¨ç¼–è¯‘æ—¶è¢«ç§»é™¤
  // åªä¿ç•™å…¶å­å…ƒç´ 
  if (el.tag === 'template') {
    return el.children // è¿”å›å­å…ƒç´ æ•°ç»„
  }
  return el
}
```

#### 2. v-show çš„å®ç°æœºåˆ¶

##### 2.1 CSS display æ§åˆ¶

```vue
<template>
  <div>
    <!-- v-show é€šè¿‡ CSS display å±æ€§æ§åˆ¶ -->
    <p v-show="isVisible">è¿™æ®µæ–‡å­—å¯ä»¥æ˜¾ç¤º/éšè—</p>
    <button @click="toggle">åˆ‡æ¢æ˜¾ç¤º</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      isVisible: true
    }
  },
  methods: {
    toggle() {
      this.isVisible = !this.isVisible
    }
  }
}
</script>
```

**v-show ç¼–è¯‘åçš„æ•ˆæœï¼š**
```html
<!-- isVisible = true æ—¶ -->
<p style="">è¿™æ®µæ–‡å­—å¯ä»¥æ˜¾ç¤º/éšè—</p>

<!-- isVisible = false æ—¶ -->
<p style="display: none;">è¿™æ®µæ–‡å­—å¯ä»¥æ˜¾ç¤º/éšè—</p>
```

##### 2.2 v-show æºç å®ç°

```javascript
// Vueæºç ä¸­ v-show çš„å®ç°
const vShow = {
  beforeMount(el, { value }) {
    el._vod = el.style.display === 'none' ? '' : el.style.display
    setDisplay(el, value)
  },
  
  updated(el, { value, oldValue }) {
    if (!value === !oldValue) return
    setDisplay(el, value)
  },
  
  beforeUnmount(el) {
    setDisplay(el, true)
  }
}

function setDisplay(el, value) {
  el.style.display = value ? el._vod : 'none'
}
```

#### 3. å†²çªçš„æ ¹æœ¬åŸå› 

##### 3.1 æŠ€æœ¯å±‚é¢åˆ†æ

```vue
<!-- âŒ é”™è¯¯ç”¨æ³•ï¼štemplate + v-show -->
<template>
  <div>
    <template v-show="showContent">
      <h2>æ ‡é¢˜</h2>
      <p>å†…å®¹</p>
    </template>
  </div>
</template>
```

**é—®é¢˜åˆ†æï¼š**
```javascript
// ç¼–è¯‘æ—¶çš„å†²çª
// 1. template æ ‡ç­¾ä¼šè¢«ç§»é™¤ï¼Œä¸äº§ç”ŸDOMå…ƒç´ 
// 2. v-show éœ€è¦æ“ä½œDOMå…ƒç´ çš„ style.display å±æ€§
// 3. æ²¡æœ‰DOMå…ƒç´  = æ— æ³•è®¾ç½®æ ·å¼ = v-show å¤±æ•ˆ

// ç¼–è¯‘å™¨ä¼šæŠ¥é”™æˆ–å¿½ç•¥ v-show æŒ‡ä»¤
console.error('v-show can only be used on elements that will be rendered to DOM')
```

##### 3.2 æ¸²æŸ“è¿‡ç¨‹å¯¹æ¯”

```javascript
// v-if + templateï¼ˆâœ… æ­£ç¡®ï¼‰
function renderWithVIf() {
  if (showContent) {
    return [
      h('h2', 'æ ‡é¢˜'),
      h('p', 'å†…å®¹')
    ]
  }
  return []
}

// v-show + templateï¼ˆâŒ é”™è¯¯ï¼‰
function renderWithVShow() {
  // template ä¸äº§ç”ŸDOMèŠ‚ç‚¹
  // æ— æ³•å¯¹ä¸å­˜åœ¨çš„å…ƒç´ è®¾ç½® display æ ·å¼
  const templateEl = null // template ç¼–è¯‘åä¸ºç©º
  
  // å°è¯•è®¾ç½®æ ·å¼ä¼šå¤±è´¥
  if (templateEl) {
    templateEl.style.display = showContent ? '' : 'none'
  }
  
  return [
    h('h2', 'æ ‡é¢˜'),
    h('p', 'å†…å®¹')
  ]
}
```

#### 4. æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ

##### 4.1 ä½¿ç”¨ v-if æ›¿ä»£

```vue
<template>
  <div>
    <!-- âœ… æ­£ç¡®ï¼štemplate + v-if -->
    <template v-if="showContent">
      <h2>{{ title }}</h2>
      <p>{{ content }}</p>
      <ul>
        <li v-for="item in list" :key="item.id">{{ item.name }}</li>
      </ul>
    </template>
    
    <button @click="toggleContent">
      {{ showContent ? 'éšè—' : 'æ˜¾ç¤º' }}å†…å®¹
    </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      showContent: true,
      title: 'åŠ¨æ€æ ‡é¢˜',
      content: 'åŠ¨æ€å†…å®¹',
      list: [
        { id: 1, name: 'é¡¹ç›®1' },
        { id: 2, name: 'é¡¹ç›®2' }
      ]
    }
  },
  methods: {
    toggleContent() {
      this.showContent = !this.showContent
    }
  }
}
</script>
```

##### 4.2 ä½¿ç”¨çœŸå®DOMå…ƒç´ 

```vue
<template>
  <div>
    <!-- âœ… ä½¿ç”¨ div åŒ…è£¹å¹¶åº”ç”¨ v-show -->
    <div v-show="showContent" class="content-wrapper">
      <h2>{{ title }}</h2>
      <p>{{ content }}</p>
      <ul>
        <li v-for="item in list" :key="item.id">{{ item.name }}</li>
      </ul>
    </div>
    
    <button @click="toggleContent">
      {{ showContent ? 'éšè—' : 'æ˜¾ç¤º' }}å†…å®¹
    </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      showContent: true,
      title: 'åŠ¨æ€æ ‡é¢˜',
      content: 'åŠ¨æ€å†…å®¹',
      list: [
        { id: 1, name: 'é¡¹ç›®1' },
        { id: 2, name: 'é¡¹ç›®2' }
      ]
    }
  },
  methods: {
    toggleContent() {
      this.showContent = !this.showContent
    }
  }
}
</script>

<style scoped>
.content-wrapper {
  padding: 16px;
  border: 1px solid #ddd;
  border-radius: 4px;
}
</style>
```

##### 4.3 ç»„ä»¶åŒ–æ–¹æ¡ˆ

```vue
<!-- ContentBlock.vue -->
<template>
  <div class="content-block">
    <h2>{{ title }}</h2>
    <p>{{ content }}</p>
    <slot></slot>
  </div>
</template>

<script>
export default {
  props: {
    title: String,
    content: String
  }
}
</script>

<style scoped>
.content-block {
  padding: 16px;
  border: 1px solid #ddd;
  border-radius: 4px;
}
</style>
```

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <div>
    <!-- âœ… ä½¿ç”¨ç»„ä»¶ + v-show -->
    <ContentBlock 
      v-show="showContent"
      :title="title"
      :content="content"
    >
      <ul>
        <li v-for="item in list" :key="item.id">{{ item.name }}</li>
      </ul>
    </ContentBlock>
    
    <button @click="toggleContent">
      {{ showContent ? 'éšè—' : 'æ˜¾ç¤º' }}å†…å®¹
    </button>
  </div>
</template>

<script>
import ContentBlock from './ContentBlock.vue'

export default {
  components: {
    ContentBlock
  },
  data() {
    return {
      showContent: true,
      title: 'ç»„ä»¶æ ‡é¢˜',
      content: 'ç»„ä»¶å†…å®¹',
      list: [
        { id: 1, name: 'é¡¹ç›®1' },
        { id: 2, name: 'é¡¹ç›®2' }
      ]
    }
  },
  methods: {
    toggleContent() {
      this.showContent = !this.showContent
    }
  }
}
</script>
```

#### 5. v-if vs v-show çš„é€‰æ‹©

##### 5.1 æ€§èƒ½å¯¹æ¯”

```vue
<template>
  <div>
    <!-- v-ifï¼šæ¡ä»¶æ¸²æŸ“ï¼ŒDOMèŠ‚ç‚¹çš„åˆ›å»º/é”€æ¯ -->
    <div v-if="showExpensiveComponent">
      <ExpensiveComponent />
    </div>
    
    <!-- v-showï¼šæ ·å¼åˆ‡æ¢ï¼ŒDOMèŠ‚ç‚¹å§‹ç»ˆå­˜åœ¨ -->
    <div v-show="showSimpleContent">
      <p>ç®€å•å†…å®¹</p>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      showExpensiveComponent: false,
      showSimpleContent: true
    }
  }
}
</script>
```

**æ€§èƒ½ç‰¹ç‚¹ï¼š**
```javascript
// v-if ç‰¹ç‚¹
const vIfCharacteristics = {
  åˆå§‹æ¸²æŸ“: 'æ¡ä»¶ä¸ºfalseæ—¶ï¼Œä¸æ¸²æŸ“DOM',
  åˆ‡æ¢å¼€é”€: 'é«˜ï¼ˆåˆ›å»º/é”€æ¯DOMèŠ‚ç‚¹ï¼‰',
  é€‚ç”¨åœºæ™¯: 'æ¡ä»¶å¾ˆå°‘æ”¹å˜çš„æƒ…å†µ',
  å†…å­˜å ç”¨: 'æ¡ä»¶ä¸ºfalseæ—¶ï¼Œä¸å ç”¨å†…å­˜'
}

// v-show ç‰¹ç‚¹
const vShowCharacteristics = {
  åˆå§‹æ¸²æŸ“: 'æ€»æ˜¯æ¸²æŸ“DOMï¼Œé€šè¿‡CSSæ§åˆ¶æ˜¾ç¤º',
  åˆ‡æ¢å¼€é”€: 'ä½ï¼ˆåªæ”¹å˜CSSæ ·å¼ï¼‰',
  é€‚ç”¨åœºæ™¯: 'éœ€è¦é¢‘ç¹åˆ‡æ¢çš„æƒ…å†µ',
  å†…å­˜å ç”¨: 'å§‹ç»ˆå ç”¨å†…å­˜'
}
```

##### 5.2 ä½¿ç”¨åœºæ™¯é€‰æ‹©

```vue
<template>
  <div>
    <!-- âœ… é€‚åˆç”¨ v-if çš„åœºæ™¯ -->
    <AdminPanel v-if="user.role === 'admin'" />
    <UserProfile v-if="user.isLoggedIn" />
    
    <!-- âœ… é€‚åˆç”¨ v-show çš„åœºæ™¯ -->
    <div v-show="isMenuOpen" class="dropdown-menu">
      <MenuItem v-for="item in menuItems" :key="item.id" :item="item" />
    </div>
    
    <div v-show="isLoading" class="loading-spinner">
      åŠ è½½ä¸­...
    </div>
  </div>
</template>
```

#### 6. Vue3 ä¸­çš„æ”¹è¿›

##### 6.1 Fragment æ”¯æŒ

```vue
<!-- Vue3 æ”¯æŒå¤šä¸ªæ ¹èŠ‚ç‚¹ -->
<template>
  <!-- ä¸éœ€è¦åŒ…è£¹ divï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¤šä¸ªæ ¹èŠ‚ç‚¹ -->
  <header>å¤´éƒ¨</header>
  <main v-if="showContent">ä¸»è¦å†…å®¹</main>
  <footer>åº•éƒ¨</footer>
</template>
```

##### 6.2 Composition API ä¸­çš„æ¡ä»¶æ¸²æŸ“

```vue
<template>
  <div>
    <template v-if="shouldShowContent">
      <h2>{{ title }}</h2>
      <p>{{ description }}</p>
    </template>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const isLoggedIn = ref(false)
const userRole = ref('guest')
const title = ref('æ¬¢è¿é¡µé¢')
const description = ref('è¿™æ˜¯ä¸€ä¸ªæè¿°')

// ä½¿ç”¨è®¡ç®—å±æ€§æ§åˆ¶æ˜¾ç¤ºé€»è¾‘
const shouldShowContent = computed(() => {
  return isLoggedIn.value && userRole.value !== 'banned'
})
</script>
```

#### 7. å¸¸è§é”™è¯¯å’Œè°ƒè¯•

##### 7.1 é”™è¯¯ç¤ºä¾‹

```vue
<!-- âŒ å¸¸è§é”™è¯¯ -->
<template>
  <div>
    <!-- é”™è¯¯1ï¼štemplate + v-show -->
    <template v-show="visible">
      <p>å†…å®¹</p>
    </template>
    
    <!-- é”™è¯¯2ï¼šæ··åˆä½¿ç”¨ v-if å’Œ v-show -->
    <div v-if="condition" v-show="visible">
      <p>å†…å®¹</p>
    </div>
  </div>
</template>
```

##### 7.2 è°ƒè¯•æŠ€å·§

```vue
<template>
  <div>
    <!-- è°ƒè¯•ï¼šæ£€æŸ¥æ¸²æŸ“æ¡ä»¶ -->
    <div class="debug-info" v-if="isDevelopment">
      <p>showContent: {{ showContent }}</p>
      <p>userRole: {{ userRole }}</p>
      <p>shouldRender: {{ shouldRender }}</p>
    </div>
    
    <!-- æ­£ç¡®çš„æ¡ä»¶æ¸²æŸ“ -->
    <template v-if="shouldRender">
      <h2>å†…å®¹æ ‡é¢˜</h2>
      <p>å†…å®¹è¯¦æƒ…</p>
    </template>
  </div>
</template>

<script>
export default {
  data() {
    return {
      showContent: true,
      userRole: 'user',
      isDevelopment: process.env.NODE_ENV === 'development'
    }
  },
  computed: {
    shouldRender() {
      return this.showContent && this.userRole !== 'banned'
    }
  }
}
</script>
```

#### 8. æ‰©å±•çŸ¥è¯†ç‚¹

1. **æ¨¡æ¿ç¼–è¯‘åŸç†**ï¼šVueå¦‚ä½•å°†templateè½¬æ¢ä¸ºæ¸²æŸ“å‡½æ•°
2. **è™šæ‹ŸDOMæœºåˆ¶**ï¼šæ¡ä»¶æ¸²æŸ“åœ¨è™šæ‹ŸDOMä¸­çš„å®ç°
3. **æŒ‡ä»¤ç³»ç»Ÿ**ï¼šVueæŒ‡ä»¤çš„æ‰§è¡Œæœºåˆ¶å’Œç”Ÿå‘½å‘¨æœŸ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§å‹åº”ç”¨ä¸­æ¡ä»¶æ¸²æŸ“çš„ä¼˜åŒ–ç­–ç•¥

---

## 9. watch ä¸ watchEffect çš„åŒºåˆ«ï¼Œåˆ†åˆ«åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ

### 1. æ ¸å¿ƒæ¦‚å¿µ

#### watch
`watch` æ˜¯ Vue 3 ä¸­ç”¨äºç›‘å¬å“åº”å¼æ•°æ®å˜åŒ–çš„ APIï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šç›‘å¬çš„æ•°æ®æºã€‚

#### watchEffect
`watchEffect` æ˜¯ Vue 3 æ–°å¢çš„å“åº”å¼å‰¯ä½œç”¨å‡½æ•°ï¼Œä¼šè‡ªåŠ¨è¿½è¸ªå…¶å‡½æ•°ä½“å†…æ‰€ä½¿ç”¨çš„å“åº”å¼çŠ¶æ€ã€‚

### 2. ä¸»è¦åŒºåˆ«å¯¹æ¯”

| ç‰¹æ€§ | watch | watchEffect |
|------|-------|-------------|
| **ç›‘å¬æ–¹å¼** | æ˜ç¡®æŒ‡å®šæ•°æ®æº | è‡ªåŠ¨è¿½è¸ªä¾èµ– |
| **æ‰§è¡Œæ—¶æœº** | æƒ°æ€§æ‰§è¡Œï¼ˆæ•°æ®å˜åŒ–æ—¶ï¼‰ | ç«‹å³æ‰§è¡Œ + ä¾èµ–å˜åŒ–æ—¶ |
| **æ–°æ—§å€¼è®¿é—®** | âœ… å¯ä»¥è®¿é—® | âŒ æ— æ³•è®¿é—® |
| **åœæ­¢ç›‘å¬** | è¿”å›åœæ­¢å‡½æ•° | è¿”å›åœæ­¢å‡½æ•° |
| **ä¾èµ–æ”¶é›†** | æ‰‹åŠ¨æŒ‡å®š | è‡ªåŠ¨æ”¶é›† |

### 3. åŸºæœ¬ç”¨æ³•ç¤ºä¾‹

#### watch åŸºæœ¬ç”¨æ³•

```javascript
import { ref, watch } from 'vue'

const count = ref(0)
const name = ref('å¼ ä¸‰')

// ç›‘å¬å•ä¸ªæ•°æ®æº
watch(count, (newValue, oldValue) => {
  console.log(`count ä» ${oldValue} å˜ä¸º ${newValue}`)
})

// ç›‘å¬å¤šä¸ªæ•°æ®æº
watch([count, name], ([newCount, newName], [oldCount, oldName]) => {
  console.log('count æˆ– name å‘ç”Ÿäº†å˜åŒ–')
})

// ç›‘å¬å¯¹è±¡å±æ€§
const user = ref({ name: 'å¼ ä¸‰', age: 25 })
watch(
  () => user.value.name,
  (newName, oldName) => {
    console.log(`ç”¨æˆ·åä» ${oldName} æ”¹ä¸º ${newName}`)
  }
)

// æ·±åº¦ç›‘å¬
watch(
  user,
  (newUser, oldUser) => {
    console.log('ç”¨æˆ·å¯¹è±¡å‘ç”Ÿå˜åŒ–')
  },
  { deep: true }
)
```

#### watchEffect åŸºæœ¬ç”¨æ³•

```javascript
import { ref, watchEffect } from 'vue'

const count = ref(0)
const name = ref('å¼ ä¸‰')

// è‡ªåŠ¨è¿½è¸ªä¾èµ–
watchEffect(() => {
  console.log(`å½“å‰è®¡æ•°: ${count.value}ï¼Œç”¨æˆ·: ${name.value}`)
  // ä¼šåœ¨ count æˆ– name å˜åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œ
})

// å¼‚æ­¥å‰¯ä½œç”¨
watchEffect(async () => {
  const response = await fetch(`/api/user/${count.value}`)
  const userData = await response.json()
  console.log('ç”¨æˆ·æ•°æ®:', userData)
})
```

### 4. é«˜çº§ç”¨æ³•å’Œé…ç½®

#### watch é«˜çº§é…ç½®

```javascript
import { ref, watch } from 'vue'

const count = ref(0)

// ç«‹å³æ‰§è¡Œ
watch(
  count,
  (newValue, oldValue) => {
    console.log('ç«‹å³æ‰§è¡Œçš„ç›‘å¬å™¨')
  },
  { immediate: true }
)

// æ·±åº¦ç›‘å¬
const obj = ref({ nested: { value: 1 } })
watch(
  obj,
  (newObj, oldObj) => {
    console.log('å¯¹è±¡æ·±åº¦å˜åŒ–')
  },
  { deep: true }
)

// åˆ·æ–°æ—¶æœºæ§åˆ¶
watch(
  count,
  (newValue) => {
    console.log('åœ¨ç»„ä»¶æ›´æ–°å‰æ‰§è¡Œ')
  },
  { flush: 'pre' } // 'pre' | 'post' | 'sync'
)
```

#### watchEffect é«˜çº§ç”¨æ³•

```javascript
import { ref, watchEffect } from 'vue'

const count = ref(0)

// æ¸…ç†å‰¯ä½œç”¨
watchEffect((onInvalidate) => {
  const timer = setTimeout(() => {
    console.log(`å»¶è¿Ÿè¾“å‡º: ${count.value}`)
  }, 1000)
  
  // æ¸…ç†å‡½æ•°
  onInvalidate(() => {
    clearTimeout(timer)
  })
})

// è°ƒè¯•ä¾èµ–è¿½è¸ª
watchEffect(
  () => {
    console.log(`count: ${count.value}`)
  },
  {
    onTrack(e) {
      console.log('è¿½è¸ªåˆ°ä¾èµ–:', e)
    },
    onTrigger(e) {
      console.log('ä¾èµ–è§¦å‘:', e)
    }
  }
)
```

### 5. å®é™…åº”ç”¨åœºæ™¯

#### watch é€‚ç”¨åœºæ™¯

**1. è¡¨å•éªŒè¯**
```javascript
import { ref, watch } from 'vue'

const email = ref('')
const emailError = ref('')

watch(email, (newEmail) => {
  if (!newEmail) {
    emailError.value = 'é‚®ç®±ä¸èƒ½ä¸ºç©º'
  } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(newEmail)) {
    emailError.value = 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®'
  } else {
    emailError.value = ''
  }
})
```

**2. æ•°æ®æŒä¹…åŒ–**
```javascript
import { ref, watch } from 'vue'

const userSettings = ref({
  theme: 'light',
  language: 'zh-CN'
})

// ç›‘å¬è®¾ç½®å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜åˆ° localStorage
watch(
  userSettings,
  (newSettings) => {
    localStorage.setItem('userSettings', JSON.stringify(newSettings))
  },
  { deep: true }
)
```

**3. å¼‚æ­¥æ•°æ®åŠ è½½**
```javascript
import { ref, watch } from 'vue'

const userId = ref(null)
const userInfo = ref(null)
const loading = ref(false)

watch(userId, async (newUserId, oldUserId) => {
  if (newUserId && newUserId !== oldUserId) {
    loading.value = true
    try {
      const response = await fetch(`/api/users/${newUserId}`)
      userInfo.value = await response.json()
    } catch (error) {
      console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
    } finally {
      loading.value = false
    }
  }
})
```

#### watchEffect é€‚ç”¨åœºæ™¯

**1. è‡ªåŠ¨åŒæ­¥è®¡ç®—**
```javascript
import { ref, watchEffect } from 'vue'

const firstName = ref('å¼ ')
const lastName = ref('ä¸‰')
const fullName = ref('')

// è‡ªåŠ¨åŒæ­¥å…¨å
watchEffect(() => {
  fullName.value = `${firstName.value}${lastName.value}`
})
```

**2. DOM æ“ä½œ**
```javascript
import { ref, watchEffect, nextTick } from 'vue'

const count = ref(0)
const titleRef = ref(null)

// è‡ªåŠ¨æ›´æ–°é¡µé¢æ ‡é¢˜
watchEffect(() => {
  document.title = `è®¡æ•°: ${count.value}`
})

// DOM æ›´æ–°åçš„æ“ä½œ
watchEffect(() => {
  nextTick(() => {
    if (titleRef.value) {
      titleRef.value.style.color = count.value > 10 ? 'red' : 'black'
    }
  })
})
```

**3. å®æ—¶æœç´¢**
```javascript
import { ref, watchEffect } from 'vue'

const searchQuery = ref('')
const searchResults = ref([])
const loading = ref(false)

// è‡ªåŠ¨æœç´¢
watchEffect(async () => {
  if (searchQuery.value.trim()) {
    loading.value = true
    try {
      const response = await fetch(`/api/search?q=${searchQuery.value}`)
      searchResults.value = await response.json()
    } catch (error) {
      console.error('æœç´¢å¤±è´¥:', error)
      searchResults.value = []
    } finally {
      loading.value = false
    }
  } else {
    searchResults.value = []
  }
})
```

### 6. æ€§èƒ½è€ƒè™‘

#### watch æ€§èƒ½ä¼˜åŒ–

```javascript
import { ref, watch } from 'vue'

const largeList = ref([])

// é¿å…æ·±åº¦ç›‘å¬å¤§å‹å¯¹è±¡
watch(
  () => largeList.value.length,
  (newLength) => {
    console.log(`åˆ—è¡¨é•¿åº¦å˜ä¸º: ${newLength}`)
  }
)

// ä½¿ç”¨ getter å‡½æ•°ç›‘å¬ç‰¹å®šå±æ€§
const user = ref({ profile: { name: 'å¼ ä¸‰', settings: { /* å¤§é‡æ•°æ® */ } } })
watch(
  () => user.value.profile.name,
  (newName) => {
    console.log(`ç”¨æˆ·åå˜æ›´: ${newName}`)
  }
)
```

#### watchEffect æ€§èƒ½ä¼˜åŒ–

```javascript
import { ref, watchEffect } from 'vue'

const expensiveData = ref(null)
const shouldUpdate = ref(true)

// æ¡ä»¶æ€§æ‰§è¡Œå‰¯ä½œç”¨
watchEffect(() => {
  if (shouldUpdate.value) {
    // åªåœ¨éœ€è¦æ—¶æ‰§è¡Œæ˜‚è´µæ“ä½œ
    performExpensiveOperation(expensiveData.value)
  }
})
```

### 7. åœæ­¢ç›‘å¬

```javascript
import { ref, watch, watchEffect } from 'vue'

const count = ref(0)

// åœæ­¢ watch
const stopWatch = watch(count, (newValue) => {
  console.log(`count: ${newValue}`)
})

// åœæ­¢ watchEffect
const stopWatchEffect = watchEffect(() => {
  console.log(`count: ${count.value}`)
})

// åœ¨é€‚å½“æ—¶æœºåœæ­¢ç›‘å¬
setTimeout(() => {
  stopWatch()
  stopWatchEffect()
}, 5000)
```

### 8. æœ€ä½³å®è·µ

#### é€‰æ‹©åŸåˆ™

1. **ä½¿ç”¨ watch å½“ï¼š**
   - éœ€è¦ç›‘å¬ç‰¹å®šçš„æ•°æ®æº
   - éœ€è¦è®¿é—®å˜åŒ–å‰åçš„å€¼
   - æ‰§è¡Œå¼‚æ­¥æ“ä½œæˆ–æ˜‚è´µè®¡ç®—
   - éœ€è¦ç²¾ç¡®æ§åˆ¶æ‰§è¡Œæ—¶æœº

2. **ä½¿ç”¨ watchEffect å½“ï¼š**
   - å‰¯ä½œç”¨ä¾èµ–å¤šä¸ªå“åº”å¼æ•°æ®
   - ä¸å…³å¿ƒå…·ä½“ç›‘å¬ä»€ä¹ˆï¼Œåªå…³å¿ƒç»“æœ
   - éœ€è¦ç«‹å³æ‰§è¡Œçš„å‰¯ä½œç”¨
   - ç®€åŒ–å¤æ‚çš„ä¾èµ–å…³ç³»

#### å¸¸è§é™·é˜±

```javascript
// âŒ é¿å…åœ¨ watchEffect ä¸­ä¿®æ”¹ä¾èµ–çš„æ•°æ®ï¼ˆå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ï¼‰
const count = ref(0)
watchEffect(() => {
  count.value++ // å±é™©ï¼å¯èƒ½å¯¼è‡´æ— é™å¾ªç¯
})

// âœ… æ­£ç¡®çš„æ–¹å¼
watchEffect(() => {
  if (count.value > 10) {
    // æ‰§è¡Œå‰¯ä½œç”¨ï¼Œä½†ä¸ä¿®æ”¹ count
    console.log('è®¡æ•°è¶…è¿‡ 10')
  }
})
```

### 9. æ‰©å±•çŸ¥è¯†ç‚¹

1. **å“åº”å¼ç³»ç»ŸåŸç†**ï¼šVue 3 å¦‚ä½•å®ç°ä¾èµ–è¿½è¸ªå’Œè§¦å‘æ›´æ–°
2. **Proxy vs defineProperty**ï¼šVue 3 å“åº”å¼ç³»ç»Ÿçš„åº•å±‚å®ç°
3. **å‰¯ä½œç”¨ç®¡ç†**ï¼šå¦‚ä½•æ­£ç¡®å¤„ç†å¼‚æ­¥å‰¯ä½œç”¨å’Œæ¸…ç†å·¥ä½œ
4. **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼šå¤§å‹åº”ç”¨ä¸­ç›‘å¬å™¨çš„ä¼˜åŒ–æŠ€å·§

---

## 10. æ€ä¹ˆç†è§£ Vue3 æä¾›çš„ markRaw ï¼Ÿ

### 1. æ ¸å¿ƒæ¦‚å¿µ

`markRaw` æ˜¯ Vue 3 æä¾›çš„ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å…¶æ°¸è¿œä¸ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼å¯¹è±¡ã€‚è¿™æ˜¯ Vue 3 å“åº”å¼ç³»ç»Ÿä¸­ä¸€ä¸ªé‡è¦çš„æ€§èƒ½ä¼˜åŒ–å’Œæ§åˆ¶æœºåˆ¶ã€‚

### 2. åŸºæœ¬è¯­æ³•

```javascript
import { markRaw } from 'vue'

const obj = markRaw({
  // å¯¹è±¡å†…å®¹
})
```

### 3. å·¥ä½œåŸç†

#### å“åº”å¼ç³»ç»Ÿæ ‡è®°
```javascript
import { markRaw, reactive, isReactive } from 'vue'

const normalObj = { name: 'å¼ ä¸‰' }
const markedObj = markRaw({ name: 'æå››' })

const state = reactive({
  normal: normalObj,  // ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
  marked: markedObj   // ä¸ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
})

console.log(isReactive(state.normal)) // true
console.log(isReactive(state.marked)) // false
```

#### å†…éƒ¨å®ç°æœºåˆ¶
```javascript
// Vue å†…éƒ¨ä¼šç»™å¯¹è±¡æ·»åŠ  __v_skip æ ‡è®°
const obj = markRaw({ data: 'test' })
console.log(obj.__v_skip) // true

// å“åº”å¼ç³»ç»Ÿæ£€æŸ¥è¿™ä¸ªæ ‡è®°æ¥å†³å®šæ˜¯å¦è½¬æ¢
function reactive(target) {
  if (target.__v_skip) {
    return target // ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œå“åº”å¼è½¬æ¢
  }
  // ... å…¶ä»–å“åº”å¼è½¬æ¢é€»è¾‘
}
```

### 4. ä½¿ç”¨åœºæ™¯è¯¦è§£

#### 4.1 ç¬¬ä¸‰æ–¹åº“å®ä¾‹

**Chart.js å›¾è¡¨åº“**
```javascript
import { ref, markRaw, onMounted } from 'vue'
import Chart from 'chart.js/auto'

export default {
  setup() {
    const canvasRef = ref(null)
    const chartInstance = ref(null)

    onMounted(() => {
      // æ ‡è®° Chart å®ä¾‹ï¼Œé¿å…å“åº”å¼è½¬æ¢
      chartInstance.value = markRaw(new Chart(canvasRef.value, {
        type: 'bar',
        data: {
          labels: ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ'],
          datasets: [{
            label: 'é”€å”®é¢',
            data: [12, 19, 3]
          }]
        }
      }))
    })

    const updateChart = (newData) => {
      if (chartInstance.value) {
        chartInstance.value.data.datasets[0].data = newData
        chartInstance.value.update()
      }
    }

    return {
      canvasRef,
      updateChart
    }
  }
}
```

**Leaflet åœ°å›¾åº“**
```javascript
import { ref, markRaw, onMounted } from 'vue'
import L from 'leaflet'

export default {
  setup() {
    const mapContainer = ref(null)
    const map = ref(null)

    onMounted(() => {
      // æ ‡è®°åœ°å›¾å®ä¾‹
      map.value = markRaw(L.map(mapContainer.value).setView([51.505, -0.09], 13))
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map.value)
    })

    return {
      mapContainer,
      map
    }
  }
}
```

#### 4.2 å¤§å‹é…ç½®å¯¹è±¡

```javascript
import { reactive, markRaw } from 'vue'

// å¤§å‹é…ç½®å¯¹è±¡ï¼Œä¸éœ€è¦å“åº”å¼
const appConfig = markRaw({
  api: {
    baseURL: 'https://api.example.com',
    timeout: 5000,
    retries: 3
  },
  features: {
    enableAnalytics: true,
    enableNotifications: false,
    maxFileSize: 10 * 1024 * 1024
  },
  themes: {
    light: { /* å¤§é‡æ ·å¼é…ç½® */ },
    dark: { /* å¤§é‡æ ·å¼é…ç½® */ }
  },
  // ... æ›´å¤šé…ç½®
})

const appState = reactive({
  config: appConfig, // ä¸ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
  currentUser: null, // ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
  isLoading: false   // ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
})
```

#### 4.3 DOM å…ƒç´ å’Œç»„ä»¶å®ä¾‹

```javascript
import { ref, markRaw, onMounted } from 'vue'

export default {
  setup() {
    const videoRef = ref(null)
    const videoPlayer = ref(null)

    onMounted(() => {
      // æ ‡è®° DOM å…ƒç´ ï¼Œé¿å…å“åº”å¼è½¬æ¢
      videoPlayer.value = markRaw(videoRef.value)
      
      // å¯ä»¥å®‰å…¨åœ°å­˜å‚¨å’Œæ“ä½œ DOM å…ƒç´ 
      videoPlayer.value.addEventListener('play', () => {
        console.log('è§†é¢‘å¼€å§‹æ’­æ”¾')
      })
    })

    return {
      videoRef,
      videoPlayer
    }
  }
}
```

#### 4.4 å‡½æ•°å’Œæ–¹æ³•å¯¹è±¡

```javascript
import { reactive, markRaw } from 'vue'

// å·¥å…·å‡½æ•°é›†åˆ
const utils = markRaw({
  formatDate(date) {
    return new Intl.DateTimeFormat('zh-CN').format(date)
  },
  
  validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
  },
  
  debounce(func, wait) {
    let timeout
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout)
        func(...args)
      }
      clearTimeout(timeout)
      timeout = setTimeout(later, wait)
    }
  }
})

const state = reactive({
  utils, // ä¸ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
  data: [] // ä¼šè¢«è½¬æ¢ä¸ºå“åº”å¼
})
```

### 5. æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

#### 5.1 é¿å…æ·±åº¦å“åº”å¼è½¬æ¢

```javascript
import { reactive, markRaw } from 'vue'

// å¤§å‹æ•°æ®é›†ï¼Œä¸éœ€è¦å“åº”å¼
const largeDataset = markRaw({
  users: new Array(10000).fill(null).map((_, i) => ({
    id: i,
    name: `ç”¨æˆ·${i}`,
    email: `user${i}@example.com`,
    profile: {
      // å¤§é‡åµŒå¥—æ•°æ®
    }
  }))
})

const appState = reactive({
  dataset: largeDataset, // é¿å…å¯¹å¤§å‹æ•°æ®è¿›è¡Œå“åº”å¼è½¬æ¢
  currentPage: 1,        // åªæœ‰å¿…è¦çš„çŠ¶æ€æ˜¯å“åº”å¼çš„
  pageSize: 20
})
```

#### 5.2 ç¼“å­˜è®¡ç®—ç»“æœ

```javascript
import { ref, computed, markRaw } from 'vue'

const data = ref([/* å¤§é‡æ•°æ® */])

// ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ç»“æœ
const expensiveCache = ref(markRaw(new Map()))

const processedData = computed(() => {
  const cacheKey = JSON.stringify(data.value)
  
  if (expensiveCache.value.has(cacheKey)) {
    return expensiveCache.value.get(cacheKey)
  }
  
  // æ‰§è¡Œæ˜‚è´µçš„è®¡ç®—
  const result = heavyComputation(data.value)
  
  // ç¼“å­˜ç»“æœï¼ˆä¸éœ€è¦å“åº”å¼ï¼‰
  expensiveCache.value.set(cacheKey, markRaw(result))
  
  return result
})
```

### 6. ä¸å…¶ä»– API çš„å¯¹æ¯”

#### 6.1 markRaw vs shallowReactive

```javascript
import { reactive, shallowReactive, markRaw } from 'vue'

const obj = {
  level1: {
    level2: {
      value: 'test'
    }
  }
}

// reactive: æ·±åº¦å“åº”å¼
const deepReactive = reactive(obj)

// shallowReactive: æµ…å±‚å“åº”å¼
const shallow = shallowReactive(obj)

// markRaw: å®Œå…¨éå“åº”å¼
const marked = markRaw(obj)
const container = reactive({
  marked // marked æœ¬èº«ä¸ä¼šå˜æˆå“åº”å¼
})
```

#### 6.2 markRaw vs readonly

```javascript
import { reactive, readonly, markRaw } from 'vue'

const data = { count: 0 }

// readonly: åˆ›å»ºåªè¯»çš„å“åº”å¼å¯¹è±¡
const readonlyData = readonly(reactive(data))

// markRaw: åˆ›å»ºéå“åº”å¼å¯¹è±¡
const rawData = markRaw(data)
const state = reactive({
  readonly: readonlyData, // å“åº”å¼ä½†åªè¯»
  raw: rawData           // éå“åº”å¼
})
```

### 7. æœ€ä½³å®è·µ

#### 7.1 ä½•æ—¶ä½¿ç”¨ markRaw

```javascript
// âœ… é€‚åˆä½¿ç”¨ markRaw çš„åœºæ™¯
const scenarios = {
  // ç¬¬ä¸‰æ–¹åº“å®ä¾‹
  chart: markRaw(new Chart()),
  
  // å¤§å‹é™æ€é…ç½®
  config: markRaw(LARGE_CONFIG_OBJECT),
  
  // DOM å…ƒç´ å¼•ç”¨
  element: markRaw(document.getElementById('canvas')),
  
  // å·¥å…·å‡½æ•°é›†åˆ
  utils: markRaw(UTILITY_FUNCTIONS),
  
  // ç¼“å­˜å¯¹è±¡
  cache: markRaw(new Map())
}

// âŒ ä¸é€‚åˆä½¿ç”¨ markRaw çš„åœºæ™¯
const badScenarios = {
  // éœ€è¦å“åº”å¼çš„ç”¨æˆ·æ•°æ®
  user: { name: 'å¼ ä¸‰' }, // ä¸è¦ç”¨ markRaw
  
  // éœ€è¦è¿½è¸ªå˜åŒ–çš„çŠ¶æ€
  loading: false, // ä¸è¦ç”¨ markRaw
  
  // è¡¨å•æ•°æ®
  form: { email: '', password: '' } // ä¸è¦ç”¨ markRaw
}
```

#### 7.2 ç»„åˆä½¿ç”¨æ¨¡å¼

```javascript
import { reactive, ref, markRaw } from 'vue'

// æ··åˆä½¿ç”¨å“åº”å¼å’Œéå“åº”å¼æ•°æ®
const useChart = () => {
  const chartData = ref([]) // å“åº”å¼æ•°æ®
  const chartInstance = ref(null) // å­˜å‚¨éå“åº”å¼å®ä¾‹
  
  const initChart = (canvas) => {
    chartInstance.value = markRaw(new Chart(canvas, {
      type: 'line',
      data: {
        datasets: [{
          data: chartData.value // ä½¿ç”¨å“åº”å¼æ•°æ®
        }]
      }
    }))
  }
  
  const updateChart = () => {
    if (chartInstance.value) {
      chartInstance.value.data.datasets[0].data = chartData.value
      chartInstance.value.update()
    }
  }
  
  // ç›‘å¬å“åº”å¼æ•°æ®å˜åŒ–ï¼Œæ›´æ–°éå“åº”å¼å›¾è¡¨
  watch(chartData, updateChart, { deep: true })
  
  return {
    chartData,
    initChart,
    updateChart
  }
}
```

### 8. å¸¸è§é™·é˜±å’Œæ³¨æ„äº‹é¡¹

#### 8.1 ä¸å¯é€†æ€§

```javascript
import { markRaw, reactive, isReactive } from 'vue'

const obj = { name: 'å¼ ä¸‰' }

// ä¸€æ—¦æ ‡è®°ä¸º rawï¼Œå°±æ— æ³•æ’¤é”€
const markedObj = markRaw(obj)

// å³ä½¿å†æ¬¡åŒ…è£…ï¼Œä¹Ÿä¸ä¼šå˜æˆå“åº”å¼
const wrappedObj = reactive(markedObj)
console.log(isReactive(wrappedObj)) // false

// æ­£ç¡®çš„åšæ³•ï¼šåœ¨æ ‡è®°å‰å†³å®šå¥½
const shouldBeReactive = true
const finalObj = shouldBeReactive ? reactive(obj) : markRaw(obj)
```

#### 8.2 åµŒå¥—å¯¹è±¡çš„å½±å“

```javascript
import { markRaw, reactive } from 'vue'

const nestedObj = {
  level1: {
    level2: {
      value: 'test'
    }
  }
}

// markRaw ä¼šå½±å“æ•´ä¸ªå¯¹è±¡æ ‘
const marked = markRaw(nestedObj)
const container = reactive({
  data: marked
})

// æ•´ä¸ªåµŒå¥—ç»“æ„éƒ½ä¸æ˜¯å“åº”å¼çš„
console.log(isReactive(container.data.level1)) // false
console.log(isReactive(container.data.level1.level2)) // false
```

#### 8.3 ä¸ TypeScript çš„é…åˆ

```typescript
import { markRaw, reactive } from 'vue'

interface ChartInstance {
  update(): void
  destroy(): void
}

interface AppState {
  chart: ChartInstance | null
  data: number[]
}

const state = reactive<AppState>({
  chart: null,
  data: []
})

// ç±»å‹å®‰å…¨çš„ markRaw ä½¿ç”¨
const initChart = (canvas: HTMLCanvasElement) => {
  const chart = new Chart(canvas, {/* config */}) as ChartInstance
  state.chart = markRaw(chart) // TypeScript ä¼šæ­£ç¡®æ¨æ–­ç±»å‹
}
```

### 9. æ€§èƒ½æµ‹è¯•å’Œå¯¹æ¯”

```javascript
import { reactive, markRaw } from 'vue'

// æ€§èƒ½æµ‹è¯•ï¼šå¤§å‹å¯¹è±¡çš„å“åº”å¼è½¬æ¢
const largeObject = {
  // 10000 ä¸ªå±æ€§çš„å¯¹è±¡
}

console.time('reactive conversion')
const reactiveObj = reactive(largeObject)
console.timeEnd('reactive conversion')

console.time('markRaw conversion')
const rawObj = markRaw(largeObject)
const container = reactive({ data: rawObj })
console.timeEnd('markRaw conversion')

// markRaw ç‰ˆæœ¬ä¼šæ˜¾è‘—æ›´å¿«
```

### 10. æ‰©å±•çŸ¥è¯†ç‚¹

1. **å“åº”å¼ç³»ç»ŸåŸç†**ï¼šäº†è§£ Vue 3 å¦‚ä½•æ£€æµ‹å’Œè·³è¿‡ markRaw å¯¹è±¡
2. **å†…å­˜ç®¡ç†**ï¼šmarkRaw å¯¹è±¡çš„å†…å­˜å ç”¨å’Œåƒåœ¾å›æ”¶
3. **SSR è€ƒè™‘**ï¼šæœåŠ¡ç«¯æ¸²æŸ“ä¸­ markRaw çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹
4. **è°ƒè¯•æŠ€å·§**ï¼šå¦‚ä½•åœ¨å¼€å‘å·¥å…·ä¸­è¯†åˆ« markRaw å¯¹è±¡

---

## 11. Vue ä¸­çš„ h å‡½æ•°æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

### 1. æ ¸å¿ƒæ¦‚å¿µ

`h` å‡½æ•°æ˜¯ Vue ä¸­ç”¨äºåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼ˆVNodeï¼‰çš„æ ¸å¿ƒå‡½æ•°ï¼Œå®ƒæ˜¯ `hyperscript` çš„ç¼©å†™ï¼Œä¹Ÿæ˜¯ `createElement` çš„ç®€åŒ–ç‰ˆæœ¬ã€‚åœ¨ Vue 3 ä¸­ï¼Œ`h` å‡½æ•°æ˜¯æ„å»ºæ¸²æŸ“å‡½æ•°çš„åŸºç¡€å·¥å…·ã€‚

### 2. åŸºæœ¬è¯­æ³•

```javascript
import { h } from 'vue'

// åŸºæœ¬è¯­æ³•ï¼šh(tag, props, children)
const vnode = h('div', { class: 'container' }, 'Hello World')
```

#### å‚æ•°è¯´æ˜

1. **tag**ï¼šå…ƒç´ æ ‡ç­¾åã€ç»„ä»¶æˆ–ç»„ä»¶é€‰é¡¹å¯¹è±¡
2. **props**ï¼šå±æ€§å¯¹è±¡ï¼ˆå¯é€‰ï¼‰
3. **children**ï¼šå­èŠ‚ç‚¹ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„æˆ–å…¶ä»– VNode

### 3. è¯¦ç»†ç”¨æ³•ç¤ºä¾‹

#### 3.1 åˆ›å»ºåŸºæœ¬å…ƒç´ 

```javascript
import { h } from 'vue'

// åˆ›å»ºç®€å•å…ƒç´ 
const simpleDiv = h('div', 'Hello World')

// å¸¦å±æ€§çš„å…ƒç´ 
const styledDiv = h('div', {
  class: 'container',
  style: { color: 'red', fontSize: '16px' },
  id: 'main'
}, 'Styled Content')

// å¸¦äº‹ä»¶çš„å…ƒç´ 
const buttonWithEvent = h('button', {
  onClick: () => console.log('clicked'),
  onMouseover: () => console.log('hover')
}, 'Click Me')
```

#### 3.2 åˆ›å»ºåµŒå¥—ç»“æ„

```javascript
import { h } from 'vue'

// åµŒå¥—å…ƒç´ 
const nestedStructure = h('div', { class: 'wrapper' }, [
  h('h1', 'Title'),
  h('p', 'This is a paragraph'),
  h('ul', [
    h('li', 'Item 1'),
    h('li', 'Item 2'),
    h('li', 'Item 3')
  ])
])

// å¤æ‚çš„è¡¨å•ç»“æ„
const formStructure = h('form', { class: 'form' }, [
  h('div', { class: 'form-group' }, [
    h('label', { for: 'email' }, 'Email:'),
    h('input', {
      type: 'email',
      id: 'email',
      placeholder: 'Enter your email'
    })
  ]),
  h('div', { class: 'form-group' }, [
    h('label', { for: 'password' }, 'Password:'),
    h('input', {
      type: 'password',
      id: 'password',
      placeholder: 'Enter your password'
    })
  ]),
  h('button', { type: 'submit' }, 'Submit')
])
```

#### 3.3 æ¸²æŸ“ç»„ä»¶

```javascript
import { h } from 'vue'
import MyComponent from './MyComponent.vue'

// æ¸²æŸ“ç»„ä»¶
const componentVNode = h(MyComponent, {
  // ä¼ é€’ props
  title: 'Hello',
  count: 42,
  // ä¼ é€’äº‹ä»¶ç›‘å¬å™¨
  onUpdate: (value) => console.log('Updated:', value)
})

// æ¸²æŸ“å¸¦æ’æ§½çš„ç»„ä»¶
const componentWithSlots = h(MyComponent, {
  title: 'Component with slots'
}, {
  // é»˜è®¤æ’æ§½
  default: () => h('p', 'Default slot content'),
  // å…·åæ’æ§½
  header: () => h('h2', 'Header slot content'),
  footer: () => h('div', 'Footer slot content')
})
```

### 4. å®é™…åº”ç”¨åœºæ™¯

#### 4.1 åŠ¨æ€ç»„ä»¶æ¸²æŸ“

```javascript
import { h, ref, computed } from 'vue'
import ButtonComponent from './Button.vue'
import InputComponent from './Input.vue'
import SelectComponent from './Select.vue'

export default {
  setup() {
    const componentType = ref('button')
    const componentProps = ref({ text: 'Click me' })

    const componentMap = {
      button: ButtonComponent,
      input: InputComponent,
      select: SelectComponent
    }

    const dynamicComponent = computed(() => {
      const Component = componentMap[componentType.value]
      return h(Component, componentProps.value)
    })

    return () => h('div', [
      h('select', {
        onChange: (e) => componentType.value = e.target.value
      }, [
        h('option', { value: 'button' }, 'Button'),
        h('option', { value: 'input' }, 'Input'),
        h('option', { value: 'select' }, 'Select')
      ]),
      dynamicComponent.value
    ])
  }
}
```

#### 4.2 æ¡ä»¶æ¸²æŸ“

```javascript
import { h, ref } from 'vue'

export default {
  setup() {
    const isLoggedIn = ref(false)
    const user = ref({ name: 'John', role: 'admin' })

    return () => h('div', [
      // æ¡ä»¶æ¸²æŸ“
      isLoggedIn.value
        ? h('div', { class: 'user-info' }, [
            h('h2', `Welcome, ${user.value.name}!`),
            user.value.role === 'admin'
              ? h('button', { class: 'admin-btn' }, 'Admin Panel')
              : null
          ])
        : h('div', { class: 'login-form' }, [
            h('h2', 'Please Login'),
            h('button', {
              onClick: () => isLoggedIn.value = true
            }, 'Login')
          ])
    ])
  }
}
```

#### 4.3 åˆ—è¡¨æ¸²æŸ“

```javascript
import { h, ref } from 'vue'

export default {
  setup() {
    const items = ref([
      { id: 1, name: 'Apple', price: 1.2 },
      { id: 2, name: 'Banana', price: 0.8 },
      { id: 3, name: 'Orange', price: 1.5 }
    ])

    const removeItem = (id) => {
      items.value = items.value.filter(item => item.id !== id)
    }

    return () => h('div', [
      h('h2', 'Shopping List'),
      h('ul', { class: 'item-list' },
        items.value.map(item =>
          h('li', { key: item.id, class: 'item' }, [
            h('span', { class: 'name' }, item.name),
            h('span', { class: 'price' }, `$${item.price}`),
            h('button', {
              class: 'remove-btn',
              onClick: () => removeItem(item.id)
            }, 'Remove')
          ])
        )
      )
    ])
  }
}
```

#### 4.4 é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰

```javascript
import { h } from 'vue'

// åˆ›å»ºä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä¸ºä»»ä½•ç»„ä»¶æ·»åŠ åŠ è½½çŠ¶æ€
function withLoading(WrappedComponent) {
  return {
    props: {
      loading: {
        type: Boolean,
        default: false
      }
    },
    setup(props, { attrs, slots }) {
      return () => {
        if (props.loading) {
          return h('div', { class: 'loading' }, [
            h('div', { class: 'spinner' }),
            h('p', 'Loading...')
          ])
        }
        
        return h(WrappedComponent, attrs, slots)
      }
    }
  }
}

// ä½¿ç”¨é«˜é˜¶ç»„ä»¶
import UserProfile from './UserProfile.vue'
const UserProfileWithLoading = withLoading(UserProfile)

export default {
  components: {
    UserProfileWithLoading
  },
  setup() {
    const isLoading = ref(true)
    
    return () => h(UserProfileWithLoading, {
      loading: isLoading.value,
      userId: 123
    })
  }
}
```

#### 4.5 æ¸²æŸ“å‡½æ•°ç»„ä»¶

```javascript
import { h } from 'vue'

// å‡½æ•°å¼ç»„ä»¶
const FunctionalButton = (props, { emit }) => {
  return h('button', {
    class: ['btn', `btn-${props.type}`],
    onClick: () => emit('click')
  }, props.text)
}

FunctionalButton.props = {
  type: {
    type: String,
    default: 'primary'
  },
  text: {
    type: String,
    required: true
  }
}

// ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶
export default {
  setup() {
    const handleClick = () => {
      console.log('Button clicked!')
    }

    return () => h('div', [
      h(FunctionalButton, {
        type: 'primary',
        text: 'Primary Button',
        onClick: handleClick
      }),
      h(FunctionalButton, {
        type: 'secondary',
        text: 'Secondary Button',
        onClick: handleClick
      })
    ])
  }
}
```

### 5. ä¸æ¨¡æ¿è¯­æ³•çš„å¯¹æ¯”

#### 5.1 æ¨¡æ¿è¯­æ³•

```vue
<template>
  <div class="container">
    <h1>{{ title }}</h1>
    <button @click="increment">Count: {{ count }}</button>
    <ul>
      <li v-for="item in items" :key="item.id">
        {{ item.name }}
      </li>
    </ul>
  </div>
</template>

<script>
export default {
  data() {
    return {
      title: 'My App',
      count: 0,
      items: [
        { id: 1, name: 'Item 1' },
        { id: 2, name: 'Item 2' }
      ]
    }
  },
  methods: {
    increment() {
      this.count++
    }
  }
}
</script>
```

#### 5.2 ç­‰ä»·çš„ h å‡½æ•°å®ç°

```javascript
import { h, ref } from 'vue'

export default {
  setup() {
    const title = ref('My App')
    const count = ref(0)
    const items = ref([
      { id: 1, name: 'Item 1' },
      { id: 2, name: 'Item 2' }
    ])

    const increment = () => {
      count.value++
    }

    return () => h('div', { class: 'container' }, [
      h('h1', title.value),
      h('button', {
        onClick: increment
      }, `Count: ${count.value}`),
      h('ul',
        items.value.map(item =>
          h('li', { key: item.id }, item.name)
        )
      )
    ])
  }
}
```

### 6. é«˜çº§ç”¨æ³•

#### 6.1 æ’æ§½å¤„ç†

```javascript
import { h } from 'vue'

const MyComponent = {
  setup(props, { slots }) {
    return () => h('div', { class: 'my-component' }, [
      // æ¸²æŸ“å…·åæ’æ§½
      slots.header?.(),
      
      // æ¸²æŸ“é»˜è®¤æ’æ§½
      h('main', { class: 'content' }, slots.default?.()),
      
      // æ¸²æŸ“ä½œç”¨åŸŸæ’æ§½
      h('footer', { class: 'footer' },
        slots.footer?.({ 
          year: new Date().getFullYear() 
        })
      )
    ])
  }
}

// ä½¿ç”¨å¸¦æ’æ§½çš„ç»„ä»¶
export default {
  setup() {
    return () => h(MyComponent, {}, {
      header: () => h('h1', 'Header Content'),
      default: () => h('p', 'Main Content'),
      footer: ({ year }) => h('p', `Copyright ${year}`)
    })
  }
}
```

#### 6.2 æŒ‡ä»¤å¤„ç†

```javascript
import { h, withDirectives, vShow } from 'vue'

export default {
  setup() {
    const isVisible = ref(true)
    
    return () => h('div', [
      // ä½¿ç”¨ v-show æŒ‡ä»¤
      withDirectives(
        h('p', 'This content can be hidden'),
        [[vShow, isVisible.value]]
      ),
      
      h('button', {
        onClick: () => isVisible.value = !isVisible.value
      }, 'Toggle Visibility')
    ])
  }
}
```

#### 6.3 Teleport ç»„ä»¶

```javascript
import { h, Teleport } from 'vue'

export default {
  setup() {
    const showModal = ref(false)
    
    return () => h('div', [
      h('button', {
        onClick: () => showModal.value = true
      }, 'Open Modal'),
      
      // ä½¿ç”¨ Teleport
      showModal.value ? h(Teleport, { to: 'body' }, [
        h('div', { class: 'modal-overlay' }, [
          h('div', { class: 'modal' }, [
            h('h2', 'Modal Title'),
            h('p', 'Modal content goes here'),
            h('button', {
              onClick: () => showModal.value = false
            }, 'Close')
          ])
        ])
      ]) : null
    ])
  }
}
```

### 7. æ€§èƒ½ä¼˜åŒ–

#### 7.1 é™æ€æå‡

```javascript
import { h } from 'vue'

// é™æ€èŠ‚ç‚¹å¯ä»¥æå‡åˆ°ç»„ä»¶å¤–éƒ¨
const staticHeader = h('header', { class: 'app-header' }, [
  h('h1', 'My Application'),
  h('nav', [
    h('a', { href: '/home' }, 'Home'),
    h('a', { href: '/about' }, 'About')
  ])
])

export default {
  setup() {
    const dynamicContent = ref('Dynamic content')
    
    return () => h('div', [
      staticHeader, // é™æ€èŠ‚ç‚¹é‡ç”¨
      h('main', dynamicContent.value)
    ])
  }
}
```

#### 7.2 æ¡ä»¶æ¸²æŸ“ä¼˜åŒ–

```javascript
import { h, computed } from 'vue'

export default {
  setup() {
    const userType = ref('guest')
    
    // ä½¿ç”¨ computed ç¼“å­˜å¤æ‚çš„æ¸²æŸ“é€»è¾‘
    const userInterface = computed(() => {
      switch (userType.value) {
        case 'admin':
          return h('div', { class: 'admin-panel' }, [
            h('h2', 'Admin Dashboard'),
            h('button', 'Manage Users'),
            h('button', 'System Settings')
          ])
        case 'user':
          return h('div', { class: 'user-panel' }, [
            h('h2', 'User Dashboard'),
            h('button', 'Profile Settings')
          ])
        default:
          return h('div', { class: 'guest-panel' }, [
            h('h2', 'Welcome Guest'),
            h('button', 'Login'),
            h('button', 'Register')
          ])
      }
    })
    
    return () => h('div', [
      h('select', {
        onChange: (e) => userType.value = e.target.value
      }, [
        h('option', { value: 'guest' }, 'Guest'),
        h('option', { value: 'user' }, 'User'),
        h('option', { value: 'admin' }, 'Admin')
      ]),
      userInterface.value
    ])
  }
}
```

### 8. æœ€ä½³å®è·µ

#### 8.1 ä½•æ—¶ä½¿ç”¨ h å‡½æ•°

```javascript
// âœ… é€‚åˆä½¿ç”¨ h å‡½æ•°çš„åœºæ™¯

// 1. åŠ¨æ€ç»„ä»¶æ¸²æŸ“
const DynamicComponent = (props) => {
  const components = { Button, Input, Select }
  const Component = components[props.type]
  return h(Component, props.componentProps)
}

// 2. å¤æ‚çš„æ¡ä»¶é€»è¾‘
const ComplexConditional = (props) => {
  if (props.loading) return h(LoadingSpinner)
  if (props.error) return h(ErrorMessage, { error: props.error })
  if (props.empty) return h(EmptyState)
  return h(DataList, { data: props.data })
}

// 3. é«˜é˜¶ç»„ä»¶
const withPermission = (Component, permission) => {
  return (props) => {
    if (hasPermission(permission)) {
      return h(Component, props)
    }
    return h('div', 'Access Denied')
  }
}

// âŒ ä¸é€‚åˆä½¿ç”¨ h å‡½æ•°çš„åœºæ™¯

// 1. ç®€å•çš„é™æ€æ¨¡æ¿
// ä½¿ç”¨æ¨¡æ¿æ›´æ¸…æ™°
// <template>
//   <div class="simple">
//     <h1>Title</h1>
//     <p>Content</p>
//   </div>
// </template>

// 2. å¤§é‡çš„é™æ€å†…å®¹
// æ¨¡æ¿çš„å¯è¯»æ€§æ›´å¥½
```

#### 8.2 ä»£ç ç»„ç»‡

```javascript
import { h } from 'vue'

// å°†å¤æ‚çš„æ¸²æŸ“é€»è¾‘æ‹†åˆ†ä¸ºå°å‡½æ•°
const renderHeader = (title, subtitle) => {
  return h('header', { class: 'page-header' }, [
    h('h1', title),
    subtitle ? h('p', { class: 'subtitle' }, subtitle) : null
  ])
}

const renderNavigation = (items) => {
  return h('nav', { class: 'navigation' },
    items.map(item =>
      h('a', {
        href: item.href,
        class: { active: item.active }
      }, item.text)
    )
  )
}

const renderContent = (content) => {
  return h('main', { class: 'content' }, content)
}

export default {
  setup() {
    const pageData = ref({
      title: 'My Page',
      subtitle: 'Page description',
      navigation: [
        { href: '/home', text: 'Home', active: true },
        { href: '/about', text: 'About', active: false }
      ],
      content: 'Page content goes here'
    })

    return () => h('div', { class: 'page' }, [
      renderHeader(pageData.value.title, pageData.value.subtitle),
      renderNavigation(pageData.value.navigation),
      renderContent(pageData.value.content)
    ])
  }
}
```

### 9. è°ƒè¯•æŠ€å·§

```javascript
import { h } from 'vue'

export default {
  setup() {
    const debugMode = ref(process.env.NODE_ENV === 'development')
    
    const createDebugWrapper = (vnode, label) => {
      if (!debugMode.value) return vnode
      
      return h('div', {
        style: { border: '1px solid red', padding: '4px' },
        title: `Debug: ${label}`
      }, [
        h('small', { style: { color: 'red' } }, label),
        vnode
      ])
    }
    
    return () => h('div', [
      createDebugWrapper(
        h('header', 'Header Content'),
        'Page Header'
      ),
      createDebugWrapper(
        h('main', 'Main Content'),
        'Page Content'
      )
    ])
  }
}
```

### 10. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è™šæ‹Ÿ DOM åŸç†**ï¼šäº†è§£ VNode çš„ç»“æ„å’Œ diff ç®—æ³•
2. **ç¼–è¯‘ä¼˜åŒ–**ï¼šVue 3 ç¼–è¯‘å™¨å¦‚ä½•ä¼˜åŒ– h å‡½æ•°è°ƒç”¨
3. **JSX æ”¯æŒ**ï¼šå¦‚ä½•åœ¨ Vue ä¸­ä½¿ç”¨ JSX è¯­æ³•
4. **æ€§èƒ½è€ƒè™‘**ï¼šh å‡½æ•° vs æ¨¡æ¿çš„æ€§èƒ½å¯¹æ¯”
5. **TypeScript æ”¯æŒ**ï¼šh å‡½æ•°çš„ç±»å‹å®šä¹‰å’Œç±»å‹æ¨å¯¼

---

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•) | [ğŸ“ è¿”å›é¢è¯•é¢˜ç®€æ´ç‰ˆæœ¬](./é¢è¯•é¢˜.md)