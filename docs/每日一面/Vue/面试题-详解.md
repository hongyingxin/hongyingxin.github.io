# Vue é¢è¯•é¢˜è¯¦è§£

> è¿™é‡ŒåŒ…å«æ‰€æœ‰Vueé¢è¯•é¢˜çš„è¯¦ç»†è§£æï¼Œé€‚åˆæ·±å…¥å­¦ä¹ å’ŒæŠ€æœ¯é’»ç ”ã€‚

## ç›®å½•

- [1. Vueä¸­ Scoped Styles æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„ï¼Ÿ](#_1-vueä¸­-scoped-styles-æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„)
- [2. Vue3ä¸­çš„ Teleportæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ](#_2-vue3ä¸­çš„-teleportæ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›åº”ç”¨åœºæ™¯)
- [3. ä¸ºä»€ä¹ˆéœ€è¦Piniaæˆ–è€…Vuexï¼Ÿå¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡ï¼Ÿä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ](#_3-ä¸ºä»€ä¹ˆéœ€è¦piniaæˆ–è€…vuex-å¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·-å¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡-ä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›)
- [4. Vue3çš„ addRoute ä¸ React Router çš„åŠ¨æ€ useRoutes æœ‰ä½•åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜ï¼Ÿ](#_4-vue3çš„-addroute-ä¸-react-router-çš„åŠ¨æ€-useroutes-æœ‰ä½•åŒºåˆ«-å¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜)
- [5. Vue3ä¸­çš„ v-model çš„æ”¹è¿›æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ defineModel ç®€åŒ–ä»£ç ï¼Ÿ](#_5-vue3ä¸­çš„-v-model-çš„æ”¹è¿›æ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨-definemodel-ç®€åŒ–ä»£ç )
- [6. Vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ](#_6-vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ)
- [7. åœ¨Vueä¸­ï¼Œä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œDOMï¼Ÿ](#_7-åœ¨vueä¸­ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œdom)

---

## 1. Vueä¸­ Scoped Styles æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_1-vueä¸­-scoped-styles-æ˜¯å¦‚ä½•å®ç°æ ·å¼éš”ç¦»çš„-è¯´è¯´å…·ä½“çš„åŸç†)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vueåº•å±‚å®ç°åŸç†çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **ç¼–è¯‘æ—¶å¤„ç†**ï¼šVueå¦‚ä½•åœ¨ç¼–è¯‘é˜¶æ®µå¤„ç†scopedæ ·å¼
2. **è¿è¡Œæ—¶æœºåˆ¶**ï¼šç»„ä»¶å®ä¾‹åŒ–æ—¶å¦‚ä½•åº”ç”¨æ ·å¼éš”ç¦»
3. **æŠ€æœ¯å®ç°**ï¼šå…·ä½“çš„æŠ€æœ¯æ‰‹æ®µå’ŒåŸç†
4. **ä¼˜ç¼ºç‚¹åˆ†æ**ï¼šscopedæ ·å¼çš„ä¼˜åŠ¿å’Œå±€é™æ€§

#### 1. åŸºæœ¬åŸç†

Vueçš„Scoped Stylesæ˜¯åŸºäº**å±æ€§é€‰æ‹©å™¨**çš„æ ·å¼éš”ç¦»æ–¹æ¡ˆï¼Œé€šè¿‡ä¸ºç»„ä»¶ç”Ÿæˆå”¯ä¸€çš„`data-v-xxxxxx`å±æ€§æ¥å®ç°æ ·å¼éš”ç¦»ã€‚

#### 2. å®ç°æœºåˆ¶

**ç¼–è¯‘é˜¶æ®µï¼š**
- Vueç¼–è¯‘å™¨åœ¨å¤„ç†`.vue`æ–‡ä»¶æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªå¸¦æœ‰`scoped`å±æ€§çš„`<style>`æ ‡ç­¾ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸ŒID
- ä½¿ç”¨PostCSSè§£æCSSï¼Œéå†ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œä¸ºæ¯ä¸ªCSSé€‰æ‹©å™¨æ·»åŠ `[data-v-xxxxxx]`å±æ€§é€‰æ‹©å™¨
- å“ˆå¸ŒIDåŸºäºç»„ä»¶æ–‡ä»¶è·¯å¾„å’Œå†…å®¹ç”Ÿæˆï¼Œç¡®ä¿å”¯ä¸€æ€§

**è¿è¡Œæ—¶é˜¶æ®µï¼š**
- Vueåœ¨æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œä¸ºç»„ä»¶çš„æ ¹å…ƒç´ å’Œæ‰€æœ‰å­å…ƒç´ æ·»åŠ å¯¹åº”çš„`data-v-xxxxxx`å±æ€§
- æµè§ˆå™¨æ ¹æ®CSSé€‰æ‹©å™¨è§„åˆ™ï¼Œåªæœ‰åŒæ—¶åŒ¹é…ç±»åå’Œå±æ€§é€‰æ‹©å™¨çš„å…ƒç´ æ‰ä¼šåº”ç”¨æ ·å¼

#### 3. å…·ä½“ç¤ºä¾‹

**ç¼–è¯‘å‰ï¼š**
```vue
<template>
  <div class="container">
    <h1 class="title">Hello World</h1>
  </div>
</template>

<style scoped>
.container {
  padding: 20px;
}
.title {
  color: red;
}
</style>
```

**ç¼–è¯‘åï¼š**
```html
<!-- æ¨¡æ¿ -->
<div class="container" data-v-f3f3eg9>
  <h1 class="title" data-v-f3f3eg9>Hello World</h1>
</div>

<!-- æ ·å¼ -->
<style>
.container[data-v-f3f3eg9] {
  padding: 20px;
}
.title[data-v-f3f3eg9] {
  color: red;
}
</style>
```

#### 4. æºç å®ç°å…³é”®ç‚¹

**é€‰æ‹©å™¨è½¬æ¢ï¼š**
```javascript
// ç®€åŒ–ç‰ˆå®ç°
export function addScopedIdToSelector(id, selector) {
  return selector.replace(/^(\w+)/, `$1[data-v-${id}]`)
}
```

**å±æ€§æ·»åŠ ï¼š**
```javascript
// ä¸ºå…ƒç´ æ·»åŠ scopedå±æ€§
function addScopedAttr(el, id) {
  el.attrsMap['data-v-' + id] = ''
  el.attrsList.push({ name: 'data-v-' + id, value: '' })
}
```

#### 5. ä¼˜åŠ¿ä¸å±€é™æ€§

**ä¼˜åŠ¿ï¼š**
- âœ… æœ‰æ•ˆé˜²æ­¢æ ·å¼å†²çª
- âœ… æé«˜ç»„ä»¶ç‹¬ç«‹æ€§å’Œå¯ç»´æŠ¤æ€§
- âœ… æ— éœ€é¢å¤–çš„CSSå‘½åè§„èŒƒ
- âœ… ä¸ç°æœ‰CSSè¯­æ³•å®Œå…¨å…¼å®¹

**å±€é™æ€§ï¼š**
- âŒ è½»å¾®çš„æ€§èƒ½å¼€é”€ï¼ˆå±æ€§é€‰æ‹©å™¨ï¼‰
- âŒ æ— æ³•ç›´æ¥ä¿®æ”¹å­ç»„ä»¶æ ·å¼
- âŒ è°ƒè¯•æ—¶ç±»åä¸å¤Ÿç›´è§‚
- âŒ ä¸èƒ½ä½¿ç”¨å…¨å±€æ ·å¼åº“çš„ç±»

#### 6. æ·±åº¦é€‰æ‹©å™¨è§£å†³æ–¹æ¡ˆ

å½“éœ€è¦ä¿®æ”¹å­ç»„ä»¶æ ·å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦é€‰æ‹©å™¨ï¼š

```vue
<style scoped>
/* Vue 3 */
.parent :deep(.child) {
  color: red;
}

/* Vue 2 */
.parent /deep/ .child {
  color: red;
}

.parent >>> .child {
  color: red;
}
</style>
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **CSS Moduleså¯¹æ¯”**ï¼šCSS Modulesé€šè¿‡ç±»åå“ˆå¸ŒåŒ–å®ç°éš”ç¦»ï¼Œè€ŒScoped Stylesé€šè¿‡å±æ€§é€‰æ‹©å™¨å®ç°
2. **æ€§èƒ½è€ƒè™‘**ï¼šå±æ€§é€‰æ‹©å™¨çš„æ€§èƒ½ç•¥ä½äºç±»é€‰æ‹©å™¨ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å½±å“å¾®ä¹å…¶å¾®
3. **SSRæ”¯æŒ**ï¼šScoped Stylesåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­åŒæ ·æœ‰æ•ˆ
4. **æ„å»ºä¼˜åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ä¼šå‹ç¼©å“ˆå¸ŒIDé•¿åº¦ä»¥å‡å°‘åŒ…ä½“ç§¯

---

## 2. Vue3ä¸­çš„ Teleportæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_2-vue3ä¸­çš„-teleportæ˜¯ä»€ä¹ˆ-æœ‰å“ªäº›åº”ç”¨åœºæ™¯)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue3æ–°ç‰¹æ€§çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¦‚å¿µç†è§£**ï¼šTeleportçš„åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
2. **å®ç°åŸç†**ï¼šå¦‚ä½•å®ç°DOMæ¸²æŸ“ä½ç½®ä¸é€»è¾‘å½’å±çš„åˆ†ç¦»
3. **åº”ç”¨åœºæ™¯**ï¼šå®é™…å¼€å‘ä¸­çš„ä½¿ç”¨åœºæ™¯å’Œè§£å†³çš„é—®é¢˜
4. **æŠ€æœ¯å¯¹æ¯”**ï¼šä¸ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿

#### 1. åŸºæœ¬æ¦‚å¿µ

Teleportï¼ˆä¼ é€é—¨ï¼‰æ˜¯Vue3å¼•å…¥çš„å†…ç½®ç»„ä»¶ï¼Œå…è®¸æˆ‘ä»¬å°†ç»„ä»¶æ¨¡æ¿çš„ä¸€éƒ¨åˆ†"ä¼ é€"åˆ°DOMä¸­çš„ä»»æ„ä½ç½®ï¼Œè€Œä¸æ”¹å˜ç»„ä»¶çš„é€»è¾‘å±‚çº§å…³ç³»ã€‚

#### 2. æ ¸å¿ƒç‰¹æ€§

**é€»è¾‘ä¸æ¸²æŸ“åˆ†ç¦»ï¼š**
- ç»„ä»¶çš„çŠ¶æ€ã€äº‹ä»¶å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸç­‰é€»è¾‘ä»ç„¶å±äºåŸç»„ä»¶æ ‘
- åªæœ‰DOMæ¸²æŸ“ä½ç½®å‘ç”Ÿæ”¹å˜
- ä¿æŒäº†Vueçš„å“åº”å¼ç³»ç»Ÿå’Œç»„ä»¶é€šä¿¡æœºåˆ¶

#### 3. åŸºæœ¬ç”¨æ³•

```vue
<template>
  <div class="container">
    <h1>æˆ‘çš„ç»„ä»¶</h1>
    
    <!-- å°†æ¨¡æ€æ¡†ä¼ é€åˆ° body ä¸‹ -->
    <Teleport to="body">
      <div class="modal" v-if="showModal">
        <div class="modal-content">
          <h2>æ¨¡æ€æ¡†æ ‡é¢˜</h2>
          <p>è¿™ä¸ªæ¨¡æ€æ¡†è¢«æ¸²æŸ“åˆ°äº† body ä¸‹</p>
          <button @click="showModal = false">å…³é—­</button>
        </div>
      </div>
    </Teleport>
    
    <button @click="showModal = true">æ‰“å¼€æ¨¡æ€æ¡†</button>
  </div>
</template>

<script setup>
import { ref } from 'vue'
const showModal = ref(false)
</script>
```

#### 4. å®ç°åŸç†

**ç¼–è¯‘æ—¶å¤„ç†ï¼š**
- Vueç¼–è¯‘å™¨è¯†åˆ«`<Teleport>`æ ‡ç­¾
- å°†å…¶å†…å®¹æ ‡è®°ä¸ºéœ€è¦ç‰¹æ®Šå¤„ç†çš„èŠ‚ç‚¹
- ç”Ÿæˆç‰¹æ®Šçš„æ¸²æŸ“å‡½æ•°

**è¿è¡Œæ—¶æœºåˆ¶ï¼š**
```javascript
// ç®€åŒ–çš„å®ç°åŸç†
function renderTeleport(vnode, container) {
  const { to, children } = vnode.props
  const target = document.querySelector(to)
  
  if (target) {
    // å°†å­èŠ‚ç‚¹æ¸²æŸ“åˆ°ç›®æ ‡ä½ç½®
    render(children, target)
  }
}
```

#### 5. è¯¦ç»†åº”ç”¨åœºæ™¯

##### 5.1 æ¨¡æ€æ¡†/å¯¹è¯æ¡†
```vue
<template>
  <Teleport to="body">
    <div class="modal-overlay" v-if="visible" @click="close">
      <div class="modal" @click.stop>
        <slot></slot>
      </div>
    </div>
  </Teleport>
</template>

<style scoped>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}
</style>
```

##### 5.2 Toasté€šçŸ¥ç»„ä»¶
```vue
<template>
  <Teleport to="#toast-container">
    <Transition name="toast">
      <div class="toast" v-if="visible">
        {{ message }}
      </div>
    </Transition>
  </Teleport>
</template>
```

##### 5.3 ä¸‹æ‹‰èœå•
```vue
<template>
  <div class="dropdown" ref="triggerRef">
    <button @click="toggle">ä¸‹æ‹‰èœå•</button>
    
    <Teleport to="body">
      <div 
        class="dropdown-menu" 
        v-if="visible"
        :style="menuStyle"
      >
        <slot></slot>
      </div>
    </Teleport>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const triggerRef = ref()
const visible = ref(false)

const menuStyle = computed(() => {
  if (!triggerRef.value) return {}
  
  const rect = triggerRef.value.getBoundingClientRect()
  return {
    position: 'absolute',
    top: rect.bottom + 'px',
    left: rect.left + 'px'
  }
})
</script>
```

#### 6. é«˜çº§ç‰¹æ€§

##### 6.1 æ¡ä»¶ä¼ é€
```vue
<template>
  <Teleport :to="isMobile ? 'body' : '.desktop-container'">
    <MyComponent />
  </Teleport>
</template>
```

##### 6.2 ç¦ç”¨ä¼ é€
```vue
<template>
  <Teleport to="body" :disabled="!shouldTeleport">
    <MyComponent />
  </Teleport>
</template>
```

##### 6.3 å¤šä¸ªTeleportåˆ°åŒä¸€ç›®æ ‡
```vue
<!-- å¤šä¸ªç»„ä»¶å¯ä»¥ä¼ é€åˆ°åŒä¸€ä¸ªå®¹å™¨ -->
<Teleport to="#modals">
  <Modal1 />
</Teleport>

<Teleport to="#modals">
  <Modal2 />
</Teleport>
```

#### 7. ä¸ä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”

**ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜ï¼š**
- ä½¿ç”¨`document.body.appendChild`ç ´åäº†Vueçš„å“åº”å¼ç³»ç»Ÿ
- éœ€è¦æ‰‹åŠ¨ç®¡ç†DOMèŠ‚ç‚¹çš„åˆ›å»ºå’Œé”€æ¯
- äº‹ä»¶å¤„ç†å’ŒçŠ¶æ€ç®¡ç†å¤æ‚
- ç»„ä»¶å¸è½½æ—¶å®¹æ˜“å‡ºç°å†…å­˜æ³„æ¼

**Teleportä¼˜åŠ¿ï¼š**
- ä¿æŒVueçš„å“åº”å¼å’Œç»„ä»¶ç³»ç»Ÿå®Œæ•´æ€§
- è‡ªåŠ¨å¤„ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
- ç®€åŒ–äº‹ä»¶å¤„ç†å’ŒçŠ¶æ€ç®¡ç†
- æ›´å¥½çš„TypeScriptæ”¯æŒ

#### 8. æ³¨æ„äº‹é¡¹

1. **ç›®æ ‡å…ƒç´ å­˜åœ¨æ€§**ï¼šç¡®ä¿`to`æŒ‡å®šçš„å…ƒç´ åœ¨DOMä¸­å­˜åœ¨
2. **SSRå…¼å®¹æ€§**ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†
3. **æ ·å¼ä½œç”¨åŸŸ**ï¼šTeleportå†…å®¹çš„æ ·å¼å¯èƒ½ä¸å—çˆ¶ç»„ä»¶scopedæ ·å¼å½±å“
4. **äº‹ä»¶å†’æ³¡**ï¼šäº‹ä»¶ä»ç„¶ä¼šæŒ‰ç…§é€»è¾‘ç»„ä»¶æ ‘å†’æ³¡ï¼Œè€Œä¸æ˜¯DOMæ ‘

#### 9. æ‰©å±•çŸ¥è¯†ç‚¹

1. **React Portalå¯¹æ¯”**ï¼šTeleportç±»ä¼¼äºReactçš„Portalï¼Œä½†ä¿æŒäº†Vueçš„å“åº”å¼ç‰¹æ€§
2. **æ€§èƒ½è€ƒè™‘**ï¼šTeleportä¸ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºåªæ˜¯æ”¹å˜äº†æ¸²æŸ“ä½ç½®
3. **è°ƒè¯•æŠ€å·§**ï¼šVue DevToolsä¸­ä»ç„¶æŒ‰ç…§é€»è¾‘ç»„ä»¶æ ‘æ˜¾ç¤º
4. **å…¼å®¹æ€§**ï¼šVue3ç‹¬æœ‰ç‰¹æ€§ï¼ŒVue2éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°ç±»ä¼¼åŠŸèƒ½

---

## 3. ä¸ºä»€ä¹ˆéœ€è¦Piniaæˆ–è€…Vuexï¼Ÿå¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡ï¼Ÿä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_3-ä¸ºä»€ä¹ˆéœ€è¦piniaæˆ–è€…vuex-å¦‚æœä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·-å¦‚ä½•å®ç°è·¨ç»„ä»¶é€šä¿¡-ä»£æ›¿æ–¹æ¡ˆæœ‰å“ªäº›)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥VueçŠ¶æ€ç®¡ç†å’Œç»„ä»¶é€šä¿¡çš„ç»¼åˆæ€§é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **çŠ¶æ€ç®¡ç†å¿…è¦æ€§**ï¼šç†è§£ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†å·¥å…·
2. **ç»„ä»¶é€šä¿¡æ–¹æ¡ˆ**ï¼šæŒæ¡å„ç§è·¨ç»„ä»¶é€šä¿¡çš„æ–¹æ³•
3. **æ–¹æ¡ˆå¯¹æ¯”**ï¼šäº†è§£ä¸åŒæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯
4. **æŠ€æœ¯é€‰å‹**ï¼šèƒ½å¤Ÿæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆ

#### 1. ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†å·¥å…·

##### 1.1 åº”ç”¨å¤æ‚åº¦é—®é¢˜

**å°å‹åº”ç”¨ï¼š**
```vue
<!-- ç®€å•çš„çˆ¶å­ç»„ä»¶é€šä¿¡ -->
<template>
  <ChildComponent :count="count" @increment="count++" />
</template>
```

**å¤æ‚åº”ç”¨é—®é¢˜ï¼š**
```vue
<!-- å¤šå±‚åµŒå¥—çš„prop drillingé—®é¢˜ -->
<template>
  <GrandParent>
    <Parent :user="user" :theme="theme" :permissions="permissions">
      <Child :user="user" :theme="theme">
        <GrandChild :user="user" />
      </Child>
    </Parent>
  </GrandParent>
</template>
```

##### 1.2 çŠ¶æ€ç®¡ç†ç—›ç‚¹

1. **Prop Drilling**ï¼šæ•°æ®éœ€è¦å±‚å±‚ä¼ é€’ï¼Œä¸­é—´ç»„ä»¶ä¸éœ€è¦ä½†å¿…é¡»æ¥æ”¶
2. **çŠ¶æ€åŒæ­¥**ï¼šå¤šä¸ªç»„ä»¶éœ€è¦åŒæ­¥åŒä¸€ä»½æ•°æ®
3. **çŠ¶æ€æŒä¹…åŒ–**ï¼šé¡µé¢åˆ·æ–°åçŠ¶æ€ä¸¢å¤±
4. **è°ƒè¯•å›°éš¾**ï¼šçŠ¶æ€å˜åŒ–éš¾ä»¥è¿½è¸ªå’Œè°ƒè¯•

#### 2. ä¸ä½¿ç”¨çŠ¶æ€ç®¡ç†çš„è·¨ç»„ä»¶é€šä¿¡æ–¹æ¡ˆ

##### 2.1 Props/Emitï¼ˆçˆ¶å­é€šä¿¡ï¼‰

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <ChildComponent 
    :message="parentMessage" 
    @child-event="handleChildEvent" 
  />
</template>

<script setup>
import { ref } from 'vue'

const parentMessage = ref('Hello from parent')
const handleChildEvent = (data) => {
  console.log('æ”¶åˆ°å­ç»„ä»¶æ•°æ®:', data)
}
</script>
```

```vue
<!-- å­ç»„ä»¶ -->
<template>
  <div>
    <p>{{ message }}</p>
    <button @click="sendToParent">å‘é€ç»™çˆ¶ç»„ä»¶</button>
  </div>
</template>

<script setup>
const props = defineProps(['message'])
const emit = defineEmits(['child-event'])

const sendToParent = () => {
  emit('child-event', 'Hello from child')
}
</script>
```

**ä¼˜ç‚¹ï¼š** ç®€å•ç›´æ¥ï¼ŒVueå®˜æ–¹æ¨è
**ç¼ºç‚¹ï¼š** å¤šå±‚åµŒå¥—æ—¶éœ€è¦å±‚å±‚ä¼ é€’

##### 2.2 Provide/Injectï¼ˆç¥–å…ˆåä»£é€šä¿¡ï¼‰

```vue
<!-- ç¥–å…ˆç»„ä»¶ -->
<template>
  <div>
    <button @click="updateTheme">åˆ‡æ¢ä¸»é¢˜</button>
    <ChildComponent />
  </div>
</template>

<script setup>
import { ref, provide } from 'vue'

const theme = ref('light')
const updateTheme = () => {
  theme.value = theme.value === 'light' ? 'dark' : 'light'
}

// æä¾›æ•°æ®å’Œæ–¹æ³•
provide('theme', theme)
provide('updateTheme', updateTheme)
</script>
```

```vue
<!-- åä»£ç»„ä»¶ -->
<template>
  <div :class="theme">
    <p>å½“å‰ä¸»é¢˜: {{ theme }}</p>
    <button @click="updateTheme">æ”¹å˜ä¸»é¢˜</button>
  </div>
</template>

<script setup>
import { inject } from 'vue'

const theme = inject('theme')
const updateTheme = inject('updateTheme')
</script>
```

**ä¼˜ç‚¹ï¼š** é¿å…prop drillingï¼Œæ”¯æŒå“åº”å¼
**ç¼ºç‚¹ï¼š** éšå¼ä¾èµ–ï¼Œéš¾ä»¥è¿½è¸ªæ•°æ®æ¥æº

##### 2.3 Event Busï¼ˆå…¨å±€äº‹ä»¶æ€»çº¿ï¼‰

```javascript
// eventBus.js
import { ref } from 'vue'

class EventBus {
  constructor() {
    this.events = {}
  }

  on(event, callback) {
    if (!this.events[event]) {
      this.events[event] = []
    }
    this.events[event].push(callback)
  }

  emit(event, data) {
    if (this.events[event]) {
      this.events[event].forEach(callback => callback(data))
    }
  }

  off(event, callback) {
    if (this.events[event]) {
      this.events[event] = this.events[event].filter(cb => cb !== callback)
    }
  }
}

export const eventBus = new EventBus()
```

```vue
<!-- ç»„ä»¶A -->
<template>
  <button @click="sendMessage">å‘é€æ¶ˆæ¯</button>
</template>

<script setup>
import { eventBus } from './eventBus'

const sendMessage = () => {
  eventBus.emit('user-message', { text: 'Hello from A' })
}
</script>
```

```vue
<!-- ç»„ä»¶B -->
<template>
  <div>{{ message }}</div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import { eventBus } from './eventBus'

const message = ref('')

const handleMessage = (data) => {
  message.value = data.text
}

onMounted(() => {
  eventBus.on('user-message', handleMessage)
})

onUnmounted(() => {
  eventBus.off('user-message', handleMessage)
})
</script>
```

**ä¼˜ç‚¹ï¼š** ä»»æ„ç»„ä»¶é—´é€šä¿¡ï¼Œä½¿ç”¨ç®€å•
**ç¼ºç‚¹ï¼š** éš¾ä»¥è°ƒè¯•ï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼

##### 2.4 å…¨å±€å˜é‡/Reactive

```javascript
// globalState.js
import { reactive } from 'vue'

export const globalState = reactive({
  user: null,
  theme: 'light',
  count: 0,
  
  // æ–¹æ³•
  setUser(user) {
    this.user = user
  },
  
  toggleTheme() {
    this.theme = this.theme === 'light' ? 'dark' : 'light'
  },
  
  increment() {
    this.count++
  }
})
```

```vue
<!-- ä»»æ„ç»„ä»¶ -->
<template>
  <div>
    <p>ç”¨æˆ·: {{ globalState.user?.name }}</p>
    <p>ä¸»é¢˜: {{ globalState.theme }}</p>
    <p>è®¡æ•°: {{ globalState.count }}</p>
    <button @click="globalState.increment()">å¢åŠ </button>
  </div>
</template>

<script setup>
import { globalState } from './globalState'
</script>
```

**ä¼˜ç‚¹ï¼š** ç®€å•ç›´æ¥ï¼Œå…¨å±€è®¿é—®
**ç¼ºç‚¹ï¼š** ç ´åç»„ä»¶å°è£…æ€§ï¼Œéš¾ä»¥æµ‹è¯•

#### 3. çŠ¶æ€ç®¡ç†å·¥å…·çš„ä¼˜åŠ¿

##### 3.1 Piniaç¤ºä¾‹

```javascript
// stores/user.js
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    user: null,
    isLoggedIn: false
  }),
  
  getters: {
    userName: (state) => state.user?.name || 'Guest',
    userRole: (state) => state.user?.role || 'visitor'
  },
  
  actions: {
    async login(credentials) {
      try {
        const user = await api.login(credentials)
        this.user = user
        this.isLoggedIn = true
      } catch (error) {
        throw error
      }
    },
    
    logout() {
      this.user = null
      this.isLoggedIn = false
    }
  }
})
```

```vue
<!-- ç»„ä»¶ä¸­ä½¿ç”¨ -->
<template>
  <div>
    <p v-if="userStore.isLoggedIn">
      æ¬¢è¿, {{ userStore.userName }}!
    </p>
    <button @click="handleLogin" v-else>ç™»å½•</button>
  </div>
</template>

<script setup>
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()

const handleLogin = async () => {
  try {
    await userStore.login({ username: 'admin', password: '123' })
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error)
  }
}
</script>
```

##### 3.2 çŠ¶æ€ç®¡ç†å·¥å…·ä¼˜åŠ¿

1. **å¯é¢„æµ‹æ€§**ï¼šçŠ¶æ€å˜åŒ–æœ‰æ˜ç¡®çš„è§„åˆ™å’Œæµç¨‹
2. **è°ƒè¯•å‹å¥½**ï¼šVue DevToolsæ”¯æŒæ—¶é—´æ—…è¡Œè°ƒè¯•
3. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptæ”¯æŒ
4. **æ’ä»¶ç”Ÿæ€**ï¼šæŒä¹…åŒ–ã€åŒæ­¥ç­‰æ’ä»¶ä¸°å¯Œ
5. **æµ‹è¯•å‹å¥½**ï¼šçŠ¶æ€å’Œé€»è¾‘åˆ†ç¦»ï¼Œä¾¿äºå•å…ƒæµ‹è¯•

#### 4. æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| Props/Emit | ç®€å•çˆ¶å­é€šä¿¡ | å®˜æ–¹æ¨èï¼Œç±»å‹å®‰å…¨ | å¤šå±‚åµŒå¥—ç¹ç |
| Provide/Inject | ç¥–å…ˆåä»£é€šä¿¡ | é¿å…prop drilling | éšå¼ä¾èµ– |
| Event Bus | ä»»æ„ç»„ä»¶é€šä¿¡ | ä½¿ç”¨ç®€å• | éš¾è°ƒè¯•ï¼Œæ˜“æ³„æ¼ |
| å…¨å±€å˜é‡ | ç®€å•å…¨å±€çŠ¶æ€ | ç›´æ¥è®¿é—® | ç ´åå°è£…æ€§ |
| Pinia/Vuex | å¤æ‚çŠ¶æ€ç®¡ç† | å¯é¢„æµ‹ï¼Œè°ƒè¯•å‹å¥½ | å­¦ä¹ æˆæœ¬ |

#### 5. é€‰æ‹©å»ºè®®

##### 5.1 å°å‹é¡¹ç›®ï¼ˆ<10ä¸ªç»„ä»¶ï¼‰
- ä¸»è¦ä½¿ç”¨Props/Emit
- å°‘é‡Provide/Injectå¤„ç†æ·±å±‚ä¼ é€’

##### 5.2 ä¸­å‹é¡¹ç›®ï¼ˆ10-50ä¸ªç»„ä»¶ï¼‰
- æ ¸å¿ƒçŠ¶æ€ä½¿ç”¨Pinia
- å±€éƒ¨çŠ¶æ€ä»ç”¨Props/Emit
- é¿å…Event Bus

##### 5.3 å¤§å‹é¡¹ç›®ï¼ˆ>50ä¸ªç»„ä»¶ï¼‰
- å¿…é¡»ä½¿ç”¨Pinia/Vuex
- å»ºç«‹æ¸…æ™°çš„çŠ¶æ€ç®¡ç†è§„èŒƒ
- é…åˆTypeScriptå¢å¼ºç±»å‹å®‰å…¨

#### 6. ç°ä»£æ›¿ä»£æ–¹æ¡ˆ

##### 6.1 Composition API + Composables

```javascript
// composables/useUser.js
import { ref, computed } from 'vue'

const user = ref(null)
const isLoggedIn = computed(() => !!user.value)

export function useUser() {
  const login = async (credentials) => {
    user.value = await api.login(credentials)
  }
  
  const logout = () => {
    user.value = null
  }
  
  return {
    user: readonly(user),
    isLoggedIn,
    login,
    logout
  }
}
```

##### 6.2 Vue 3.3+ defineModel

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <ChildComponent v-model:count="count" />
</template>

<!-- å­ç»„ä»¶ -->
<script setup>
const count = defineModel('count', { default: 0 })
</script>
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **Pinia vs Vuex**ï¼šPiniaæ›´è½»é‡ï¼Œæ›´å¥½çš„TypeScriptæ”¯æŒï¼ŒVue3å®˜æ–¹æ¨è
2. **çŠ¶æ€æŒä¹…åŒ–**ï¼šä½¿ç”¨æ’ä»¶å®ç°localStorage/sessionStorageæŒä¹…åŒ–
3. **SSRè€ƒè™‘**ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶çš„çŠ¶æ€åŒæ­¥é—®é¢˜
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†æ‹†åˆ†storeï¼Œé¿å…ä¸å¿…è¦çš„å“åº”å¼æ›´æ–°

---

## 4. Vue3çš„ addRoute ä¸ React Router çš„åŠ¨æ€ useRoutes æœ‰ä½•åŒºåˆ«ï¼Ÿå¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_4-vue3çš„-addroute-ä¸-react-router-çš„åŠ¨æ€-useroutes-æœ‰ä½•åŒºåˆ«-å¦‚ä½•è§£å†³åŠ¨æ€è·¯ç”±åˆ·æ–°åå¤±æ•ˆçš„é—®é¢˜)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥å‰ç«¯è·¯ç”±ç³»ç»Ÿæ·±åº¦ç†è§£çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¡†æ¶å·®å¼‚**ï¼šVue Routerä¸React Routerçš„è®¾è®¡ç†å¿µå·®å¼‚
2. **åŠ¨æ€è·¯ç”±å®ç°**ï¼šä¸¤ç§æ¡†æ¶å¤„ç†åŠ¨æ€è·¯ç”±çš„ä¸åŒæœºåˆ¶
3. **çŠ¶æ€ç®¡ç†**ï¼šè·¯ç”±çŠ¶æ€çš„æŒä¹…åŒ–å’Œæ¢å¤ç­–ç•¥
4. **å®é™…åº”ç”¨**ï¼šæƒé™è·¯ç”±ã€èœå•åŠ¨æ€åŠ è½½ç­‰å®é™…åœºæ™¯

#### 1. Vue Router addRoute è¯¦è§£

##### 1.1 åŸºæœ¬ç”¨æ³•

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/',
      name: 'Home',
      component: () => import('@/views/Home.vue')
    }
  ]
})

// åŠ¨æ€æ·»åŠ è·¯ç”±
const addDynamicRoute = (routeConfig) => {
  router.addRoute(routeConfig)
}

// æ·»åŠ åµŒå¥—è·¯ç”±
const addNestedRoute = (parentName, childRoute) => {
  router.addRoute(parentName, childRoute)
}

export { router, addDynamicRoute, addNestedRoute }
```

##### 1.2 æƒé™è·¯ç”±å®ç°

```javascript
// utils/permission.js
import { router } from '@/router'
import { useUserStore } from '@/stores/user'

// å¼‚æ­¥è·¯ç”±é…ç½®
const asyncRoutes = [
  {
    path: '/admin',
    name: 'Admin',
    component: () => import('@/layouts/AdminLayout.vue'),
    meta: { roles: ['admin'] },
    children: [
      {
        path: 'users',
        name: 'UserManagement',
        component: () => import('@/views/admin/Users.vue'),
        meta: { roles: ['admin'] }
      },
      {
        path: 'settings',
        name: 'SystemSettings',
        component: () => import('@/views/admin/Settings.vue'),
        meta: { roles: ['admin', 'manager'] }
      }
    ]
  },
  {
    path: '/manager',
    name: 'Manager',
    component: () => import('@/layouts/ManagerLayout.vue'),
    meta: { roles: ['manager'] },
    children: [
      {
        path: 'reports',
        name: 'Reports',
        component: () => import('@/views/manager/Reports.vue'),
        meta: { roles: ['manager'] }
      }
    ]
  }
]

// æ ¹æ®ç”¨æˆ·è§’è‰²è¿‡æ»¤è·¯ç”±
function filterAsyncRoutes(routes, roles) {
  const filteredRoutes = []
  
  routes.forEach(route => {
    const tmp = { ...route }
    
    if (hasPermission(roles, tmp)) {
      if (tmp.children) {
        tmp.children = filterAsyncRoutes(tmp.children, roles)
      }
      filteredRoutes.push(tmp)
    }
  })
  
  return filteredRoutes
}

function hasPermission(roles, route) {
  if (route.meta && route.meta.roles) {
    return roles.some(role => route.meta.roles.includes(role))
  }
  return true
}

// åŠ¨æ€æ·»åŠ è·¯ç”±
export function addRoutes(roles) {
  const accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)
  
  accessedRoutes.forEach(route => {
    router.addRoute(route)
  })
  
  // å­˜å‚¨åˆ°æœ¬åœ°ï¼Œè§£å†³åˆ·æ–°é—®é¢˜
  localStorage.setItem('dynamicRoutes', JSON.stringify(accessedRoutes))
  
  return accessedRoutes
}
```

##### 1.3 è·¯ç”±å®ˆå«é›†æˆ

```javascript
// router/guards.js
import { router } from '@/router'
import { useUserStore } from '@/stores/user'
import { addRoutes } from '@/utils/permission'

router.beforeEach(async (to, from, next) => {
  const userStore = useUserStore()
  
  if (userStore.token) {
    if (to.path === '/login') {
      next({ path: '/' })
    } else {
      // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ åŠ¨æ€è·¯ç”±
      if (!userStore.hasAddedRoutes) {
        try {
          // è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
          await userStore.getUserInfo()
          
          // æ·»åŠ åŠ¨æ€è·¯ç”±
          const accessRoutes = addRoutes(userStore.roles)
          userStore.setAddedRoutes(true)
          
          // é‡æ–°å¯¼èˆªåˆ°ç›®æ ‡è·¯ç”±
          next({ ...to, replace: true })
        } catch (error) {
          // è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬ç™»å½•
          userStore.resetToken()
          next('/login')
        }
      } else {
        next()
      }
    }
  } else {
    // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
    if (to.path !== '/login') {
      next('/login')
    } else {
      next()
    }
  }
})
```

#### 2. React Router useRoutes è¯¦è§£

##### 2.1 åŸºæœ¬ç”¨æ³•

```jsx
// App.jsx
import { useRoutes, Navigate } from 'react-router-dom'
import { useSelector } from 'react-redux'
import { useMemo } from 'react'

function App() {
  const { user, permissions } = useSelector(state => state.auth)
  
  // åŸºç¡€è·¯ç”±é…ç½®
  const baseRoutes = [
    {
      path: '/',
      element: <Navigate to="/dashboard" replace />
    },
    {
      path: '/login',
      element: <Login />
    },
    {
      path: '/dashboard',
      element: <Dashboard />
    }
  ]
  
  // åŠ¨æ€è·¯ç”±é…ç½®
  const dynamicRoutes = useMemo(() => {
    if (!user || !permissions.length) return []
    
    const routes = []
    
    if (permissions.includes('admin')) {
      routes.push({
        path: '/admin',
        element: <AdminLayout />,
        children: [
          {
            path: 'users',
            element: <UserManagement />
          },
          {
            path: 'settings',
            element: <SystemSettings />
          }
        ]
      })
    }
    
    if (permissions.includes('manager')) {
      routes.push({
        path: '/manager',
        element: <ManagerLayout />,
        children: [
          {
            path: 'reports',
            element: <Reports />
          }
        ]
      })
    }
    
    return routes
  }, [user, permissions])
  
  // åˆå¹¶è·¯ç”±é…ç½®
  const routes = useMemo(() => {
    return [...baseRoutes, ...dynamicRoutes]
  }, [dynamicRoutes])
  
  const element = useRoutes(routes)
  
  return element
}
```

##### 2.2 æƒé™è·¯ç”±Hook

```jsx
// hooks/usePermissionRoutes.js
import { useMemo } from 'react'
import { useSelector } from 'react-redux'

// è·¯ç”±é…ç½®æ˜ å°„
const routeConfigs = {
  admin: [
    {
      path: '/admin',
      element: <AdminLayout />,
      children: [
        { path: 'users', element: <UserManagement /> },
        { path: 'settings', element: <SystemSettings /> }
      ]
    }
  ],
  manager: [
    {
      path: '/manager',
      element: <ManagerLayout />,
      children: [
        { path: 'reports', element: <Reports /> }
      ]
    }
  ],
  user: [
    {
      path: '/profile',
      element: <UserProfile />
    }
  ]
}

export function usePermissionRoutes() {
  const { user, roles } = useSelector(state => state.auth)
  
  const permissionRoutes = useMemo(() => {
    if (!user || !roles.length) return []
    
    return roles.reduce((acc, role) => {
      const roleRoutes = routeConfigs[role] || []
      return [...acc, ...roleRoutes]
    }, [])
  }, [user, roles])
  
  return permissionRoutes
}
```

##### 2.3 è·¯ç”±æŒä¹…åŒ–å¤„ç†

```jsx
// components/RouteProvider.jsx
import { useEffect, useState } from 'react'
import { useRoutes } from 'react-router-dom'
import { useDispatch, useSelector } from 'react-redux'
import { restoreUserSession } from '@/store/authSlice'

function RouteProvider({ children }) {
  const dispatch = useDispatch()
  const { isInitialized, user } = useSelector(state => state.auth)
  const [routes, setRoutes] = useState([])
  
  // åº”ç”¨åˆå§‹åŒ–æ—¶æ¢å¤ç”¨æˆ·ä¼šè¯
  useEffect(() => {
    const initializeApp = async () => {
      try {
        // ä»localStorageæ¢å¤ç”¨æˆ·ä¿¡æ¯
        const savedUser = localStorage.getItem('user')
        const savedPermissions = localStorage.getItem('permissions')
        
        if (savedUser && savedPermissions) {
          await dispatch(restoreUserSession({
            user: JSON.parse(savedUser),
            permissions: JSON.parse(savedPermissions)
          }))
        }
      } catch (error) {
        console.error('Failed to restore user session:', error)
      }
    }
    
    initializeApp()
  }, [dispatch])
  
  // æ ¹æ®ç”¨æˆ·çŠ¶æ€åŠ¨æ€ç”Ÿæˆè·¯ç”±
  useEffect(() => {
    if (isInitialized) {
      const dynamicRoutes = generateRoutes(user)
      setRoutes(dynamicRoutes)
    }
  }, [isInitialized, user])
  
  const element = useRoutes(routes)
  
  if (!isInitialized) {
    return <LoadingSpinner />
  }
  
  return element
}
```

#### 3. æ ¸å¿ƒå·®å¼‚å¯¹æ¯”

##### 3.1 APIè®¾è®¡ç†å¿µ

| ç‰¹æ€§ | Vue Router addRoute | React Router useRoutes |
|------|---------------------|------------------------|
| **APIç±»å‹** | å‘½ä»¤å¼ | å£°æ˜å¼ |
| **è·¯ç”±å®ä¾‹** | å¯å˜çš„å…¨å±€å®ä¾‹ | ä¸å¯å˜çš„é…ç½®æ•°ç»„ |
| **çŠ¶æ€ç®¡ç†** | è·¯ç”±å™¨å†…éƒ¨ç»´æŠ¤ | ç»„ä»¶çŠ¶æ€é©±åŠ¨ |
| **æ›´æ–°æœºåˆ¶** | ç›´æ¥ä¿®æ”¹è·¯ç”±è¡¨ | é‡æ–°æ¸²æŸ“è·¯ç”±æ ‘ |

##### 3.2 å®ç°æœºåˆ¶å·®å¼‚

**Vue Routerï¼š**
```javascript
// è·¯ç”±å®ä¾‹æ˜¯å¯å˜çš„
const router = createRouter(config)

// è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ 
router.addRoute(newRoute)

// è·¯ç”±çŠ¶æ€æŒä¹…åŒ–åœ¨routerå®ä¾‹ä¸­
console.log(router.getRoutes()) // åŒ…å«åŠ¨æ€æ·»åŠ çš„è·¯ç”±
```

**React Routerï¼š**
```jsx
// æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®—
function App() {
  const routes = useMemo(() => {
    return generateRoutes(userPermissions)
  }, [userPermissions])
  
  return useRoutes(routes) // æ¯æ¬¡éƒ½æ˜¯æ–°çš„è·¯ç”±æ ‘
}
```

##### 3.3 æ€§èƒ½ç‰¹å¾

**Vue Routerä¼˜åŠ¿ï¼š**
- è·¯ç”±æ·»åŠ åæŒä¹…å­˜åœ¨ï¼Œæ— éœ€é‡å¤è®¡ç®—
- è·¯ç”±åŒ¹é…æ€§èƒ½æ›´å¥½ï¼ˆé¢„ç¼–è¯‘çš„è·¯ç”±è¡¨ï¼‰
- å†…å­˜å ç”¨ç›¸å¯¹ç¨³å®š

**React Routerä¼˜åŠ¿ï¼š**
- æ›´ç¬¦åˆReactçš„å‡½æ•°å¼ç†å¿µ
- è·¯ç”±é…ç½®ä¸ç»„ä»¶çŠ¶æ€åŒæ­¥
- æ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•

#### 4. åˆ·æ–°å¤±æ•ˆé—®é¢˜è§£å†³æ–¹æ¡ˆ

##### 4.1 Vue Routerè§£å†³æ–¹æ¡ˆ

```javascript
// stores/permission.js
import { defineStore } from 'pinia'
import { router } from '@/router'

export const usePermissionStore = defineStore('permission', {
  state: () => ({
    routes: [],
    addedRoutes: [],
    hasAddedRoutes: false
  }),
  
  actions: {
    async generateRoutes(roles) {
      const accessedRoutes = filterAsyncRoutes(asyncRoutes, roles)
      this.addedRoutes = accessedRoutes
      return accessedRoutes
    },
    
    addRoutes(routes) {
      routes.forEach(route => {
        router.addRoute(route)
      })
      this.hasAddedRoutes = true
      
      // æŒä¹…åŒ–åˆ°localStorage
      this.persistRoutes(routes)
    },
    
    persistRoutes(routes) {
      localStorage.setItem('addedRoutes', JSON.stringify(routes))
      localStorage.setItem('hasAddedRoutes', 'true')
    },
    
    restoreRoutes() {
      try {
        const savedRoutes = localStorage.getItem('addedRoutes')
        const hasAdded = localStorage.getItem('hasAddedRoutes')
        
        if (savedRoutes && hasAdded === 'true') {
          const routes = JSON.parse(savedRoutes)
          this.addRoutes(routes)
          return true
        }
      } catch (error) {
        console.error('Failed to restore routes:', error)
        this.clearPersistedRoutes()
      }
      return false
    },
    
    clearPersistedRoutes() {
      localStorage.removeItem('addedRoutes')
      localStorage.removeItem('hasAddedRoutes')
      this.hasAddedRoutes = false
      this.addedRoutes = []
    }
  }
})
```

```javascript
// main.js
import { createApp } from 'vue'
import { router } from '@/router'
import { usePermissionStore } from '@/stores/permission'
import { useUserStore } from '@/stores/user'

const app = createApp(App)

// åº”ç”¨å¯åŠ¨æ—¶æ¢å¤è·¯ç”±
router.beforeEach(async (to, from, next) => {
  const userStore = useUserStore()
  const permissionStore = usePermissionStore()
  
  // å¦‚æœç”¨æˆ·å·²ç™»å½•ä½†è·¯ç”±æœªæ·»åŠ ï¼Œå°è¯•æ¢å¤
  if (userStore.token && !permissionStore.hasAddedRoutes) {
    const restored = permissionStore.restoreRoutes()
    
    if (restored) {
      next({ ...to, replace: true })
    } else {
      // æ¢å¤å¤±è´¥ï¼Œé‡æ–°è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
      try {
        await userStore.getUserInfo()
        const accessRoutes = await permissionStore.generateRoutes(userStore.roles)
        permissionStore.addRoutes(accessRoutes)
        next({ ...to, replace: true })
      } catch (error) {
        userStore.resetToken()
        next('/login')
      }
    }
  } else {
    next()
  }
})
```

##### 4.2 React Routerè§£å†³æ–¹æ¡ˆ

```jsx
// hooks/usePersistedAuth.js
import { useEffect } from 'react'
import { useDispatch } from 'react-redux'
import { restoreAuth, clearAuth } from '@/store/authSlice'

export function usePersistedAuth() {
  const dispatch = useDispatch()
  
  useEffect(() => {
    const restoreUserSession = async () => {
      try {
        const savedAuth = localStorage.getItem('authState')
        
        if (savedAuth) {
          const authData = JSON.parse(savedAuth)
          
          // éªŒè¯tokenæ˜¯å¦ä»ç„¶æœ‰æ•ˆ
          const isValid = await validateToken(authData.token)
          
          if (isValid) {
            dispatch(restoreAuth(authData))
          } else {
            localStorage.removeItem('authState')
          }
        }
      } catch (error) {
        console.error('Failed to restore auth:', error)
        localStorage.removeItem('authState')
        dispatch(clearAuth())
      }
    }
    
    restoreUserSession()
  }, [dispatch])
}
```

```jsx
// store/authSlice.js
import { createSlice } from '@reduxjs/toolkit'

const authSlice = createSlice({
  name: 'auth',
  initialState: {
    user: null,
    token: null,
    permissions: [],
    isInitialized: false
  },
  reducers: {
    setAuth: (state, action) => {
      const { user, token, permissions } = action.payload
      state.user = user
      state.token = token
      state.permissions = permissions
      state.isInitialized = true
      
      // æŒä¹…åŒ–åˆ°localStorage
      localStorage.setItem('authState', JSON.stringify({
        user, token, permissions
      }))
    },
    
    restoreAuth: (state, action) => {
      const { user, token, permissions } = action.payload
      state.user = user
      state.token = token
      state.permissions = permissions
      state.isInitialized = true
    },
    
    clearAuth: (state) => {
      state.user = null
      state.token = null
      state.permissions = []
      state.isInitialized = true
      localStorage.removeItem('authState')
    }
  }
})

export const { setAuth, restoreAuth, clearAuth } = authSlice.actions
export default authSlice.reducer
```

#### 5. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è·¯ç”±ç¼“å­˜ç­–ç•¥**ï¼šå¦‚ä½•ä¼˜åŒ–åŠ¨æ€è·¯ç”±çš„åŠ è½½æ€§èƒ½
2. **å¾®å‰ç«¯è·¯ç”±**ï¼šåœ¨å¾®å‰ç«¯æ¶æ„ä¸­çš„åŠ¨æ€è·¯ç”±å¤„ç†
3. **SEOè€ƒè™‘**ï¼šåŠ¨æ€è·¯ç”±å¯¹æœç´¢å¼•æ“ä¼˜åŒ–çš„å½±å“
4. **å®‰å…¨æ€§**ï¼šå‰ç«¯è·¯ç”±æƒé™ä¸åç«¯APIæƒé™çš„é…åˆ

---

## 5. Vue3ä¸­çš„ v-model çš„æ”¹è¿›æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨ defineModel ç®€åŒ–ä»£ç ï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_5-vue3ä¸­çš„-v-model-çš„æ”¹è¿›æ˜¯ä»€ä¹ˆ-å¦‚ä½•ä½¿ç”¨-definemodel-ç®€åŒ–ä»£ç )

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue3æ–°ç‰¹æ€§å’ŒAPIæ¼”è¿›çš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **ç‰ˆæœ¬å·®å¼‚**ï¼šVue2ä¸Vue3åœ¨v-modelå®ç°ä¸Šçš„åŒºåˆ«
2. **æ–°ç‰¹æ€§ç†è§£**ï¼šå¤šä¸ªv-modelã€è‡ªå®šä¹‰ä¿®é¥°ç¬¦ç­‰æ–°åŠŸèƒ½
3. **æœ€æ–°API**ï¼šdefineModelå®çš„ä½¿ç”¨å’Œä¼˜åŠ¿
4. **å®é™…åº”ç”¨**ï¼šåœ¨ç»„ä»¶å¼€å‘ä¸­çš„æœ€ä½³å®è·µ

#### 1. Vue2 vs Vue3 v-model å¯¹æ¯”

##### 1.1 Vue2 v-model é™åˆ¶

```vue
<!-- Vue2 - åªèƒ½æœ‰ä¸€ä¸ª v-model -->
<template>
  <CustomInput v-model="value" />
</template>

<!-- CustomInput.vue -->
<template>
  <input 
    :value="value" 
    @input="$emit('input', $event.target.value)"
  />
</template>

<script>
export default {
  props: ['value'], // å›ºå®šçš„ prop åç§°
  // åªèƒ½ç›‘å¬ 'input' äº‹ä»¶
}
</script>
```

##### 1.2 Vue3 v-model æ”¹è¿›

```vue
<!-- Vue3 - æ”¯æŒå¤šä¸ª v-model -->
<template>
  <UserForm 
    v-model:name="userName"
    v-model:email="userEmail"
    v-model:age="userAge"
  />
</template>

<!-- UserForm.vue -->
<template>
  <div>
    <input 
      :value="name"
      @input="$emit('update:name', $event.target.value)"
      placeholder="å§“å"
    />
    <input 
      :value="email"
      @input="$emit('update:email', $event.target.value)"
      placeholder="é‚®ç®±"
    />
    <input 
      :value="age"
      @input="$emit('update:age', $event.target.value)"
      placeholder="å¹´é¾„"
      type="number"
    />
  </div>
</template>

<script setup>
// å®šä¹‰ props
defineProps(['name', 'email', 'age'])

// å®šä¹‰ emits
defineEmits(['update:name', 'update:email', 'update:age'])
</script>
```

#### 2. Vue3 v-model æ–°ç‰¹æ€§è¯¦è§£

##### 2.1 å¤šä¸ª v-model

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <div>
    <h3>ç”¨æˆ·ä¿¡æ¯</h3>
    <p>å§“å: {{ form.name }}</p>
    <p>é‚®ç®±: {{ form.email }}</p>
    <p>ç”µè¯: {{ form.phone }}</p>
    
    <UserEditor
      v-model:name="form.name"
      v-model:email="form.email"
      v-model:phone="form.phone"
    />
  </div>
</template>

<script setup>
import { reactive } from 'vue'

const form = reactive({
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  phone: '13800138000'
})
</script>
```

##### 2.2 è‡ªå®šä¹‰ v-model ä¿®é¥°ç¬¦

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <div>
    <!-- ä½¿ç”¨è‡ªå®šä¹‰ä¿®é¥°ç¬¦ -->
    <CustomInput v-model.capitalize="message" />
    <CustomInput v-model.uppercase="title" />
    <CustomInput v-model.trim="description" />
    
    <p>æ¶ˆæ¯: {{ message }}</p>
    <p>æ ‡é¢˜: {{ title }}</p>
    <p>æè¿°: {{ description }}</p>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const message = ref('')
const title = ref('')
const description = ref('')
</script>
```

#### 3. defineModel è¯¦è§£ï¼ˆVue 3.4+ï¼‰

##### 3.1 åŸºæœ¬ç”¨æ³•

```vue
<!-- ä¼ ç»Ÿæ–¹å¼ -->
<template>
  <input 
    :value="modelValue"
    @input="$emit('update:modelValue', $event.target.value)"
  />
</template>

<script setup>
// éœ€è¦æ‰‹åŠ¨å®šä¹‰ props å’Œ emits
defineProps(['modelValue'])
defineEmits(['update:modelValue'])
</script>
```

```vue
<!-- ä½¿ç”¨ defineModel -->
<template>
  <input v-model="model" />
</template>

<script setup>
// ä¸€è¡Œä»£ç æå®š
const model = defineModel()
</script>
```

##### 3.2 å¤šä¸ª defineModel

```vue
<!-- UserForm.vue - ä½¿ç”¨ defineModel -->
<template>
  <div class="user-form">
    <div class="field">
      <label>å§“å:</label>
      <input v-model="name" placeholder="è¯·è¾“å…¥å§“å" />
    </div>
    
    <div class="field">
      <label>é‚®ç®±:</label>
      <input v-model="email" placeholder="è¯·è¾“å…¥é‚®ç®±" type="email" />
    </div>
    
    <div class="field">
      <label>å¹´é¾„:</label>
      <input v-model.number="age" placeholder="è¯·è¾“å…¥å¹´é¾„" type="number" />
    </div>
  </div>
</template>

<script setup>
// å®šä¹‰å¤šä¸ª model
const name = defineModel('name', { default: '' })
const email = defineModel('email', { default: '' })
const age = defineModel('age', { default: 0 })
</script>
```

#### 4. å®é™…åº”ç”¨åœºæ™¯

##### 4.1 è¡¨å•ç»„ä»¶å°è£…

```vue
<!-- FormField.vue -->
<template>
  <div class="form-field" :class="{ error: hasError }">
    <label v-if="label" :for="fieldId">{{ label }}</label>
    
    <input
      :id="fieldId"
      v-model="model"
      :type="type"
      :placeholder="placeholder"
      :disabled="disabled"
      :class="inputClass"
      @blur="validate"
    />
    
    <span v-if="hasError" class="error-message">{{ errorMessage }}</span>
  </div>
</template>

<script setup>
import { computed, ref, watch } from 'vue'

const props = defineProps({
  label: String,
  type: { type: String, default: 'text' },
  placeholder: String,
  disabled: Boolean,
  required: Boolean,
  rules: Array,
  inputClass: String
})

// ä½¿ç”¨ defineModel
const model = defineModel({ required: true })

// ç”Ÿæˆå”¯ä¸€ ID
const fieldId = ref(`field-${Math.random().toString(36).substr(2, 9)}`)

// éªŒè¯çŠ¶æ€
const errorMessage = ref('')
const hasError = computed(() => !!errorMessage.value)

// éªŒè¯å‡½æ•°
const validate = () => {
  if (!props.rules) return true
  
  for (const rule of props.rules) {
    const result = rule(model.value)
    if (result !== true) {
      errorMessage.value = result
      return false
    }
  }
  
  errorMessage.value = ''
  return true
}

// ç›‘å¬å€¼å˜åŒ–ï¼Œæ¸…é™¤é”™è¯¯
watch(model, () => {
  if (hasError.value) {
    errorMessage.value = ''
  }
})

// æš´éœ²éªŒè¯æ–¹æ³•
defineExpose({ validate })
</script>
```

#### 5. TypeScript æ”¯æŒ

```vue
<template>
  <div class="typed-input">
    <input 
      v-model="model"
      :type="inputType"
      :placeholder="placeholder"
    />
  </div>
</template>

<script setup lang="ts">
interface Props {
  placeholder?: string
  inputType?: 'text' | 'email' | 'password' | 'number'
}

// å¸¦ç±»å‹çš„ props
const props = withDefaults(defineProps<Props>(), {
  inputType: 'text'
})

// å¸¦ç±»å‹çš„ defineModel
const model = defineModel<string>({
  required: true
})
</script>
```

#### 6. æ‰©å±•çŸ¥è¯†ç‚¹

1. **ç¼–è¯‘ä¼˜åŒ–**ï¼šdefineModel åœ¨ç¼–è¯‘æ—¶çš„ä¼˜åŒ–æœºåˆ¶
2. **å‘åå…¼å®¹**ï¼šå¦‚ä½•åœ¨ Vue 3.4 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å®ç°ç±»ä¼¼åŠŸèƒ½
3. **æ€§èƒ½å¯¹æ¯”**ï¼šdefineModel vs ä¼ ç»Ÿ props/emit çš„æ€§èƒ½å·®å¼‚
4. **ç”Ÿæ€é›†æˆ**ï¼šä¸ Element Plusã€Ant Design Vue ç­‰ UI åº“çš„é›†æˆ

---

## 6. Vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_6-vue2ä¸­v-modelçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vue2åŸºç¡€åŸç†çš„ç»å…¸é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **è¯­æ³•ç³–ç†è§£**ï¼šv-modelä½œä¸ºè¯­æ³•ç³–çš„æœ¬è´¨
2. **åŒå‘ç»‘å®šæœºåˆ¶**ï¼šæ•°æ®ä¸è§†å›¾çš„åŒå‘åŒæ­¥åŸç†
3. **ç¼–è¯‘è¿‡ç¨‹**ï¼šæ¨¡æ¿ç¼–è¯‘æ—¶çš„è½¬æ¢é€»è¾‘
4. **è¡¨å•å…ƒç´ å·®å¼‚**ï¼šä¸åŒè¡¨å•å…ƒç´ çš„å¤„ç†æ–¹å¼

#### 1. v-model åŸºæœ¬åŸç†

##### 1.1 è¯­æ³•ç³–æœ¬è´¨

```javascript
// v-model çš„æœ¬è´¨
<input v-model="message" />

// ç­‰ä»·äº
<input 
  :value="message" 
  @input="message = $event.target.value" 
/>
```

##### 1.2 åŒå‘ç»‘å®šæœºåˆ¶

```vue
<template>
  <div>
    <input v-model="message" />
    <p>æ¶ˆæ¯: {{ message }}</p>
  </div>
</template>

<script>
export default {
  data() {
    return {
      message: 'Hello Vue!'
    }
  }
}
</script>
```

**å·¥ä½œæµç¨‹ï¼š**
1. **æ•°æ® â†’ è§†å›¾**ï¼š`message`å˜åŒ–æ—¶ï¼Œé€šè¿‡å“åº”å¼ç³»ç»Ÿæ›´æ–°inputçš„value
2. **è§†å›¾ â†’ æ•°æ®**ï¼šç”¨æˆ·è¾“å…¥æ—¶ï¼Œè§¦å‘inputäº‹ä»¶ï¼Œæ›´æ–°`message`çš„å€¼

#### 2. ç¼–è¯‘è¿‡ç¨‹è¯¦è§£

##### 2.1 æ¨¡æ¿ç¼–è¯‘è½¬æ¢

```javascript
// Vueç¼–è¯‘å™¨å¤„ç† v-model
function processVModel(el, dir) {
  const value = dir.value
  const modifiers = dir.modifiers || {}
  
  if (el.tag === 'input') {
    const type = getAndRemoveAttr(el, 'type')
    
    if (type === 'checkbox') {
      // checkbox å¤„ç†
      addProp(el, 'checked', `Array.isArray(${value}) ? _i(${value},null) > -1 : (${value})`)
      addHandler(el, 'change', `var $$a=${value},$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_i($$a,$$v);if($$el.checked){$$i<0&&(${value}=$$a.concat([$$v]))}else{$$i>-1&&(${value}=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{${value}=$$c}`)
    } else if (type === 'radio') {
      // radio å¤„ç†
      addProp(el, 'checked', `_q(${value},${JSON.stringify(el.attrsMap.value)})`)
      addHandler(el, 'change', `${value}=${JSON.stringify(el.attrsMap.value)}`)
    } else {
      // æ™®é€š input å¤„ç†
      addProp(el, 'value', `(${value})`)
      addHandler(el, 'input', `if($event.target.composing)return;${value}=$event.target.value`)
    }
  }
}
```

##### 2.2 ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°

```javascript
// ç¼–è¯‘å‰æ¨¡æ¿
`<input v-model="message" />`

// ç”Ÿæˆçš„æ¸²æŸ“å‡½æ•°
function render() {
  return h('input', {
    domProps: {
      value: this.message
    },
    on: {
      input: function($event) {
        if ($event.target.composing) return
        this.message = $event.target.value
      }.bind(this)
    }
  })
}
```

#### 3. ä¸åŒè¡¨å•å…ƒç´ çš„å¤„ç†

##### 3.1 æ–‡æœ¬è¾“å…¥å…ƒç´ 

```vue
<template>
  <div>
    <!-- input text -->
    <input v-model="textValue" type="text" />
    
    <!-- textarea -->
    <textarea v-model="textareaValue"></textarea>
  </div>
</template>

<script>
export default {
  data() {
    return {
      textValue: '',
      textareaValue: ''
    }
  }
}
</script>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
// input
h('input', {
  domProps: { value: this.textValue },
  on: { 
    input: ($event) => {
      if ($event.target.composing) return
      this.textValue = $event.target.value
    }
  }
})

// textarea
h('textarea', {
  domProps: { value: this.textareaValue },
  on: { 
    input: ($event) => {
      this.textareaValue = $event.target.value
    }
  }
})
```

##### 3.2 å¤é€‰æ¡†å¤„ç†

```vue
<template>
  <div>
    <!-- å•ä¸ªå¤é€‰æ¡† -->
    <input v-model="checked" type="checkbox" />
    
    <!-- å¤šä¸ªå¤é€‰æ¡† -->
    <input v-model="checkedNames" value="Jack" type="checkbox" />
    <input v-model="checkedNames" value="John" type="checkbox" />
    <input v-model="checkedNames" value="Mike" type="checkbox" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      checked: false,
      checkedNames: []
    }
  }
}
</script>
```

**ç¼–è¯‘é€»è¾‘ï¼š**
```javascript
// å•ä¸ªå¤é€‰æ¡†
function updateChecked($event) {
  this.checked = $event.target.checked
}

// å¤šä¸ªå¤é€‰æ¡†
function updateCheckedNames($event) {
  const value = 'Jack' // å¯¹åº”çš„valueå€¼
  const checked = $event.target.checked
  const arr = this.checkedNames
  
  if (checked) {
    if (arr.indexOf(value) < 0) {
      arr.push(value)
    }
  } else {
    const index = arr.indexOf(value)
    if (index > -1) {
      arr.splice(index, 1)
    }
  }
}
```

##### 3.3 å•é€‰æ¡†å¤„ç†

```vue
<template>
  <div>
    <input v-model="picked" value="a" type="radio" />
    <input v-model="picked" value="b" type="radio" />
  </div>
</template>

<script>
export default {
  data() {
    return {
      picked: ''
    }
  }
}
</script>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { 
    checked: this.picked === 'a' 
  },
  on: { 
    change: () => {
      this.picked = 'a'
    }
  }
})
```

##### 3.4 é€‰æ‹©æ¡†å¤„ç†

```vue
<template>
  <div>
    <!-- å•é€‰ -->
    <select v-model="selected">
      <option value="a">A</option>
      <option value="b">B</option>
    </select>
    
    <!-- å¤šé€‰ -->
    <select v-model="multiSelected" multiple>
      <option value="a">A</option>
      <option value="b">B</option>
      <option value="c">C</option>
    </select>
  </div>
</template>

<script>
export default {
  data() {
    return {
      selected: '',
      multiSelected: []
    }
  }
}
</script>
```

#### 4. ä¿®é¥°ç¬¦å¤„ç†

##### 4.1 .lazy ä¿®é¥°ç¬¦

```vue
<template>
  <!-- ä½¿ç”¨ change äº‹ä»¶è€Œä¸æ˜¯ input äº‹ä»¶ -->
  <input v-model.lazy="message" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.message },
  on: { 
    change: ($event) => {
      this.message = $event.target.value
    }
  }
})
```

##### 4.2 .number ä¿®é¥°ç¬¦

```vue
<template>
  <input v-model.number="age" type="number" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.age },
  on: { 
    input: ($event) => {
      let value = $event.target.value
      const number = Number(value)
      this.age = isNaN(number) ? value : number
    }
  }
})
```

##### 4.3 .trim ä¿®é¥°ç¬¦

```vue
<template>
  <input v-model.trim="message" />
</template>
```

**ç¼–è¯‘ç»“æœï¼š**
```javascript
h('input', {
  domProps: { value: this.message },
  on: { 
    input: ($event) => {
      this.message = $event.target.value.trim()
    }
  }
})
```

#### 5. è‡ªå®šä¹‰ç»„ä»¶ä¸­çš„ v-model

##### 5.1 åŸºæœ¬å®ç°

```vue
<!-- çˆ¶ç»„ä»¶ -->
<template>
  <CustomInput v-model="value" />
</template>

<!-- CustomInput.vue -->
<template>
  <input 
    :value="value"
    @input="$emit('input', $event.target.value)"
  />
</template>

<script>
export default {
  props: ['value']
}
</script>
```

##### 5.2 è‡ªå®šä¹‰ prop å’Œ event

```vue
<!-- CustomComponent.vue -->
<template>
  <input 
    :value="checked"
    @change="$emit('change', $event.target.checked)"
  />
</template>

<script>
export default {
  model: {
    prop: 'checked',
    event: 'change'
  },
  props: ['checked']
}
</script>
```

**ä½¿ç”¨ï¼š**
```vue
<template>
  <!-- ç­‰ä»·äº :checked="foo" @change="val => { foo = val }" -->
  <CustomComponent v-model="foo" />
</template>
```

#### 6. æºç å®ç°å…³é”®ç‚¹

##### 6.1 ç¼–è¯‘æ—¶å¤„ç†

```javascript
// src/compiler/directives/model.js
export default function model(el, dir) {
  const value = dir.value
  const modifiers = dir.modifiers
  const tag = el.tag
  const type = el.attrsMap.type
  
  // æ ¹æ®å…ƒç´ ç±»å‹é€‰æ‹©å¤„ç†æ–¹å¼
  if (tag === 'select') {
    genSelect(el, value, modifiers)
  } else if (tag === 'input' && type === 'checkbox') {
    genCheckboxModel(el, value, modifiers)
  } else if (tag === 'input' && type === 'radio') {
    genRadioModel(el, value, modifiers)
  } else {
    genDefaultModel(el, value, modifiers)
  }
}
```

##### 6.2 è¿è¡Œæ—¶æ›´æ–°

```javascript
// å“åº”å¼æ›´æ–°æœºåˆ¶
function updateModel(el, binding) {
  const value = binding.value
  const oldValue = binding.oldValue
  
  if (value !== oldValue) {
    el.value = value == null ? '' : value
  }
}
```

#### 7. æ€§èƒ½ä¼˜åŒ–å’Œæ³¨æ„äº‹é¡¹

##### 7.1 ä¸­æ–‡è¾“å…¥æ³•å¤„ç†

```javascript
// å¤„ç†ä¸­æ–‡è¾“å…¥æ³•çš„ composing çŠ¶æ€
function onInput($event) {
  if ($event.target.composing) {
    return // è¾“å…¥æ³•ç»„åˆä¸­ï¼Œä¸æ›´æ–°æ•°æ®
  }
  this.message = $event.target.value
}
```

##### 7.2 å¤§æ•°æ®é‡ä¼˜åŒ–

```vue
<template>
  <div>
    <!-- ä½¿ç”¨ v-memo ä¼˜åŒ–å¤§åˆ—è¡¨ -->
    <div v-for="item in items" :key="item.id" v-memo="[item.selected]">
      <input v-model="item.selected" type="checkbox" />
      {{ item.name }}
    </div>
  </div>
</template>
```

#### 8. ä¸ Vue3 çš„å·®å¼‚å¯¹æ¯”

| ç‰¹æ€§ | Vue2 | Vue3 |
|------|------|------|
| **é»˜è®¤å±æ€§** | `value` | `modelValue` |
| **é»˜è®¤äº‹ä»¶** | `input` | `update:modelValue` |
| **å¤šä¸ªv-model** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **è‡ªå®šä¹‰ä¿®é¥°ç¬¦** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **ç»„ä»¶é…ç½®** | `model` é€‰é¡¹ | `emits` å£°æ˜ |

#### 9. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è¡¨å•éªŒè¯é›†æˆ**ï¼šv-modelä¸è¡¨å•éªŒè¯åº“çš„ç»“åˆä½¿ç”¨
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§è¡¨å•åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
3. **è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šå¦‚ä½•å®ç°ç±»ä¼¼v-modelçš„è‡ªå®šä¹‰æŒ‡ä»¤
4. **æ¡†æ¶å¯¹æ¯”**ï¼šä¸Reactå—æ§ç»„ä»¶çš„å®ç°å·®å¼‚

---

## 7. åœ¨Vueä¸­ï¼Œä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œDOMï¼Ÿ

> **å¯¹åº”ç®€æ´ç‰ˆæœ¬ï¼š** [é¢è¯•é¢˜.md](./é¢è¯•é¢˜.md#_7-åœ¨vueä¸­ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨refè€Œéç›´æ¥æ“ä½œdom)

### ğŸ“š è¯¦ç»†å­¦ä¹ å‚è€ƒ

#### é¢è¯•æ€è·¯åˆ†æ

è¿™æ˜¯ä¸€é“è€ƒæŸ¥Vueè®¾è®¡ç†å¿µå’Œæœ€ä½³å®è·µçš„é¢è¯•é¢˜ï¼Œä¸»è¦è€ƒæŸ¥ç‚¹åŒ…æ‹¬ï¼š
1. **æ¡†æ¶è®¾è®¡ç†å¿µ**ï¼šç†è§£Vueæ•°æ®é©±åŠ¨çš„æ ¸å¿ƒæ€æƒ³
2. **æŠ€æœ¯åŸç†**ï¼šè™šæ‹ŸDOMä¸ç›´æ¥DOMæ“ä½œçš„å†²çª
3. **æœ€ä½³å®è·µ**ï¼šä½•æ—¶ä½¿ç”¨refï¼Œä½•æ—¶é¿å…ç›´æ¥DOMæ“ä½œ
4. **å®é™…åº”ç”¨**ï¼šåœ¨é¡¹ç›®ä¸­çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼

#### 1. Vueè®¾è®¡ç†å¿µï¼šæ•°æ®é©±åŠ¨

##### 1.1 å£°æ˜å¼ vs å‘½ä»¤å¼

```vue
<!-- âŒ å‘½ä»¤å¼ï¼šç›´æ¥æ“ä½œDOM -->
<template>
  <div>
    <button @click="showMessage">æ˜¾ç¤ºæ¶ˆæ¯</button>
    <div id="message-container"></div>
  </div>
</template>

<script>
export default {
  methods: {
    showMessage() {
      // ç›´æ¥æ“ä½œDOM - ä¸æ¨è
      const container = document.getElementById('message-container')
      container.innerHTML = '<p>Hello World!</p>'
      container.style.display = 'block'
    }
  }
}
</script>
```

```vue
<!-- âœ… å£°æ˜å¼ï¼šæ•°æ®é©±åŠ¨ -->
<template>
  <div>
    <button @click="showMessage">æ˜¾ç¤ºæ¶ˆæ¯</button>
    <div v-if="isMessageVisible">
      <p>{{ message }}</p>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      isMessageVisible: false,
      message: 'Hello World!'
    }
  },
  methods: {
    showMessage() {
      // é€šè¿‡æ•°æ®å˜åŒ–é©±åŠ¨è§†å›¾æ›´æ–°
      this.isMessageVisible = true
    }
  }
}
</script>
```

##### 1.2 æ•°æ®æµå‘

```
æ•°æ®å˜åŒ– â†’ è™šæ‹ŸDOMæ›´æ–° â†’ DOM Diff â†’ æœ€å°åŒ–DOMæ“ä½œ â†’ è§†å›¾æ›´æ–°
```

#### 2. ç›´æ¥æ“ä½œDOMçš„é—®é¢˜

##### 2.1 ä¸è™šæ‹ŸDOMå†²çª

```vue
<template>
  <div>
    <ul ref="listRef">
      <li v-for="item in items" :key="item.id">
        {{ item.name }}
      </li>
    </ul>
    <button @click="addItem">æ·»åŠ é¡¹ç›®</button>
    <button @click="directManipulation">ç›´æ¥æ“ä½œDOM</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      items: [
        { id: 1, name: 'é¡¹ç›®1' },
        { id: 2, name: 'é¡¹ç›®2' }
      ]
    }
  },
  methods: {
    addItem() {
      // âœ… æ­£ç¡®æ–¹å¼ï¼šé€šè¿‡æ•°æ®æ›´æ–°
      this.items.push({
        id: Date.now(),
        name: `é¡¹ç›®${this.items.length + 1}`
      })
    },
    
    directManipulation() {
      // âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥æ“ä½œDOM
      const li = document.createElement('li')
      li.textContent = 'ç›´æ¥æ·»åŠ çš„é¡¹ç›®'
      this.$refs.listRef.appendChild(li)
      
      // é—®é¢˜ï¼šä¸‹æ¬¡Vueæ›´æ–°æ—¶ï¼Œè¿™ä¸ªæ‰‹åŠ¨æ·»åŠ çš„å…ƒç´ å¯èƒ½è¢«ç§»é™¤
    }
  }
}
</script>
```

##### 2.2 çŠ¶æ€ä¸ä¸€è‡´é—®é¢˜

```vue
<template>
  <div>
    <input v-model="inputValue" ref="inputRef" />
    <p>å½“å‰å€¼: {{ inputValue }}</p>
    <button @click="directChange">ç›´æ¥ä¿®æ”¹DOM</button>
    <button @click="dataChange">é€šè¿‡æ•°æ®ä¿®æ”¹</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      inputValue: 'initial value'
    }
  },
  methods: {
    directChange() {
      // âŒ ç›´æ¥ä¿®æ”¹DOMï¼Œæ•°æ®ä¸è§†å›¾ä¸åŒæ­¥
      this.$refs.inputRef.value = 'DOM modified'
      // inputValue ä»ç„¶æ˜¯ 'initial value'
    },
    
    dataChange() {
      // âœ… é€šè¿‡æ•°æ®ä¿®æ”¹ï¼Œä¿æŒåŒæ­¥
      this.inputValue = 'Data modified'
    }
  }
}
</script>
```

#### 3. refçš„æ­£ç¡®ä½¿ç”¨åœºæ™¯

##### 3.1 å¿…è¦çš„DOMæ“ä½œ

```vue
<template>
  <div>
    <!-- è¾“å…¥æ¡†èšç„¦ -->
    <input ref="usernameInput" v-model="username" placeholder="ç”¨æˆ·å" />
    <button @click="focusUsername">èšç„¦ç”¨æˆ·å</button>
    
    <!-- æ»šåŠ¨å®šä½ -->
    <div ref="scrollContainer" class="scroll-container">
      <div v-for="item in items" :key="item.id" class="item">
        {{ item.content }}
      </div>
    </div>
    <button @click="scrollToTop">å›åˆ°é¡¶éƒ¨</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      username: '',
      items: Array.from({ length: 100 }, (_, i) => ({
        id: i,
        content: `å†…å®¹ ${i + 1}`
      }))
    }
  },
  methods: {
    focusUsername() {
      // âœ… åˆç†ä½¿ç”¨ï¼šèšç„¦æ“ä½œ
      this.$refs.usernameInput.focus()
    },
    
    scrollToTop() {
      // âœ… åˆç†ä½¿ç”¨ï¼šæ»šåŠ¨æ“ä½œ
      this.$refs.scrollContainer.scrollTop = 0
    }
  },
  mounted() {
    // âœ… ç»„ä»¶æŒ‚è½½åè‡ªåŠ¨èšç„¦
    this.$refs.usernameInput.focus()
  }
}
</script>

<style scoped>
.scroll-container {
  height: 300px;
  overflow-y: auto;
}

.item {
  padding: 10px;
  border-bottom: 1px solid #eee;
}
</style>
```

##### 3.2 ç¬¬ä¸‰æ–¹åº“é›†æˆ

```vue
<template>
  <div>
    <!-- å›¾è¡¨å®¹å™¨ -->
    <div ref="chartContainer" class="chart-container"></div>
    
    <!-- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <div ref="editorContainer" class="editor-container"></div>
  </div>
</template>

<script>
import * as echarts from 'echarts'
// import Editor from '@wangeditor/editor'

export default {
  data() {
    return {
      chartInstance: null,
      editorInstance: null,
      chartData: [
        { name: 'A', value: 10 },
        { name: 'B', value: 20 },
        { name: 'C', value: 30 }
      ]
    }
  },
  
  mounted() {
    this.initChart()
    this.initEditor()
  },
  
  beforeUnmount() {
    // æ¸…ç†èµ„æº
    if (this.chartInstance) {
      this.chartInstance.dispose()
    }
    if (this.editorInstance) {
      this.editorInstance.destroy()
    }
  },
  
  methods: {
    initChart() {
      // âœ… åˆç†ä½¿ç”¨ï¼šåˆå§‹åŒ–å›¾è¡¨åº“
      this.chartInstance = echarts.init(this.$refs.chartContainer)
      
      const option = {
        series: [{
          type: 'pie',
          data: this.chartData
        }]
      }
      
      this.chartInstance.setOption(option)
    },
    
    initEditor() {
      // âœ… åˆç†ä½¿ç”¨ï¼šåˆå§‹åŒ–ç¼–è¾‘å™¨
      // this.editorInstance = new Editor({
      //   container: this.$refs.editorContainer,
      //   onChange: (content) => {
      //     this.$emit('content-change', content)
      //   }
      // })
    },
    
    updateChart() {
      // âœ… æ•°æ®é©±åŠ¨æ›´æ–°
      if (this.chartInstance) {
        this.chartInstance.setOption({
          series: [{
            data: this.chartData
          }]
        })
      }
    }
  },
  
  watch: {
    chartData: {
      handler() {
        this.updateChart()
      },
      deep: true
    }
  }
}
</script>
```

##### 3.3 è·å–DOMä¿¡æ¯

```vue
<template>
  <div>
    <div ref="measureElement" class="measure-box">
      <p>è¿™æ˜¯ä¸€ä¸ªéœ€è¦æµ‹é‡çš„å…ƒç´ </p>
      <p>å†…å®¹å¯èƒ½åŠ¨æ€å˜åŒ–</p>
    </div>
    
    <div class="info">
      <p>å®½åº¦: {{ elementInfo.width }}px</p>
      <p>é«˜åº¦: {{ elementInfo.height }}px</p>
      <p>è·ç¦»é¡¶éƒ¨: {{ elementInfo.offsetTop }}px</p>
    </div>
    
    <button @click="measureElement">æµ‹é‡å…ƒç´ </button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      elementInfo: {
        width: 0,
        height: 0,
        offsetTop: 0
      }
    }
  },
  
  methods: {
    measureElement() {
      // âœ… åˆç†ä½¿ç”¨ï¼šè·å–DOMå°ºå¯¸ä¿¡æ¯
      const element = this.$refs.measureElement
      
      this.elementInfo = {
        width: element.offsetWidth,
        height: element.offsetHeight,
        offsetTop: element.offsetTop
      }
    }
  },
  
  mounted() {
    // åˆå§‹æµ‹é‡
    this.measureElement()
    
    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', this.measureElement)
  },
  
  beforeUnmount() {
    window.removeEventListener('resize', this.measureElement)
  }
}
</script>

<style scoped>
.measure-box {
  padding: 20px;
  border: 2px solid #007bff;
  margin: 20px 0;
}

.info {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 4px;
}
</style>
```

#### 4. Vue3 Composition API ä¸­çš„ ref

##### 4.1 æ¨¡æ¿å¼•ç”¨

```vue
<template>
  <div>
    <input ref="inputRef" v-model="inputValue" />
    <button @click="focusInput">èšç„¦</button>
    
    <div ref="containerRef" class="container">
      <p v-for="item in items" :key="item.id">{{ item.text }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

// å“åº”å¼æ•°æ®
const inputValue = ref('')
const items = ref([
  { id: 1, text: 'é¡¹ç›®1' },
  { id: 2, text: 'é¡¹ç›®2' }
])

// æ¨¡æ¿å¼•ç”¨
const inputRef = ref(null)
const containerRef = ref(null)

// æ–¹æ³•
const focusInput = () => {
  inputRef.value.focus()
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  console.log('Input element:', inputRef.value)
  console.log('Container element:', containerRef.value)
})
</script>
```

##### 4.2 åŠ¨æ€å¼•ç”¨

```vue
<template>
  <div>
    <div
      v-for="(item, index) in items"
      :key="item.id"
      :ref="(el) => setItemRef(el, index)"
      class="item"
    >
      {{ item.text }}
    </div>
    
    <button @click="focusItem(0)">èšç„¦ç¬¬ä¸€é¡¹</button>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const items = ref([
  { id: 1, text: 'é¡¹ç›®1' },
  { id: 2, text: 'é¡¹ç›®2' },
  { id: 3, text: 'é¡¹ç›®3' }
])

// å­˜å‚¨å¤šä¸ªå¼•ç”¨
const itemRefs = ref([])

const setItemRef = (el, index) => {
  if (el) {
    itemRefs.value[index] = el
  }
}

const focusItem = (index) => {
  const element = itemRefs.value[index]
  if (element) {
    element.scrollIntoView({ behavior: 'smooth' })
  }
}

onMounted(() => {
  console.log('All item refs:', itemRefs.value)
})
</script>
```

#### 5. æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹

##### 5.1 ä½•æ—¶ä½¿ç”¨ref

```javascript
// âœ… é€‚åˆä½¿ç”¨refçš„åœºæ™¯
const goodUseCases = [
  'èšç„¦ã€é€‰æ‹©æ–‡æœ¬ã€åª’ä½“æ’­æ”¾',
  'è§¦å‘åŠ¨ç”»',
  'é›†æˆç¬¬ä¸‰æ–¹DOMåº“',
  'è·å–DOMå°ºå¯¸ã€ä½ç½®',
  'è°ƒç”¨åŸç”ŸDOMæ–¹æ³•'
]

// âŒ åº”è¯¥é¿å…çš„åœºæ™¯
const badUseCases = [
  'ä¿®æ”¹å…ƒç´ å†…å®¹ï¼ˆåº”è¯¥ç”¨æ•°æ®ç»‘å®šï¼‰',
  'æ˜¾ç¤º/éšè—å…ƒç´ ï¼ˆåº”è¯¥ç”¨v-if/v-showï¼‰',
  'ä¿®æ”¹æ ·å¼ï¼ˆåº”è¯¥ç”¨classç»‘å®šæˆ–styleç»‘å®šï¼‰',
  'æ·»åŠ /åˆ é™¤å…ƒç´ ï¼ˆåº”è¯¥ç”¨v-forï¼‰'
]
```

##### 5.2 æ€§èƒ½è€ƒè™‘

```vue
<template>
  <div>
    <!-- âŒ é¿å…åœ¨æ¸²æŸ“å‡½æ•°ä¸­é¢‘ç¹è®¿é—®ref -->
    <div>{{ expensiveCalculation() }}</div>
    
    <!-- âœ… ä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜ç»“æœ -->
    <div>{{ cachedResult }}</div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'

const containerRef = ref(null)
const data = ref([])

// âŒ ä¸å¥½çš„åšæ³•
const expensiveCalculation = () => {
  if (containerRef.value) {
    // æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ
    return containerRef.value.offsetWidth * data.value.length
  }
  return 0
}

// âœ… å¥½çš„åšæ³•
const cachedResult = computed(() => {
  // åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—
  return data.value.length * 100 // ä½¿ç”¨æ•°æ®è€ŒéDOM
})

onMounted(() => {
  // åªåœ¨éœ€è¦æ—¶è®¿é—®DOM
  const width = containerRef.value.offsetWidth
  console.log('Container width:', width)
})
</script>
```

##### 5.3 SSRå…¼å®¹æ€§

```vue
<script setup>
import { ref, onMounted, nextTick } from 'vue'

const canvasRef = ref(null)
const chartData = ref([])

// âœ… ç¡®ä¿åœ¨å®¢æˆ·ç«¯ç¯å¢ƒä¸‹æ“ä½œDOM
onMounted(async () => {
  // ç­‰å¾…DOMæ›´æ–°å®Œæˆ
  await nextTick()
  
  // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ç¯å¢ƒ
  if (typeof window !== 'undefined' && canvasRef.value) {
    initCanvas()
  }
})

const initCanvas = () => {
  const canvas = canvasRef.value
  const ctx = canvas.getContext('2d')
  
  // ç»˜åˆ¶å›¾å½¢
  ctx.fillStyle = '#007bff'
  ctx.fillRect(0, 0, 100, 100)
}
</script>

<template>
  <div>
    <canvas ref="canvasRef" width="200" height="200"></canvas>
  </div>
</template>
```

#### 6. ä¸å…¶ä»–æ¡†æ¶çš„å¯¹æ¯”

##### 6.1 Reactå¯¹æ¯”

```javascript
// React - ä½¿ç”¨useRef
function MyComponent() {
  const inputRef = useRef(null)
  
  const focusInput = () => {
    inputRef.current.focus()
  }
  
  return (
    <div>
      <input ref={inputRef} />
      <button onClick={focusInput}>Focus</button>
    </div>
  )
}

// Vue - ä½¿ç”¨ref
// (Vue3 Composition API)
function MyComponent() {
  const inputRef = ref(null)
  
  const focusInput = () => {
    inputRef.value.focus()
  }
  
  return {
    inputRef,
    focusInput
  }
}
```

##### 6.2 Angularå¯¹æ¯”

```typescript
// Angular - ä½¿ç”¨ViewChild
@Component({
  template: `
    <input #inputRef />
    <button (click)="focusInput()">Focus</button>
  `
})
export class MyComponent {
  @ViewChild('inputRef') inputRef!: ElementRef
  
  focusInput() {
    this.inputRef.nativeElement.focus()
  }
}
```

#### 7. æ‰©å±•çŸ¥è¯†ç‚¹

1. **è™šæ‹ŸDOMåŸç†**ï¼šç†è§£Vueå¦‚ä½•é€šè¿‡è™šæ‹ŸDOMä¼˜åŒ–æ€§èƒ½
2. **å“åº”å¼ç³»ç»Ÿ**ï¼šæ•°æ®å˜åŒ–å¦‚ä½•è§¦å‘è§†å›¾æ›´æ–°
3. **ç»„ä»¶é€šä¿¡**ï¼šrefåœ¨çˆ¶å­ç»„ä»¶é€šä¿¡ä¸­çš„åº”ç”¨
4. **è‡ªå®šä¹‰æŒ‡ä»¤**ï¼šå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤æ¥å°è£…DOMæ“ä½œ

---

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•) | [ğŸ“ è¿”å›é¢è¯•é¢˜ç®€æ´ç‰ˆæœ¬](./é¢è¯•é¢˜.md)